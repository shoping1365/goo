// Package services مستندسازی ماژول سرویس‌ها
//
// این فایل توضیحات جامع (بصورت فارسی) درباره منطق رسانه‌ای پروژه را ارائه می‌کند.
// -----------------------------------------------------------------------------
// MediaFileService
// ----------------
//
//	MediaFileService لایهٔ سرویس برای مدیریت فایل‌های رسانه‌ای است و مسئول منطق
//	تجاریِ سطح بالای زیر می‌باشد:
//	  • ایجاد فایل رسانه (Create)
//	  • ایجاد فایل + نسخهٔ اولیه در یک تراکنش (CreateWithVersion)
//	  • حذف/به‌روزرسانی و پاکسازی کش
//	این سرویس از الگوی UnitOfWork استفاده می‌کند تا تضمین کند تمام عملیات‌های
//	مرتبط با فایل و نسخه در یک تراکنش اتمیک انجام شوند. (Rule 0 – Repository + UoW).
//
//	توالی عملیات اصلی:
//	  1. `uow := uowFactory.Create()`
//	  2. `uow.BeginTx(ctx)`
//	  3. فراخوانی ریپازیتوری‌ـها (MediaFileRepository، MediaVersionRepository ...)
//	  4. `uow.Commit()` یا در صورت خطا `uow.Rollback()`
//
//	سرویس همچنین در صورت وجود Redis، کش‌ فایل‌ها را با کلید `media:<id>` مدیریت
//	می‌کند. پس از عملیات‌های write،‌ متد `invalidateCache` فراخوانی شده و از Rule 11
//	(پاکسازی قبل از Commit) تبعیت می‌کند.
//
// -----------------------------------------------------------------------------
// MediaFileService & CQRS
// -----------------------
//
//	این سرویس در لایهٔ CommandHandler (CQRS) توسط CommandBus فراخوانی نمی‌شود، بلکه
//	CommandHandler مستقیماً از UnitOfWork استفاده می‌کند تا وابستگی‌ها به حداقل برسد.
//	در عین حال، MediaFileService برای REST Handlerهای غیر CQRS یا وظایف Scheduled
//	قابل استفاده است.
//
// -----------------------------------------------------------------------------
// نکات امنیتی
// -----------
//   - تمام ورودی‌­ها قبل از ذخیره‌سازی بررسی می‌شوند (اندازه، نوع MIME).
//   - عملیات فشرده‌سازی به جدول compression_jobs افزوده می‌شود تا از پردازش همزمان
//     جلوگیری شود (Rule 15 – امنیت).
//
// -----------------------------------------------------------------------------
// الزامات پرفورمنس
// -----------------
//   - پشتیبانی از Prepared Statement و Statement Cache به‌صورت سراسری (gorm.Config{PrepareStmt:true}) برای کاهش سربار Parse/Plan.
//
// -----------------
//   - استفاده از متد BulkCreate هنگامی که بیش از ۵۰ فایل همزمان ایجاد می‌شوند.
//   - استفاده از ایندکس‌های `idx_media_files_category_created` و
//     `idx_media_files_uploaded_by_created` که در Migration ۴۴ و ۴۵ ایجاد شده‌اند.
//
// -----------------------------------------------------------------------------
package services
