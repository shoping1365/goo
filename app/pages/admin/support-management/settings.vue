<template>
  <div class="p-6" dir="rtl">
    <div class="mb-6 bg-white p-6 rounded-lg shadow-md border border-gray-200">
      <h1 class="text-2xl font-bold text-gray-900 mb-2">ุชูุธูุงุช ฺุช ุขููุงู ู ูพุดุชุจุงู</h1>
      <p class="text-gray-600">ูุฏุฑุช ุฏูพุงุฑุชูุงูโูุง ูพุดุชุจุงู</p>
    </div>

         <!-- ููู ุชุจโูุง -->
     <div class="mb-8">
       <nav class="flex flex-wrap gap-2 border-b border-gray-200">
         <button
:class="['px-4 py-2 text-sm font-medium rounded-t-md focus:outline-none', activeTab === 'departments' ? 'bg-white border-x border-t border-b-0 border-gray-200 text-blue-600' : 'bg-gray-100 text-gray-600 hover:bg-gray-200']"
           @click="activeTab = 'departments'">
           ุฏูพุงุฑุชูุงู ุจูุฏ
         </button>
         <button
:class="['px-4 py-2 text-sm font-medium rounded-t-md focus:outline-none', activeTab === 'workingHours' ? 'bg-white border-x border-t border-b-0 border-gray-200 text-blue-600' : 'bg-gray-100 text-gray-600 hover:bg-gray-200']"
           @click="activeTab = 'workingHours'">
           ุฒูุงูโูุง ฺฉุงุฑ
         </button>
         <button
:class="['px-4 py-2 text-sm font-medium rounded-t-md focus:outline-none', activeTab === 'waitingMode' ? 'bg-white border-x border-t border-b-0 border-gray-200 text-blue-600' : 'bg-gray-100 text-gray-600 hover:bg-gray-200']"
           @click="activeTab = 'waitingMode'">
           ุญุงูุช ุงูุชุธุงุฑ
         </button>
         <button
:class="['px-4 py-2 text-sm font-medium rounded-t-md focus:outline-none', activeTab === 'smartMessages' ? 'bg-white border-x border-t border-b-0 border-gray-200 text-blue-600' : 'bg-gray-100 text-gray-600 hover:bg-gray-200']"
           @click="activeTab = 'smartMessages'">
           ููุดููุฏ ุณุงุฒ
         </button>
         <button
:class="['px-4 py-2 text-sm font-medium rounded-t-md focus:outline-none', activeTab === 'formBuilder' ? 'bg-white border-x border-t border-b-0 border-gray-200 text-blue-600' : 'bg-gray-100 text-gray-600 hover:bg-gray-200']"
           @click="activeTab = 'formBuilder'">
           ุงุฌุงุฏ ูุฑู
         </button>
        <button
:class="['px-4 py-2 text-sm font-medium rounded-t-md focus:outline-none', activeTab === 'rateLimit' ? 'bg-white border-x border-t border-b-0 border-gray-200 text-blue-600' : 'bg-gray-100 text-gray-600 hover:bg-gray-200']"
          @click="activeTab = 'rateLimit'">
          ูุฑุฎ ูพุงู
        </button>
        <button
:class="['px-4 py-2 text-sm font-medium rounded-t-md focus:outline-none', activeTab === 'security' ? 'bg-white border-x border-t border-b-0 border-gray-200 text-blue-600' : 'bg-gray-100 text-gray-600 hover:bg-gray-200']"
          @click="activeTab = 'security'">
          ุงููุช ฺุช
        </button>

       </nav>
     </div>

    <!-- ูุญุชูุง ุชุจ ูุนุงู -->
    <div>
      <!-- ุฏูพุงุฑุชูุงู ุจูุฏ -->
      <div v-if="activeTab === 'departments'" class="space-y-6">
        <!-- ูุฏุฑ ุจููุด -->
        <div class="bg-purple-600 text-white p-6 rounded-lg">
          <h2 class="text-2xl font-bold mb-2">ุงุฌุงุฏ ุชู</h2>
          <p class="text-purple-100">
            ุจุง ุงุณุชูุงุฏู ุงุฒ ูุงุจูุช "ุงุฌุงุฏ ุชู"ุ ูโุชูุงูุฏ ุชูโูุง ุจุง ุชุฎุตุตโูุง ูุชูุงูุช ุจุณุงุฒุฏ ู ุจุฑุง ูุฑ ฺฉุฏุงู ุงูพุฑุงุชูุฑ ูุฎุตูุต ุงุฎุชุตุงุต ุฏูุฏ. ุจู ุนููุงู ูุซุงูุ ฺฉ ุชู ุจุฑุง ูุดฺฉูุงุช ูู ุง ฺฉ ุชู ูุงู ุชุดฺฉู ุฏูุฏ.
          </p>
        </div>

        <!-- ูุญุชูุง ุงุตู -->
        <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
          <div class="flex flex-col lg:flex-row gap-6">
            <!-- ุฏฺฉูู ุงุฌุงุฏ ุชู ุฌุฏุฏ -->
            <div class="lg:w-1/3">
              <button class="w-full bg-purple-600 text-white py-4 px-6 rounded-lg hover:bg-purple-700 transition-colors font-medium" @click="showCreateTeamModal = true">
                ุงุฌุงุฏ ุชู ุฌุฏุฏ
              </button>
            </div>

                         <!-- ูุณุช ุชูโูุง -->
             <div class="lg:w-2/3">
               <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                 <div v-for="team in teams" :key="team.id" class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                   <div class="flex items-center justify-between">
                     <div class="flex items-center space-x-3 space-x-reverse">
                       <div class="w-12 h-12 rounded-full flex items-center justify-center" :style="{ backgroundColor: team.color }">
                         <span class="text-white text-lg">{{ team.icon }}</span>
                       </div>
                       <div>
                         <h3 class="font-medium text-gray-900">{{ team.name }}</h3>
                         <p class="text-sm text-gray-600">{{ team.operatorCount }} ุงูพุฑุงุชูุฑ</p>
                       </div>
                     </div>
                     <div class="flex space-x-2 space-x-reverse">
                       <button class="w-6 h-6 bg-blue-500 rounded flex items-center justify-center" @click="showEditTeamModal = true; currentTeam = team">
                         <span class="text-white text-xs">โ๏ธ</span>
                       </button>
                       <button class="w-6 h-6 bg-red-500 rounded flex items-center justify-center" @click="deleteTeam(team.id)">
                         <span class="text-white text-xs">๐๏ธ</span>
                       </button>
                     </div>
                   </div>
                 </div>
               </div>
             </div>
          </div>
        </div>
             </div>
     </div>

     <!-- ุฒูุงูโูุง ฺฉุงุฑ -->
     <div v-if="activeTab === 'workingHours'" class="space-y-6">
       <!-- ูุฏุฑ ุจููุด -->
       <div class="bg-purple-600 text-white p-6 rounded-lg">
         <h2 class="text-2xl font-bold mb-2">ุฒูุงูโูุง ฺฉุงุฑ</h2>
         <p class="text-purple-100">
           ูุดุฎุต ฺฉุฑุฏู ุณุงุนุงุช ฺฉุงุฑ ุจุฑุง ุขฺฏุงู ฺฉุงุฑุจุฑุงู. ุฏุฑ ุฒูุงูโูุง ุบุฑฺฉุงุฑ ูุฒ ฺฉุงุฑุจุฑุงู ุงุฒ ุฏุณุช ููโุฑููุฏ. ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุขููุงู ุจูุฏู ุฏุฑ ุชูฺฏุฑุงู ุจู ูุนูุง ุขููุงู ุจูุฏู ุฏุฑ ุณุณุชู ูุง ูุณุช.
         </p>
       </div>

       <!-- ูุญุชูุง ุงุตู -->
       <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
         <!-- ุจุฎุด ุฒูุงูโูุง ฺฉุงุฑ -->
         <div class="mb-8">
           <h3 class="text-xl font-bold text-gray-900 mb-4">ุฒูุงู ูุง ฺฉุงุฑ</h3>
           
           <!-- ุชุตูุฑ ุณุงุนุช -->
           <div class="flex justify-center mb-6">
             <div class="relative">
               <!-- ุณุงุนุช ุงุตู -->
               <div class="w-32 h-32 bg-purple-600 rounded-full flex items-center justify-center relative">
                 <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center">
                   <div class="w-1 h-8 bg-purple-600 rounded-full transform rotate-45 origin-bottom"></div>
                   <div class="w-1 h-6 bg-purple-600 rounded-full transform -rotate-45 origin-bottom absolute"></div>
                 </div>
               </div>
               
               <!-- ูุงู ู ุณุชุงุฑู -->
               <div class="absolute -top-6 -right-4 text-2xl">๐</div>
               <div class="absolute -top-2 -right-8 text-lg">โญ</div>
               
               <!-- ุฎูุฑุดุฏ -->
               <div class="absolute -top-6 -left-4 text-2xl">โ๏ธ</div>
               
               <!-- ุดฺฉูโูุง ููุฏุณ -->
               <div class="absolute top-2 -right-12 w-3 h-3 bg-yellow-400 transform rotate-45"></div>
               <div class="absolute -bottom-2 -right-8 w-2 h-2 bg-purple-400 rounded"></div>
               <div class="absolute -bottom-4 -left-6 w-2 h-2 bg-yellow-400 transform rotate-45"></div>
             </div>
           </div>
           
           <!-- ูุชู ุชูุถุญุงุช -->
           <div class="text-center mb-6">
             <p class="text-gray-600 mb-4">
               ุฏุฑ ุตูุฑุช ฺฉู ุฒูุงู ฺฉุงุฑ ุชุนุฑู ูฺฉุฑุฏู ุจุงุดุฏุ ฺฉู ููุชู ุฒูุงูโูุง ฺฉุงุฑ ุดูุง ูุญุณูุจ ูโุดูุฏ ู ุชูุธูุงุช ุฒูุงูโูุง ุบุฑ ฺฉุงุฑ ุงุนูุงู ูุฎูุงููุฏ ุดุฏ.
             </p>
             <button class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors font-medium" @click="showWorkingHoursModal = true">
               ุงูุฒูุฏู ุฒูุงู ฺฉุงุฑ
             </button>
           </div>
         </div>

         <!-- ุจุฎุด ุฒูุงูโูุง ุบุฑฺฉุงุฑ -->
         <div>
           <h3 class="text-xl font-bold text-gray-900 mb-4">ุฒูุงู ูุง ุบุฑฺฉุงุฑ</h3>
           
           <!-- ุชูุธูุงุช -->
           <div class="space-y-4">
             <div class="flex items-center justify-between p-6 bg-gray-50 rounded-lg">
               <div class="flex items-center space-x-3 space-x-reverse">
                 <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center">
                   <span class="text-white text-xs">?</span>
                 </div>
                 <span class="text-sm text-gray-700">ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู ูพุงู ุขููุงู: ุฏุฑุงูุช ุงุทูุงุนุงุช ฺฉุงุฑุจุฑุงู ุจุฑุง ุชูุงุณ ูุฌุฏุฏ</span>
               </div>
               <div class="flex items-center space-x-2 space-x-reverse">
                 <button class="text-blue-600 hover:text-blue-700">
                   <span class="text-sm">โ๏ธ</span>
                 </button>
                 <label class="relative inline-flex items-center cursor-pointer">
                   <input v-model="offlineSettings.offlineMessage" type="checkbox" class="sr-only peer">
                   <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                 </label>
               </div>
             </div>

             <div class="flex items-center justify-between p-6 bg-gray-50 rounded-lg">
               <div class="flex items-center space-x-3 space-x-reverse">
                 <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center">
                   <span class="text-white text-xs">?</span>
                 </div>
                 <span class="text-sm text-gray-700">ุชุบุฑ ุจู ุญุงูุช ุขููุงู</span>
               </div>
               <label class="relative inline-flex items-center cursor-pointer">
                 <input v-model="offlineSettings.changeToOnline" type="checkbox" class="sr-only peer">
                 <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
               </label>
             </div>

             <div class="flex items-center justify-between p-6 bg-gray-50 rounded-lg">
               <div class="flex items-center space-x-3 space-x-reverse">
                 <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center">
                   <span class="text-white text-xs">?</span>
                 </div>
                 <span class="text-sm text-gray-700">ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู ุงุฑุณุงู ูพุงูโูุง ููุดููุฏ</span>
               </div>
               <label class="relative inline-flex items-center cursor-pointer">
                 <input v-model="offlineSettings.smartMessages" type="checkbox" class="sr-only peer">
                 <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
               </label>
             </div>

             <div class="flex items-center justify-between p-6 bg-gray-50 rounded-lg">
               <div class="flex items-center space-x-3 space-x-reverse">
                 <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center">
                   <span class="text-white text-xs">?</span>
                 </div>
                 <span class="text-sm text-gray-700">ุงุฑุณุงู ูพุงูโูุง ุจู ุชูฺฏุฑุงู</span>
               </div>
               <label class="relative inline-flex items-center cursor-pointer">
                 <input v-model="offlineSettings.sendToTelegram" type="checkbox" class="sr-only peer">
                 <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
               </label>
             </div>

             <div class="flex items-center justify-between p-6 bg-gray-50 rounded-lg">
               <div class="flex items-center space-x-3 space-x-reverse">
                 <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center">
                   <span class="text-white text-xs">?</span>
                 </div>
                 <span class="text-sm text-gray-700">ุชุบุฑ ุขฺฉูู ุงุจุฒุงุฑฺฉ ุจู ุญุงูุช ุฎูุงุจ</span>
               </div>
               <label class="relative inline-flex items-center cursor-pointer">
                 <input v-model="offlineSettings.sleepMode" type="checkbox" class="sr-only peer">
                 <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
               </label>
             </div>

             <div class="flex items-center justify-between p-6 bg-gray-50 rounded-lg">
               <div class="flex items-center space-x-3 space-x-reverse">
                 <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center">
                   <span class="text-white text-xs">?</span>
                 </div>
                 <span class="text-sm text-gray-700">ูุฎู ฺฉุฑุฏู ุงุจุฒุงุฑฺฉ</span>
               </div>
               <label class="relative inline-flex items-center cursor-pointer">
                 <input v-model="offlineSettings.hideWidget" type="checkbox" class="sr-only peer">
                 <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
               </label>
             </div>

             <div class="flex items-center justify-between p-6 bg-gray-50 rounded-lg">
               <div class="flex items-center space-x-3 space-x-reverse">
                 <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center">
                   <span class="text-white text-xs">?</span>
                 </div>
                 <span class="text-sm text-gray-700">ุบุฑูุนุงู ฺฉุฑุฏู ุงูฺฉุงู ฺุช</span>
               </div>
               <label class="relative inline-flex items-center cursor-pointer">
                 <input v-model="offlineSettings.disableChat" type="checkbox" class="sr-only peer">
                 <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
               </label>
             </div>
           </div>
         </div>
       </div>
     </div>

     <!-- ุญุงูุช ุงูุชุธุงุฑ -->
     <div v-if="activeTab === 'waitingMode'" class="space-y-6">
       <!-- ูุฏุฑ ุจููุด -->
       <div class="bg-purple-600 text-white p-6 rounded-lg">
         <h2 class="text-2xl font-bold mb-2">ุญุงูุช ุงูุชุธุงุฑ</h2>
         <p class="text-purple-100">
           ุฏุฑ ุงู ุญุงูุชุ ฺฉุงุฑุจุฑุงู ุฏุฑ ุตู ุงูุชุธุงุฑ ูุฑุงุฑ ูโฺฏุฑูุฏ ู ูพุงู ุฎูุฏฺฉุงุฑ ุจุฑุง ุขูโูุง ุงุฑุณุงู ูโุดูุฏ. ุงู ุญุงูุช ุจุฑุง ุฒูุงู ููุงุณุจ ุงุณุช ฺฉู ุงูพุฑุงุชูุฑูุง ูุดุบูู ูุณุชูุฏ ุง ุฎุงุฑุฌ ุงุฒ ุณุงุนุงุช ฺฉุงุฑ ูโุจุงุดูุฏ.
         </p>
       </div>

       <!-- ูุญุชูุง ุงุตู -->
       <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
         <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
           <!-- ุณุชูู ุฑุงุณุช - ูุฏุฑุช ุนููุงุช -->
           <div class="space-y-6">
             <h3 class="text-xl font-bold text-gray-900 mb-4">ูุฏุฑุช ุนููุงุช</h3>
             
             <!-- ุฏฺฉูู ุงุฌุงุฏ ุนููุงุช ุฌุฏุฏ -->
             <div class="bg-purple-600 text-white p-6 rounded-lg">
               <h4 class="text-lg font-semibold mb-2">ุนููุงุช ุชุงุฎุฑ ุฏุฑ ูพุงุณุฎฺฏู</h4>
               <p class="text-purple-100 mb-4">
                 ุญุช ุฒูุงู ฺฉู ุชูุงู ุงูพุฑุงุชูุฑูุง ุดูุง ูุดุบูู ูุณุชูุฏ ููฺูุงู ุจู ูุดุชุฑุงู ุฎูุฏ ุชูุฌู ฺฉูุฏ
               </p>
               <button class="bg-white text-purple-600 px-6 py-3 rounded-lg hover:bg-purple-50 transition-colors font-medium" @click="openCreateOperationModal">
                 ุงุฌุงุฏ ุนููุงุช ุฌุฏุฏ
               </button>
             </div>

             <!-- ูุณุช ุนููุงุช -->
             <div class="bg-white border border-gray-200 rounded-lg p-6">
               <h4 class="text-lg font-semibold text-gray-900 mb-4">ูุณุช ุนููุงุช ูุง</h4>
               
               <!-- ูุณุช ุนููุงุชโูุง -->
               <div v-if="operations.length > 0" class="space-y-4">
                 <div v-for="operation in operations" :key="operation.id" class="bg-purple-600 text-white p-6 rounded-lg relative">
                   <div class="flex justify-between items-start">
                     <div class="flex-1">
                       <p class="text-center">{{ operation.content }}</p>
                       <div class="flex justify-center space-x-2 space-x-reverse mt-2">
                         <div class="w-3 h-3 bg-white rounded-full opacity-60"></div>
                         <div class="w-3 h-3 bg-white rounded-full opacity-60"></div>
                         <div class="w-3 h-3 bg-white rounded-full opacity-60"></div>
                       </div>
                     </div>
                     <div class="flex space-x-2 space-x-reverse">
                       <button class="text-white hover:text-purple-200 text-sm" @click="openEditOperationModal(operation)">โ๏ธ</button>
                       <button class="text-white hover:text-red-200 text-sm" @click="deleteOperation(operation.id)">โ</button>
                     </div>
                   </div>
                 </div>
               </div>

               <!-- ูพุงู ุฎุงู -->
               <div v-if="operations.length === 0" class="text-center py-8">
                 <p class="text-gray-500 font-bold">ูฺ ุนููุงุช ุชุนุฑู ูุดุฏู ุงุณุช</p>
               </div>
             </div>
           </div>
         </div>
       </div>
     </div>

     <!-- ููุดููุฏ ุณุงุฒ -->
     <div v-if="activeTab === 'smartMessages'" class="space-y-6">
       <!-- ูุฏุฑ ุจููุด -->
       <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6 rounded-lg">
         <div class="flex justify-between items-start">
           <div class="flex-1">
             <h2 class="text-2xl font-bold mb-2">ฑ ูพุงู ููุดููุฏ</h2>
             <p class="text-purple-100">
               ุขุง ุจู ุฏูุจุงู ุฑุงู ุณุฑุน ู ููุดููุฏ ุจุฑุง ุขุบุงุฒ ฺฉุฑุฏู ูฺฉุงููุงุช ูุณุชุฏุ ููุดููุฏุณุงุฒ ุงุจุฒุงุฑฺฉ ุดูุง ุงู ุงูฺฉุงู ุฑุง ุจู ุดูุง ูุฏูุฏ!
             </p>
           </div>
           <div class="flex flex-col space-y-3 space-y-reverse">
             <button class="bg-white text-purple-600 px-6 py-3 rounded-lg hover:bg-purple-50 transition-colors font-medium" @click="showCreateSmartMessageModal = true">
               ูพุงู ููุดููุฏ ุฌุฏุฏ
             </button>
             <a href="#" class="text-purple-100 hover:text-white text-sm flex items-center space-x-2 space-x-reverse">
               <span>ุฑุงูููุง ุฎูุด ุขูุฏฺฏู</span>
               <span>โ</span>
             </a>
           </div>
         </div>
       </div>

       <!-- ูุญุชูุง ุงุตู -->
       <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
         <!-- ุฌุฏูู ูพุงูโูุง ููุดููุฏ -->
         <div class="overflow-x-auto">
           <table class="w-full">
             <thead>
               <tr class="border-b border-gray-200">
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ุนููุงู</th>
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ูุถุนุช</th>
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ุงุฑุณุงู ฺฉููุฏู</th>
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ุขุฎุฑู ุจู ุฑูุฒุฑุณุงู</th>
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ุจู ุฑูุฒ ุฑุณุงู ุชูุณุท</th>
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ูุฑุงุด ู ุญุฐู</th>
               </tr>
             </thead>
             <tbody>
               <tr v-for="message in smartMessages" :key="message.id" class="border-b border-gray-100 hover:bg-gray-50">
                 <td class="py-4 px-4 text-gray-900">{{ message.title }}</td>
                 <td class="py-4 px-4">
                   <div class="flex items-center space-x-2 space-x-reverse">
                     <div class="relative">
                       <select v-model="message.status" class="appearance-none bg-transparent border-none text-sm focus:outline-none">
                         <option value="active">ูุนุงู</option>
                         <option value="inactive">ุบุฑูุนุงู</option>
                       </select>
                       <div class="absolute inset-y-0 left-0 flex items-center pointer-events-none">
                         <span class="text-gray-400">โผ</span>
                       </div>
                     </div>
                     <div v-if="message.status === 'active'" class="w-2 h-2 bg-green-500 rounded-full"></div>
                   </div>
                 </td>
                 <td class="py-4 px-4">
                   <div class="flex items-center space-x-2 space-x-reverse">
                     <div class="relative">
                       <select v-model="message.sender" class="appearance-none bg-transparent border-none text-sm focus:outline-none">
                         <option value="random">ุงูุชุฎุงุจ ุชุตุงุฏู</option>
                         <option value="specific">ุงูุชุฎุงุจ ุฎุงุต</option>
                       </select>
                       <div class="absolute inset-y-0 left-0 flex items-center pointer-events-none">
                         <span class="text-gray-400">โผ</span>
                       </div>
                     </div>
                     <span v-if="message.sender === 'random'" class="text-gray-500">๐</span>
                   </div>
                 </td>
                 <td class="py-4 px-4 text-gray-600 text-sm">{{ message.lastUpdate }}</td>
                 <td class="py-4 px-4">
                   <div class="flex items-center space-x-2 space-x-reverse">
                     <span class="text-gray-900 text-sm">{{ message.updatedBy.name }}</span>
                     <span class="text-gray-500 text-xs">{{ message.updatedBy.email }}</span>
                     <div class="w-6 h-6 bg-orange-400 rounded-full flex items-center justify-center">
                       <span class="text-white text-xs">๐ค</span>
                     </div>
                   </div>
                 </td>
                 <td class="py-4 px-4">
                   <div class="flex items-center space-x-2 space-x-reverse">
                     <button class="text-gray-500 hover:text-blue-600" @click="editSmartMessage(message)">
                       <span class="text-lg">โ๏ธ</span>
                     </button>
                     <button class="text-gray-500 hover:text-red-600" @click="deleteSmartMessage(message.id)">
                       <span class="text-lg">๐๏ธ</span>
                     </button>
                   </div>
                 </td>
               </tr>
             </tbody>
           </table>
         </div>

         <!-- ูพุงู ุฎุงู -->
         <div v-if="smartMessages.length === 0" class="text-center py-12">
           <div class="text-gray-400 text-6xl mb-4">๐ฌ</div>
           <p class="text-gray-500 font-medium">ูฺ ูพุงู ููุดููุฏ ุชุนุฑู ูุดุฏู ุงุณุช</p>
           <p class="text-gray-400 text-sm mt-2">ุจุฑุง ุดุฑูุนุ ฺฉ ูพุงู ููุดููุฏ ุฌุฏุฏ ุงุฌุงุฏ ฺฉูุฏ</p>
         </div>
       </div>
     </div>

     <!-- ููุฏุงู ุงุฌุงุฏ/ูุฑุงุด ูพุงู ููุดููุฏ -->
     <div v-if="showCreateSmartMessageModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
       <div class="bg-white rounded-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-hidden flex flex-col">
         <!-- ูุฏุฑ ููุฏุงู -->
         <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6">
           <div class="flex justify-between items-center">
             <button class="text-white hover:text-purple-200 text-sm" @click="closeSmartMessageModal">
               ุจุงุฒฺฏุดุช
             </button>
             <div class="flex items-center space-x-4 space-x-reverse">
               <h2 class="text-xl font-bold">{{ currentSmartMessage.title || 'ุดุฑุท ฒ' }}</h2>
               <input type="checkbox" class="rounded border-white text-purple-600 focus:ring-purple-500">
             </div>
           </div>
           
           <!-- ุชุจโูุง ูุงูุจุฑ -->
           <div class="mt-4">
             <nav class="flex space-x-1 space-x-reverse">
               <button
:class="['px-4 py-2 text-sm font-medium rounded-t-md focus:outline-none', activeSmartMessageTab === 'content' ? 'bg-white text-purple-600' : 'text-purple-200 hover:text-white']" 
                 @click="activeSmartMessageTab = 'content'">
                 ูุญุชูุง
               </button>
               <button
:class="['px-4 py-2 text-sm font-medium rounded-t-md focus:outline-none', activeSmartMessageTab === 'condition' ? 'bg-white text-purple-600' : 'text-purple-200 hover:text-white']" 
                 @click="activeSmartMessageTab = 'condition'">
                 ุดุฑุท
               </button>
               <button
:class="['px-4 py-2 text-sm font-medium rounded-t-md focus:outline-none', activeSmartMessageTab === 'publishTime' ? 'bg-white text-purple-600' : 'text-purple-200 hover:text-white']" 
                 @click="activeSmartMessageTab = 'publishTime'">
                 ุฒูุงู ุงูุชุดุงุฑ
               </button>
             </nav>
           </div>
         </div>

         <!-- ูุญุชูุง ุงุตู -->
         <div class="flex-1 flex overflow-hidden">
           <!-- ุจุฎุด ฺูพ - ูพุดโููุงุด ฺุช -->
           <div class="w-1/2 bg-gray-50 p-6 flex flex-col">
             <!-- ูพุดโููุงุด ฺุช -->
             <div class="flex-1 flex items-center justify-center">
               <div class="relative">
                 <!-- ุฏุงุฑู ุณูุฏ ุจุฒุฑฺฏ -->
                 <div class="w-80 h-80 bg-white rounded-full shadow-lg flex items-center justify-center relative">
                   <!-- ุญุจุงุจ ูพุงู ฺุช -->
                   <div class="bg-purple-100 p-6 rounded-lg max-w-48 mb-4">
                     <p class="text-sm text-gray-800">{{ smartMessageForm.content || 'ุจู ุณุงุช ูุง ุฎูุด ุงููุฏูุ ุฏุฑ ุฎุฏูุชุชูู ูุณุชู ๐' }}</p>
                   </div>
                   
                   <!-- ููุฏ ูุฑูุฏ -->
                   <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 w-64">
                     <div class="bg-white border border-gray-300 rounded-lg p-3 flex items-center space-x-2 space-x-reverse">
                       <span class="text-gray-400">๐ฌ</span>
                       <span class="text-gray-400">๐</span>
                       <span class="text-gray-400">@</span>
                       <input v-model="smartMessageForm.content" type="text" placeholder="ุงูุฌุง ุชุงูพ ฺฉูุฏ." class="flex-1 text-sm focus:outline-none">
                     </div>
                   </div>
                 </div>
                 
                 <!-- ุขฺฉูู ฺุช ุจููุด -->
                 <div class="absolute -right-8 -top-8 w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center">
                   <span class="text-white text-2xl">๐ฌ</span>
                 </div>
               </div>
             </div>
             
             <!-- ุฎูุงุตู ุชูุธูุงุช -->
             <div class="mt-6 space-y-2">
               <div class="flex justify-between text-sm">
                 <span class="text-gray-600">ูุญุชูุง:</span>
                 <span class="text-gray-900">{{ getDisplayTypeText(smartMessageForm.displayType) }}</span>
               </div>
               <div class="flex justify-between text-sm">
                 <span class="text-gray-600">ุดุฑุท:</span>
                 <span class="text-gray-900">{{ smartMessageForm.conditions.length > 0 ? 'ุชุนุฑู ุดุฏู' : 'ุชุนุฑู ูุดุฏู' }}</span>
               </div>
               <div class="flex justify-between text-sm">
                 <span class="text-gray-600">ุฒูุงู ุงูุชุดุงุฑ:</span>
                 <span class="text-gray-900">{{ getPublishTimeText() }}</span>
               </div>
             </div>
           </div>

           <!-- ุจุฎุด ุฑุงุณุช - ูุฑู ุชูุธูุงุช -->
           <div class="w-1/2 p-6 overflow-y-auto">
             <!-- ุชุจ ูุญุชูุง -->
             <div v-if="activeSmartMessageTab === 'content'" class="space-y-6">
               <!-- ููุน ุนููุงุช -->
               <div>
                 <label class="block text-sm font-medium text-gray-700 mb-2">ุงู ุนููุงุช ุงูุฌุงู ุดูุฏ:</label>
                 <select v-model="smartMessageForm.operationType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                   <option value="message_only">ูพุงู ุงุฑุณุงู ุดูุฏ ุงูุง ุงุจุฒุงุฑฺฉ ุจุงุฒ ูุดูุฏ (ููุงุด ฺฉูุชุงู ูพุงู)</option>
                   <option value="message_and_widget">ูพุงู ุงุฑุณุงู ุดูุฏ ู ุงุจุฒุงุฑฺฉ ุจุงุฒ ุดูุฏ</option>
                   <option value="widget_only">ููุท ุงุจุฒุงุฑฺฉ ุจุงุฒ ุดูุฏ</option>
                 </select>
               </div>

               <!-- ูุชู ูพุงู -->
               <div>
                 <label class="block text-sm font-medium text-gray-700 mb-2">ูุชู ูพุงู</label>
                 <textarea 
                   v-model="smartMessageForm.content" 
                   rows="6" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
                   placeholder="ูุชู ูพุงู ููุดููุฏ ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ..."
                 ></textarea>
                 
                 <!-- ููุงุฑ ุงุจุฒุงุฑ ูุฑูุช -->
                 <div class="flex items-center space-x-2 space-x-reverse mt-2 p-2 bg-gray-50 rounded">
                   <button class="p-1 hover:bg-gray-200 rounded font-bold">B</button>
                   <button class="p-1 hover:bg-gray-200 rounded italic">I</button>
                   <button class="p-1 hover:bg-gray-200 rounded underline">U</button>
                   <button class="p-1 hover:bg-gray-200 rounded">โฐ</button>
                 </div>
                 
                 <!-- ุดูุงุฑูุฏู ฺฉุงุฑุงฺฉุชุฑ -->
                 <div class="text-sm text-gray-500 mt-2">
                   ฺฉุงุฑุงฺฉุชุฑ ุจุงู ูุงูุฏู: {{ 10000 - (smartMessageForm.content?.length || 0) }}
                 </div>
               </div>

               <!-- ุงุฑุณุงู ุจู ุนููุงู -->
               <div>
                 <label class="block text-sm font-medium text-gray-700 mb-2">ุงุฑุณุงู ุจู ุนููุงู</label>
                 <div class="space-y-3">
                   <div class="flex items-center space-x-3 space-x-reverse">
                     <input v-model="smartMessageForm.displayType" type="radio" value="full" class="text-purple-600 focus:ring-purple-500">
                     <div>
                       <div class="font-medium text-gray-900">ูพุงู ฺฉุงูู</div>
                       <div class="text-sm text-gray-600">ูพุงู ุจู ุตูุฑุช ฺฉุงูู ููุงุด ุฏุงุฏู ูโุดูุฏ.</div>
                     </div>
                   </div>
                   <div class="flex items-center space-x-3 space-x-reverse">
                     <input v-model="smartMessageForm.displayType" type="radio" value="short" class="text-purple-600 focus:ring-purple-500">
                     <div>
                       <div class="font-medium text-gray-900">ูพุงู ฺฉูุชุงู</div>
                       <div class="text-sm text-gray-600">ุฎูุงุตูโุง ุงุฒ ูุชู ูพุงู ููุงุด ุฏุงุฏู ูโุดูุฏ.</div>
                     </div>
                   </div>
                   <div class="flex items-center space-x-3 space-x-reverse">
                     <input v-model="smartMessageForm.displayType" type="radio" value="notification" class="text-purple-600 focus:ring-purple-500">
                     <div>
                       <div class="font-medium text-gray-900">ุงุนูุงู</div>
                       <div class="text-sm text-gray-600">ููุงุด ุฏุงุฑู ฺฉูฺฺฉ ุฏุฑ ุจุงูุง ุงุจุฒุงุฑฺฉ</div>
                     </div>
                   </div>
                 </div>
               </div>

               <!-- ุงุฑุณุงู ูพุงู ุงุฒ ุณูุช -->
               <div>
                 <label class="block text-sm font-medium text-gray-700 mb-2">ุงุฑุณุงู ูพุงู ุงุฒ ุณูุช</label>
                 <div class="flex items-center space-x-2 space-x-reverse">
                   <select v-model="smartMessageForm.sender" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                     <option value="random">ุงูุชุฎุงุจ ุชุตุงุฏู</option>
                     <option value="specific">ุงูุชุฎุงุจ ุฎุงุต</option>
                   </select>
                   <button class="p-2 text-gray-500 hover:text-gray-700">๐</button>
                 </div>
               </div>

               <!-- ุชูุธูุงุช ุงุถุงู -->
               <div class="space-y-4">
                 <div class="flex items-center justify-between">
                   <span class="text-sm font-medium text-gray-700">ุจุฑุง ูุฑ ุจุงุฒุฏุฏ ฺฉููุฏู ฺฉ ุจุงุฑ ุงุฑุณุงู</span>
                   <label class="relative inline-flex items-center cursor-pointer">
                     <input v-model="smartMessageForm.sendOncePerVisitor" type="checkbox" class="sr-only peer">
                     <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                   </label>
                 </div>
                 
                 <div class="flex items-center justify-between">
                   <span class="text-sm font-medium text-gray-700">ุงุฑุณุงู ุจู ููุฑุงู ุตุฏุง</span>
                   <label class="relative inline-flex items-center cursor-pointer">
                     <input v-model="smartMessageForm.withSound" type="checkbox" class="sr-only peer">
                     <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                   </label>
                 </div>
                 
                 <div class="flex items-center justify-between">
                   <span class="text-sm font-medium text-gray-700">ุฏุฑ ููุจุงู ูุฒ ุงุฑุณุงู ุดูุฏ</span>
                   <label class="relative inline-flex items-center cursor-pointer">
                     <input v-model="smartMessageForm.sendOnMobile" type="checkbox" class="sr-only peer">
                     <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                   </label>
                 </div>
               </div>
             </div>

             <!-- ุชุจ ุดุฑุท -->
             <div v-if="activeSmartMessageTab === 'condition'" class="space-y-6">
               <div>
                 <label class="block text-sm font-medium text-gray-700 mb-2">ุดุฑุท</label>
                 <p class="text-sm text-gray-600 mb-4">ุฏุฑ ฺู ุดุฑุงุท ุงุฑุณุงู ุดูุฏ</p>
                 
                 <select v-model="smartMessageForm.conditionType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 mb-4">
                   <option value="at_least_one">ุญุฏุงูู ฺฉ ุงุฒ ุดุฑุท ูุง ุฒุฑ ุฑุฎ ุฏูุฏ</option>
                   <option value="all">ุชูุงู ุดุฑุท ูุง ุฒุฑ ุฑุฎ ุฏูุฏ</option>
                 </select>

                 <!-- ูุณุช ุดุฑุทโูุง -->
                 <div class="space-y-3">
                   <div v-for="(condition, index) in smartMessageForm.conditions" :key="index" class="flex items-center space-x-2 space-x-reverse p-3 bg-gray-50 rounded-lg">
                     <button class="text-red-500 hover:text-red-700" @click="removeCondition(index)">โ</button>
                     <select v-model="condition.type" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                       <option value="time_on_page">ุฒูุงู ุฏุฑ ุตูุญู</option>
                       <option value="scroll_percentage">ุฏุฑุตุฏ ุงุณฺฉุฑูู</option>
                       <option value="page_visit">ุจุงุฒุฏุฏ ุตูุญู</option>
                     </select>
                     <input v-model="condition.value" type="number" class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                     <span class="text-sm text-gray-600">{{ getConditionUnit(condition.type) }}</span>
                   </div>
                 </div>

                 <!-- ุฏฺฉูู ุงูุฒูุฏู ุดุฑุท -->
                 <button class="flex items-center space-x-2 space-x-reverse text-purple-600 hover:text-purple-700 text-sm" @click="addCondition">
                   <span>+</span>
                   <span>ุงูุฒูุฏู ุดุฑุท</span>
                 </button>
               </div>
             </div>

             <!-- ุชุจ ุฒูุงู ุงูุชุดุงุฑ -->
             <div v-if="activeSmartMessageTab === 'publishTime'" class="space-y-6">
               <!-- ุดุฑูุน ุจู ุงุฑุณุงู -->
               <div>
                 <label class="block text-sm font-medium text-gray-700 mb-2">ุดุฑูุน ุจู ุงุฑุณุงู</label>
                 <div class="grid grid-cols-2 gap-6">
                   <input v-model="smartMessageForm.startDate" type="date" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                   <input v-model="smartMessageForm.startTime" type="time" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                 </div>
               </div>

               <!-- ูพุงุงู ุงุฑุณุงู -->
               <div>
                 <label class="block text-sm font-medium text-gray-700 mb-2">ูพุงุงู ุงุฑุณุงู</label>
                 <div class="space-y-3">
                   <div class="flex items-center space-x-3 space-x-reverse">
                     <input v-model="smartMessageForm.endType" type="radio" value="never" class="text-purple-600 focus:ring-purple-500">
                     <span class="text-sm text-gray-700">ูฺ ููุช</span>
                   </div>
                   <div class="flex items-center space-x-3 space-x-reverse">
                     <input v-model="smartMessageForm.endType" type="radio" value="specific" class="text-purple-600 focus:ring-purple-500">
                     <span class="text-sm text-gray-700">ุชูุธู ุฒูุงู ุฎุงุต</span>
                   </div>
                 </div>
                 
                 <div v-if="smartMessageForm.endType === 'specific'" class="mt-4 grid grid-cols-2 gap-6">
                   <input v-model="smartMessageForm.endDate" type="date" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                   <input v-model="smartMessageForm.endTime" type="time" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                 </div>
               </div>

               <!-- ุชูุธู ุฑูุฒ ู ุณุงุนุช -->
               <div>
                 <label class="block text-sm font-medium text-gray-700 mb-2">ุชูุธู ุฑูุฒ ู ุณุงุนุชูุง ฺฉู ุงู ฺุช ูุชูุงูุฏ ุงุฑุณุงู ุดูุฏ</label>
                 <div class="space-y-3">
                   <div class="flex items-center space-x-3 space-x-reverse">
                     <input v-model="smartMessageForm.scheduleType" type="radio" value="always" class="text-purple-600 focus:ring-purple-500">
                     <span class="text-sm text-gray-700">ูุฑ ุฑูุฒ ูุฑ ุณุงุนุช</span>
                   </div>
                   <div class="flex items-center space-x-3 space-x-reverse">
                     <input v-model="smartMessageForm.scheduleType" type="radio" value="working_hours" class="text-purple-600 focus:ring-purple-500">
                     <span class="text-sm text-gray-700">ุฏุฑ ุทูู ุฒูุงููุง ฺฉุงุฑ</span>
                   </div>
                   <div class="flex items-center space-x-3 space-x-reverse">
                     <input v-model="smartMessageForm.scheduleType" type="radio" value="non_working_hours" class="text-purple-600 focus:ring-purple-500">
                     <span class="text-sm text-gray-700">ุฏุฑ ุทูู ุฒูุงููุง ุบุฑฺฉุงุฑ</span>
                   </div>
                 </div>
               </div>
             </div>
           </div>
         </div>

         <!-- ููุชุฑ -->
         <div class="border-t border-gray-200 p-6">
           <div class="flex justify-end space-x-4 space-x-reverse">
             <button class="px-6 py-2 text-sm font-medium text-purple-600 bg-purple-50 border border-purple-200 rounded-md hover:bg-purple-100" @click="closeSmartMessageModal">
               ุงูุตุฑุงู
             </button>
             <button class="px-6 py-2 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-md hover:bg-purple-700" @click="saveSmartMessage">
               ุงูุชุดุงุฑ
             </button>
           </div>
         </div>
       </div>
     </div>

     <!-- ุงุฌุงุฏ ูุฑู -->
     <div v-if="activeTab === 'formBuilder'" class="space-y-6">
       <!-- ูุฏุฑ ุจููุด -->
       <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6 rounded-lg">
         <div class="flex justify-between items-start">
           <div class="flex-1">
             <h2 class="text-2xl font-bold mb-2">ุตูุญู ุงุฌุงุฏ ูุฑู ุณุงุนุงุช ฺฉุงุฑ ู ุบุฑ ฺฉุงุฑ</h2>
             <p class="text-purple-100">
               ุทุฑุงุญ ูุฑู ุงุทูุงุนุงุช ุขุบุงุฒ ูฺฉุงููู ุจุฑ ุงุณุงุณ ูุงุฒูุง ุฎูุฏุชุงู ุง ุฌูุน ุขูุฑ ูุฏูุง ุฎูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุฑุงฺุช
             </p>
           </div>
           <div class="flex flex-col space-y-3 space-y-reverse">
             <button class="bg-white text-purple-600 px-6 py-3 rounded-lg hover:bg-purple-50 transition-colors font-medium" @click="openCreateFormModal">
               ุงุฌุงุฏ ูุฑู ุฌุฏุฏ
             </button>
             <a href="#" class="text-purple-100 hover:text-white text-sm flex items-center space-x-2 space-x-reverse">
               <span>ุฑุงูููุง ุงุฌุงุฏ ูุฑู</span>
               <span>โ</span>
             </a>
           </div>
         </div>
       </div>

       <!-- ูุญุชูุง ุงุตู -->
       <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
         <!-- ุฌุฏูู ูุฑูโูุง -->
         <div class="overflow-x-auto">
           <table class="w-full">
             <thead>
               <tr class="border-b border-gray-200">
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ุนููุงู ูุฑู</th>
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ููุน ูุฑู</th>
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ูุถุนุช</th>
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ุชุนุฏุงุฏ ููุฏูุง</th>
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ุขุฎุฑู ุจู ุฑูุฒุฑุณุงู</th>
                 <th class="text-right py-3 px-4 font-medium text-gray-900">ุนููุงุช</th>
               </tr>
             </thead>
             <tbody>
               <tr v-for="form in forms" :key="form.id" class="border-b border-gray-100 hover:bg-gray-50">
                 <td class="py-4 px-4 text-gray-900">{{ form.title }}</td>
                 <td class="py-4 px-4 text-gray-600">{{ form.type }}</td>
                 <td class="py-4 px-4">
                   <div class="flex items-center space-x-2 space-x-reverse">
                     <div class="relative">
                       <select v-model="form.status" class="appearance-none bg-transparent border-none text-sm focus:outline-none">
                         <option value="active">ูุนุงู</option>
                         <option value="inactive">ุบุฑูุนุงู</option>
                       </select>
                       <div class="absolute inset-y-0 left-0 flex items-center pointer-events-none">
                         <span class="text-gray-400">โผ</span>
                       </div>
                     </div>
                     <div v-if="form.status === 'active'" class="w-2 h-2 bg-green-500 rounded-full"></div>
                   </div>
                 </td>
                 <td class="py-4 px-4 text-gray-600">{{ form.fieldCount }} ููุฏ</td>
                 <td class="py-4 px-4 text-gray-600 text-sm">{{ form.lastUpdate }}</td>
                 <td class="py-4 px-4">
                   <div class="flex items-center space-x-2 space-x-reverse">
                     <button class="text-gray-500 hover:text-blue-600" @click="editForm(form)">
                       <span class="text-lg">โ๏ธ</span>
                     </button>
                     <button class="text-gray-500 hover:text-red-600" @click="deleteForm(form.id)">
                       <span class="text-lg">๐๏ธ</span>
                     </button>
                   </div>
                 </td>
               </tr>
             </tbody>
           </table>
         </div>

         <!-- ูพุงู ุฎุงู -->
         <div v-if="forms.length === 0" class="text-center py-12">
           <div class="text-gray-400 text-6xl mb-4">๐</div>
           <p class="text-gray-500 font-medium">ูฺ ูุฑู ุชุนุฑู ูุดุฏู ุงุณุช</p>
           <p class="text-gray-400 text-sm mt-2">ุจุฑุง ุดุฑูุนุ ฺฉ ูุฑู ุฌุฏุฏ ุงุฌุงุฏ ฺฉูุฏ</p>
         </div>
       </div>
     </div>

     <!-- ููุฏุงู ุงูุฒูุฏู ุชู ุฌุฏุฏ -->
     <div v-if="showCreateTeamModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
       <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
         <div class="flex justify-between items-center mb-6">
           <h2 class="text-xl font-bold text-gray-900">ุงูุฒูุฏู ุชู ุฌุฏุฏ</h2>
           <button class="text-gray-400 hover:text-gray-600" @click="showCreateTeamModal = false">
             <span class="text-2xl">ร</span>
           </button>
         </div>

         <div class="space-y-6">
           <!-- ุงุทูุงุนุงุช ุชู -->
           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
             <div>
               <label class="block text-sm font-medium text-gray-700 mb-2">ูุงู ุชู</label>
               <input v-model="newTeam.name" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="ูุงู ุชู">
             </div>
             <div>
               <label class="block text-sm font-medium text-gray-700 mb-2">ุฑูฺฏ ุชู</label>
               <input v-model="newTeam.color" type="color" class="w-full h-10 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
             </div>
           </div>

           <!-- ููฺฏู ุชู -->
           <div class="flex items-center space-x-4 space-x-reverse">
             <div class="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center">
               <span class="text-white text-2xl">๐ฌ</span>
             </div>
             <div class="space-y-2">
               <button class="text-purple-600 hover:text-purple-700 text-sm">ุจุงุฑฺฏุฐุงุฑ ููฺฏู</button>
               <button class="text-red-600 hover:text-red-700 text-sm">ุญุฐู ุชุตูุฑ</button>
             </div>
           </div>

           <!-- ุงูุฒูุฏู ุงูพุฑุงุชูุฑ -->
           <div>
             <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุฒูุฏู ุงูพุฑุงุชูุฑ</label>
             <div class="relative">
               <input v-model="operatorSearch" type="text" class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="ุงูพุฑุงุชูุฑูุง ุฎูุฏ ุฑุง ุจู ุงู ุชู ุงุถุงูู ฺฉูุฏ">
               <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                 <span class="text-gray-400">๐</span>
               </div>
             </div>
           </div>

           <!-- ูุณุช ุงูพุฑุงุชูุฑูุง -->
           <div v-if="selectedOperators.length > 0">
             <h3 class="text-sm font-medium text-gray-700 mb-2">ุงูพุฑุงุชูุฑูุง</h3>
             <div class="space-y-2">
               <div v-for="operator in selectedOperators" :key="operator.id" class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                 <div class="flex items-center space-x-3 space-x-reverse">
                   <div class="w-8 h-8 bg-orange-400 rounded-full flex items-center justify-center">
                     <span class="text-white text-sm">๐ค</span>
                   </div>
                   <div>
                     <p class="text-sm font-medium text-gray-900">{{ operator.name }}</p>
                     <p class="text-xs text-gray-600">{{ operator.email }}</p>
                   </div>
                 </div>
                 <button class="text-red-600 hover:text-red-700 text-sm" @click="removeOperator(operator.id)">ุญุฐู</button>
               </div>
             </div>
           </div>
         </div>

         <!-- ุฏฺฉููโูุง ุนููุงุช -->
         <div class="flex justify-end space-x-4 space-x-reverse mt-6">
           <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200" @click="showCreateTeamModal = false">
             ุงูุตุฑุงู
           </button>
           <button class="px-4 py-2 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-md hover:bg-purple-700" @click="createTeam">
             ุชุงุฏ
           </button>
         </div>
       </div>
     </div>

     <!-- ููุฏุงู ูุฑุงุด ุชู -->
     <div v-if="showEditTeamModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
       <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
         <div class="flex justify-between items-center mb-6">
           <h2 class="text-xl font-bold text-gray-900">ูุฑุงุด ุชู</h2>
           <button class="text-gray-400 hover:text-gray-600" @click="showEditTeamModal = false">
             <span class="text-2xl">ร</span>
           </button>
         </div>

         <div class="space-y-6">
           <!-- ุงุทูุงุนุงุช ุชู -->
           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
             <div>
               <label class="block text-sm font-medium text-gray-700 mb-2">ูุงู ุชู</label>
               <input v-model="currentTeam.name" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="ูุงู ุชู">
             </div>
             <div>
               <label class="block text-sm font-medium text-gray-700 mb-2">ุฑูฺฏ ุชู</label>
               <input v-model="currentTeam.color" type="color" class="w-full h-10 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
             </div>
           </div>

           <!-- ููฺฏู ุชู -->
           <div class="flex items-center space-x-4 space-x-reverse">
             <div class="w-16 h-16 rounded-full flex items-center justify-center" :style="{ backgroundColor: currentTeam.color }">
               <span class="text-white text-2xl">{{ currentTeam.icon }}</span>
             </div>
             <div class="space-y-2">
               <button class="text-purple-600 hover:text-purple-700 text-sm">ุจุงุฑฺฏุฐุงุฑ ููฺฏู</button>
               <button class="text-red-600 hover:text-red-700 text-sm">ุญุฐู ุชุตูุฑ</button>
             </div>
           </div>

           <!-- ุงูุฒูุฏู ุงูพุฑุงุชูุฑ -->
           <div>
             <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุฒูุฏู ุงูพุฑุงุชูุฑ</label>
             <div class="relative">
               <input v-model="operatorSearch" type="text" class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="ุงูพุฑุงุชูุฑูุง ุฎูุฏ ุฑุง ุจู ุงู ุชู ุงุถุงูู ฺฉูุฏ">
               <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                 <span class="text-gray-400">๐</span>
               </div>
             </div>
           </div>

           <!-- ูุณุช ุงูพุฑุงุชูุฑูุง -->
           <div v-if="currentTeam.operators && currentTeam.operators.length > 0">
             <h3 class="text-sm font-medium text-gray-700 mb-2">ุงูพุฑุงุชูุฑูุง</h3>
             <div class="space-y-2">
               <div v-for="operator in currentTeam.operators" :key="operator.id" class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                 <div class="flex items-center space-x-3 space-x-reverse">
                   <div class="w-8 h-8 bg-orange-400 rounded-full flex items-center justify-center">
                     <span class="text-white text-sm">๐ค</span>
                   </div>
                   <div>
                     <p class="text-sm font-medium text-gray-900">{{ operator.name }}</p>
                     <p class="text-xs text-gray-600">{{ operator.email }}</p>
                   </div>
                 </div>
                 <button class="text-red-600 hover:text-red-700 text-sm" @click="removeOperatorFromTeam(operator.id)">ุญุฐู</button>
               </div>
             </div>
           </div>
         </div>

         <!-- ุฏฺฉููโูุง ุนููุงุช -->
         <div class="flex justify-end space-x-4 space-x-reverse mt-6">
           <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200" @click="showEditTeamModal = false">
             ุงูุตุฑุงู
           </button>
           <button class="px-4 py-2 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-md hover:bg-purple-700" @click="updateTeam">
             ุชุงุฏ
           </button>
         </div>
       </div>
     </div>

     <!-- ููุฏุงู ุงุฌุงุฏ/ูุฑุงุด ุนููุงุช ุฌุฏุฏ -->
     <div v-if="showCreateOperationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
       <div class="bg-white rounded-lg p-6 w-full max-w-6xl mx-4 max-h-[90vh] overflow-y-auto">
         <div class="flex justify-between items-center mb-6">
           <h2 class="text-xl font-bold text-gray-900">{{ isEditingOperation ? 'ูุฑุงุด ุนููุงุช' : 'ุงุฌุงุฏ ุนููุงุช ุฌุฏุฏ' }}</h2>
           <button class="text-gray-400 hover:text-gray-600" @click="closeOperationModal">
             <span class="text-2xl">ร</span>
           </button>
         </div>

         <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
           <!-- ุณุชูู ุงุตู - ูุฑู ุนููุงุช -->
           <div class="lg:col-span-2 space-y-6">
             <!-- ุงุฑุณุงู ุฏุฑ ูฺฉุงููุงุช -->
             <div>
               <label class="block text-sm font-medium text-gray-700 mb-2">ุงุฑุณุงู ุฏุฑ ูฺฉุงููุงุช</label>
               <select v-model="operationForm.conversationType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                 <option value="awaiting">ุฏุฑ ุงูุชุธุงุฑ ูพุงุณุฎ</option>
                 <option value="active">ูฺฉุงููุงุช ูุนุงู</option>
                 <option value="all">ุชูุงู ูฺฉุงููุงุช</option>
               </select>
             </div>

             <!-- ููุน ุงุนูุงู ุนููุงุช -->
             <div>
               <label class="block text-sm font-medium text-gray-700 mb-2">ููุน ุงุนูุงู ุนููุงุช</label>
               <select v-model="operationForm.operationType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                 <option value="all_departments">ุงุนูุงู ุจุฑ ุฑู ุชูุงู ุฏูพุงุฑุชูุงู ูุง</option>
                 <option value="specific_departments">ุฏูพุงุฑุชูุงู ูุง ุฎุงุต</option>
                 <option value="specific_teams">ุชู ูุง ุฎุงุต</option>
               </select>
             </div>

             <!-- ุงุฑุณุงู ุจู ููุฑุงู ุตุฏุง -->
             <div class="flex items-center justify-between">
               <span class="text-sm font-medium text-gray-700">ุงุฑุณุงู ุจู ููุฑุงู ุตุฏุง</span>
               <label class="relative inline-flex items-center cursor-pointer">
                 <input v-model="operationForm.withSound" type="checkbox" class="sr-only peer">
                 <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
               </label>
             </div>

             <!-- ุฒูุงู ุงูุชุธุงุฑ -->
             <div>
               <label class="block text-sm font-medium text-gray-700 mb-2">ุฒูุงู ุงูุชุธุงุฑ</label>
               <div class="flex items-center space-x-2 space-x-reverse">
                 <input 
                   v-model="operationForm.waitTime" 
                   type="number" 
                   min="0"
                   class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
                 >
                 <span class="text-sm text-gray-700">ุซุงูู</span>
               </div>
             </div>

             <!-- ูุชู ูพุงู ูุจู ุงุฒ ูพุงุณุฎ -->
             <div>
               <label class="block text-sm font-medium text-gray-700 mb-2">ูุชู ูพุงู ูุจู ุงุฒ ูพุงุณุฎ</label>
               
               <!-- ูพุดโููุงุด ูพุงู -->
               <div class="mb-2 p-3 bg-gray-50 rounded-lg border">
                 <p class="text-sm text-gray-700">{{ operationForm.messageText || 'ุจู ุณุงุช ูุง ุฎูุด ุงููุฏูุ ุฏุฑ ุฎุฏูุชุชูู ูุณุชู ๐' }}</p>
               </div>
               
               <textarea 
                 v-model="operationForm.messageText" 
                 rows="6" 
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
                 placeholder="ูพุงู ุฎูุฏฺฉุงุฑ ุจุฑุง ฺฉุงุฑุจุฑุงู ุฏุฑ ุญุงูุช ุงูุชุธุงุฑ"
               ></textarea>
               
               <!-- ููุงุฑ ุงุจุฒุงุฑ ูุฑูุช -->
               <div class="flex items-center space-x-2 space-x-reverse mt-2 p-2 bg-gray-50 rounded">
                 <button class="p-1 hover:bg-gray-200 rounded">๐ผ๏ธ</button>
                 <button class="p-1 hover:bg-gray-200 rounded font-bold">B</button>
                 <button class="p-1 hover:bg-gray-200 rounded italic">I</button>
                 <button class="p-1 hover:bg-gray-200 rounded underline">U</button>
                 <button class="p-1 hover:bg-gray-200 rounded">โฐ</button>
               </div>
               
               <!-- ุดูุงุฑูุฏู ฺฉุงุฑุงฺฉุชุฑ -->
               <div class="text-sm text-gray-500 mt-2">
                 ฺฉุงุฑุงฺฉุชุฑ ุจุงู ูุงูุฏู: {{ 500 - (operationForm.messageText?.length || 0) }}
               </div>
             </div>

             <!-- ุงุฌุงุฏ ูุฑู -->
             <div>
               <label class="block text-sm font-medium text-gray-700 mb-2">ุงุฌุงุฏ ูุฑู</label>
               <button class="flex items-center space-x-2 space-x-reverse px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                 <span class="text-lg">+</span>
                 <span>ุงุถุงูู ฺฉุฑุฏู ููุฏ ุฌุฏุฏ</span>
               </button>
             </div>
           </div>

           <!-- ุณุชูู ฺฉูุงุฑ - ูพุดโููุงุด -->
           <div class="space-y-6">
             <!-- ุฏฺฉูู ูุณุช ุนููุงุช -->
             <button class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition-colors font-medium">
               ูุณุช ุนููุงุช ูุง
             </button>

             <!-- ฺฉุงุฑุช ูพุดโููุงุด -->
             <div class="bg-purple-600 text-white p-6 rounded-lg relative">
               <button class="absolute top-2 left-2 text-white hover:text-purple-200">โ</button>
               <p class="text-center">ูพุงุณุฎฺฏู ุณูุงูุงุช ุดูุง ูุณุชู.</p>
               <div class="flex justify-center space-x-2 space-x-reverse mt-2">
                 <div class="w-3 h-3 bg-white rounded-full opacity-60"></div>
                 <div class="w-3 h-3 bg-white rounded-full opacity-60"></div>
                 <div class="w-3 h-3 bg-white rounded-full opacity-60"></div>
               </div>
             </div>

             <!-- ูพุดโููุงุด ูพุงู -->
             <div class="bg-gray-50 p-6 rounded-lg">
               <p class="text-gray-700 text-sm">{{ operationForm.messageText || 'ุจู ุณุงุช ูุง ุฎูุด ุงููุฏูุ ุฏุฑ ุฎุฏูุชุชูู ูุณุชู ๐' }}</p>
             </div>
           </div>
         </div>

         <!-- ุฏฺฉููโูุง ุนููุงุช -->
         <div class="flex justify-end space-x-4 space-x-reverse mt-8">
           <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200" @click="closeOperationModal">
             ุงูุตุฑุงู
           </button>
           <button class="px-4 py-2 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-md hover:bg-purple-700" @click="saveOperation">
             ุงูุชุดุงุฑ
           </button>
         </div>
       </div>
     </div>

     <!-- ุฏฺฉููโูุง ุนููุงุช -->
     <div class="mt-8 flex justify-end space-x-4 space-x-reverse">
       <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" @click="resetForm">
         ุจุงุฒูุดุงู
       </button>
       <button class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500" @click="saveAllSettings">
         ุฐุฎุฑู ุชูุธูุงุช
       </button>
     </div>
   </div>

   <!-- ููุฏุงู ุงุฌุงุฏ/ูุฑุงุด ูุฑู -->
   <div v-if="showCreateFormModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
     <div class="bg-white rounded-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-hidden flex flex-col">
       <!-- ูุฏุฑ ููุฏุงู -->
       <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6">
         <div class="flex justify-between items-center">
           <button class="text-white hover:text-purple-200 text-sm" @click="closeFormModal">
             ุจุงุฒฺฏุดุช
           </button>
           <div class="flex items-center space-x-4 space-x-reverse">
             <h2 class="text-xl font-bold">{{ isEditingForm ? 'ูุฑุงุด ูุฑู' : 'ุงุฌุงุฏ ูุฑู ุฌุฏุฏ' }}</h2>
             <input v-model="formBuilderForm.isDisabled" type="checkbox" class="rounded border-white text-purple-600 focus:ring-purple-500">
           </div>
         </div>
       </div>

       <!-- ูุญุชูุง ุงุตู -->
       <div class="flex-1 flex overflow-hidden">
         <!-- ุจุฎุด ฺูพ - ูพุดโููุงุด ูุฑู -->
         <div class="w-1/2 bg-gray-50 p-6 flex flex-col">
           <!-- ูพุดโููุงุด ูุฑู -->
           <div class="flex-1 flex items-center justify-center">
             <div class="relative">
               <!-- ุฏุงุฑู ุณูุฏ ุจุฒุฑฺฏ -->
               <div class="w-80 h-80 bg-white rounded-full shadow-lg flex items-center justify-center relative">
                 <!-- ูุฑู ูพุดโููุงุด -->
                 <div class="bg-white p-6 rounded-lg max-w-48 mb-4 border border-gray-200">
                   <h3 class="text-sm font-medium text-gray-900 mb-3">{{ formBuilderForm.title || 'ุนููุงู ูุฑู' }}</h3>
                   <p class="text-xs text-gray-600 mb-4">{{ formBuilderForm.content || 'ุชูุถุญุงุช ูุฑู' }}</p>
                   
                   <!-- ููุฏูุง ูุฑู -->
                   <div class="space-y-3">
                     <div v-for="field in formBuilderForm.fields" :key="field.id" class="space-y-1">
                       <label class="text-xs text-gray-700">{{ field.label }}{{ field.required ? ' *' : '' }}</label>
                       <input v-if="field.type === 'text'" type="text" :placeholder="field.label" class="w-full text-xs p-2 border border-gray-300 rounded">
                       <input v-else-if="field.type === 'email'" type="email" :placeholder="field.label" class="w-full text-xs p-2 border border-gray-300 rounded">
                       <input v-else-if="field.type === 'phone'" type="tel" :placeholder="field.label" class="w-full text-xs p-2 border border-gray-300 rounded">
                       <textarea v-else-if="field.type === 'textarea'" :placeholder="field.label" class="w-full text-xs p-2 border border-gray-300 rounded" rows="3"></textarea>
                     </div>
                   </div>
                   
                   <button class="w-full mt-4 bg-purple-600 text-white text-xs py-2 rounded hover:bg-purple-700">
                     ุงุฑุณุงู
                   </button>
                 </div>
                 
                 <!-- ููุฏ ูุฑูุฏ -->
                 <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 w-64">
                   <div class="bg-white border border-gray-300 rounded-lg p-3 flex items-center space-x-2 space-x-reverse">
                     <span class="text-gray-400">๐ฌ</span>
                     <span class="text-gray-400">๐</span>
                     <span class="text-gray-400">@</span>
                     <input type="text" placeholder="ุงูุฌุง ุชุงูพ ฺฉูุฏ." class="flex-1 text-sm focus:outline-none">
                   </div>
                 </div>
               </div>
               
               <!-- ุขฺฉูู ูุฑู ุจููุด -->
               <div class="absolute -right-8 -top-8 w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center">
                 <span class="text-white text-2xl">๐</span>
               </div>
             </div>
           </div>
           
           <!-- ุฎูุงุตู ุชูุธูุงุช -->
           <div class="mt-6 space-y-2">
             <div class="flex justify-between text-sm">
               <span class="text-gray-600">ููุน ูุฑู:</span>
               <span class="text-gray-900">{{ formBuilderForm.type || 'ุงูุชุฎุงุจ ูุดุฏู' }}</span>
             </div>
             <div class="flex justify-between text-sm">
               <span class="text-gray-600">ุชุนุฏุงุฏ ููุฏูุง:</span>
               <span class="text-gray-900">{{ formBuilderForm.fields.length }} ููุฏ</span>
             </div>
             <div class="flex justify-between text-sm">
               <span class="text-gray-600">ูุถุนุช:</span>
               <span class="text-gray-900">{{ formBuilderForm.isDisabled ? 'ุบุฑูุนุงู' : 'ูุนุงู' }}</span>
             </div>
           </div>
         </div>

         <!-- ุจุฎุด ุฑุงุณุช - ูุฑู ุชูุธูุงุช -->
         <div class="w-1/2 p-6 overflow-y-auto">
           <div class="space-y-6">
             <!-- ุงุทูุงุนุงุช ุงุตู -->
             <div>
               <h3 class="text-lg font-medium text-gray-900 mb-4">ุงุทูุงุนุงุช ุงุตู</h3>
               
               <!-- ุนููุงู ูุฑู -->
               <div class="mb-4">
                 <label class="block text-sm font-medium text-gray-700 mb-2">ุนููุงู ูุฑู *</label>
                 <input v-model="formBuilderForm.title" type="text" placeholder="ุนููุงู ูุฑู ุฑุง ูุงุฑุฏ ฺฉูุฏ" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
               </div>
               
               <!-- ููุน ูุฑู -->
               <div class="mb-4">
                 <label class="block text-sm font-medium text-gray-700 mb-2">ููุน ูุฑู *</label>
                 <select v-model="formBuilderForm.type" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                   <option value="">ุงูุชุฎุงุจ ฺฉูุฏ</option>
                   <option value="ูุฑู ุณุงุนุงุช ฺฉุงุฑ">ูุฑู ุณุงุนุงุช ฺฉุงุฑ</option>
                   <option value="ูุฑู ุงุทูุงุนุงุช ุชูุงุณ">ูุฑู ุงุทูุงุนุงุช ุชูุงุณ</option>
                   <option value="ูุฑู ุณูุงุฑุด">ูุฑู ุณูุงุฑุด</option>
                 </select>
               </div>
               
               <!-- ูุญุชูุง ูุฑู -->
               <div class="mb-4">
                 <label class="block text-sm font-medium text-gray-700 mb-2">ุชูุถุญุงุช ูุฑู</label>
                 <textarea v-model="formBuilderForm.content" placeholder="ุชูุถุญุงุช ูุฑู ุฑุง ูุงุฑุฏ ฺฉูุฏ" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"></textarea>
               </div>
             </div>

             <!-- ุชูุธูุงุช ูุฑู -->
             <div>
               <h3 class="text-lg font-medium text-gray-900 mb-4">ุชูุธูุงุช ูุฑู</h3>
               
               <div class="space-y-3">
                 <label class="flex items-center">
                   <input v-model="formBuilderForm.isRequired" type="checkbox" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                   <span class="mr-2 text-sm text-gray-700">ูุฑู ุงุฌุจุงุฑ ุงุณุช</span>
                 </label>
                 
                 <label class="flex items-center">
                   <input v-model="formBuilderForm.sendBeforeFirstMessage" type="checkbox" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                   <span class="mr-2 text-sm text-gray-700">ุงุฑุณุงู ูุจู ุงุฒ ูพุงู ุงูู</span>
                 </label>
                 
                 <label class="flex items-center">
                   <input v-model="formBuilderForm.isDisabled" type="checkbox" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                   <span class="mr-2 text-sm text-gray-700">ุบุฑูุนุงู ฺฉุฑุฏู ูุฑู</span>
                 </label>
               </div>
             </div>

             <!-- ูุฏุฑุช ููุฏูุง -->
             <div>
               <div class="flex justify-between items-center mb-4">
                 <h3 class="text-lg font-medium text-gray-900">ููุฏูุง ูุฑู</h3>
                 <button class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 text-sm" @click="addFormField">
                   ุงูุฒูุฏู ููุฏ
                 </button>
               </div>
               
               <div class="space-y-4">
                 <div v-for="(field, index) in formBuilderForm.fields" :key="index" class="border border-gray-200 rounded-lg p-6">
                   <div class="flex justify-between items-start mb-3">
                     <h4 class="text-sm font-medium text-gray-900">ููุฏ {{ index + 1 }}</h4>
                     <button class="text-red-500 hover:text-red-700 text-sm" @click="removeFormField(index)">
                       ุญุฐู
                     </button>
                   </div>
                   
                   <div class="grid grid-cols-2 gap-3">
                     <div>
                       <label class="block text-xs text-gray-700 mb-1">ููุน ููุฏ</label>
                       <select v-model="field.type" class="w-full p-2 border border-gray-300 rounded text-sm">
                         <option value="text">ูุชู</option>
                         <option value="email">ุงูู</option>
                         <option value="phone">ุชููู</option>
                         <option value="textarea">ูุชู ฺูุฏ ุฎุท</option>
                       </select>
                     </div>
                     <div>
                       <label class="block text-xs text-gray-700 mb-1">ุจุฑฺุณุจ</label>
                       <input v-model="field.label" type="text" placeholder="ุจุฑฺุณุจ ููุฏ" class="w-full p-2 border border-gray-300 rounded text-sm">
                     </div>
                   </div>
                   
                   <div class="mt-3">
                     <label class="flex items-center">
                       <input v-model="field.required" type="checkbox" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                       <span class="mr-2 text-xs text-gray-700">ููุฏ ุงุฌุจุงุฑ</span>
                     </label>
                   </div>
                 </div>
               </div>
               
               <div v-if="formBuilderForm.fields.length === 0" class="text-center py-8 text-gray-500">
                 <div class="text-4xl mb-2">๐</div>
                 <p class="text-sm">ูฺ ููุฏ ุชุนุฑู ูุดุฏู ุงุณุช</p>
                 <p class="text-xs">ุจุฑุง ุดุฑูุนุ ฺฉ ููุฏ ุฌุฏุฏ ุงุถุงูู ฺฉูุฏ</p>
               </div>
             </div>
           </div>
         </div>
       </div>

       <!-- ููุชุฑ ููุฏุงู -->
       <div class="bg-gray-50 px-6 py-4 flex justify-between items-center">
         <button class="px-4 py-2 text-gray-600 hover:text-gray-800" @click="closeFormModal">
           ุงูุตุฑุงู
         </button>
         <div class="flex space-x-3 space-x-reverse">
           <button class="px-4 py-2 text-gray-600 hover:text-gray-800" @click="resetFormBuilderForm">
             ุจุงุฒูุดุงู
           </button>
           <button class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700" @click="saveForm">
             {{ isEditingForm ? 'ูุฑุงุด' : 'ุงุฌุงุฏ' }}
           </button>
         </div>
       </div>
     </div>




   </div>
   <!-- ูุฑุฎ ูพุงู -->
  <div v-if="activeTab === 'rateLimit'" class="space-y-6">
    <div class="bg-blue-600 text-white p-6 rounded-lg">
      <h2 class="text-2xl font-bold mb-2">ุชูุธู ูุฑุฎ ูพุงู</h2>
      <p class="text-blue-100">ุชุนุฏุงุฏ ูพุงู ูุฌุงุฒ ุฏุฑ ุฏููู ุจุฑุง ูุฑ ููุด ฺฉุงุฑุจุฑ ุฑุง ุชุนู ฺฉูุฏ.</p>
    </div>
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ูุดุชุฑ (customer)</label>
          <input v-model.number="rateLimit.customer" type="number" min="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ุงูพุฑุงุชูุฑ (operator)</label>
          <input v-model.number="rateLimit.operator" type="number" min="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ุงุฏูู (admin)</label>
          <input v-model.number="rateLimit.admin" type="number" min="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ุจุงุฒู ุฒูุงู (ุซุงูู)</label>
          <input v-model.number="rateLimit.window" type="number" min="10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" />
        </div>
      </div>
      <p class="text-sm text-gray-500">ุฏุฑ ุตูุฑุช ุนุจูุฑ ฺฉุงุฑุจุฑ ุงุฒ ุญุฏ ูุฌุงุฒุ ูพุงู ุงู ุฑุฏ ุดุฏู ู ุฎุทุง <code>rate limit exceeded</code> ุฏุฑุงูุช ูโฺฉูุฏ. ูพุณ ุงุฒ ฺฏุฐุดุช ฺฉ ุฏููู ุงูฺฉุงู ุงุฑุณุงู ูุฌุฏุฏ ูุฌูุฏ ุฏุงุฑุฏ.</p>
      <div class="flex justify-end">
        <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium" @click="saveRateLimit">ุซุจุช ุชุบุฑุงุช</button>
      </div>
    </div>
  </div>

  <!-- ุงููุช ฺุช -->
  <div v-if="activeTab === 'security'" class="space-y-6">
    <div class="bg-red-600 text-white p-6 rounded-lg">
      <h2 class="text-2xl font-bold mb-2">๐ก๏ธ ุชูุธูุงุช ุงููุช ฺุช</h2>
      <p class="text-red-100">ูุฏุฑุช ุชูุธูุงุช ุงููุช ุจุฑุง ูุญุงูุธุช ุงุฒ ุณุณุชู ฺุช ุฏุฑ ุจุฑุงุจุฑ ุญููุงุช ูุฎุฑุจ</p>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- ุชูุธูุงุช ุนููู ุงููุช -->
      <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">๐ง ุชูุธูุงุช ุนููู</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ุญุฏุงฺฉุซุฑ ุทูู ูพุงู (ฺฉุงุฑุงฺฉุชุฑ)</label>
            <input
v-model.number="securitySettings.maxMessageLength" type="number" min="100" max="5000" 
                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm" />
            <p class="text-xs text-gray-500 mt-1">ูพุดโูุฑุถ: 1000 ฺฉุงุฑุงฺฉุชุฑ</p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ูุฏุช ูุณุฏูุฏ ฺฉุฑุฏู (ุฏููู)</label>
            <input
v-model.number="securitySettings.blockDuration" type="number" min="1" max="1440" 
                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm" />
            <p class="text-xs text-gray-500 mt-1">ูุฏุช ูุณุฏูุฏ ฺฉุฑุฏู ุจุฑุง ุชูุฏุฏุงุช critical (ูพุดโูุฑุถ: 10 ุฏููู)</p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ูุฏุช cooldown (ุซุงูู)</label>
            <input
v-model.number="securitySettings.cooldownDuration" type="number" min="10" max="300" 
                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm" />
            <p class="text-xs text-gray-500 mt-1">ูุฏุช cooldown ุจุฑุง ุชูุฏุฏุงุช high (ูพุดโูุฑุถ: 30 ุซุงูู)</p>
          </div>
          
          <div class="flex items-center">
            <input
id="strictMode" v-model="securitySettings.strictMode" type="checkbox"
                   class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded" />
            <label for="strictMode" class="mr-2 block text-sm text-gray-900">ุญุงูุช ุงููุช ุณุฎุช</label>
          </div>
          <p class="text-xs text-gray-500">ุฏุฑ ุญุงูุช ุณุฎุชุ ููุชุฑูุง ุจุดุชุฑ ูุนุงู ูโุดูุฏ</p>
        </div>
      </div>

      <!-- ูุฑูุชโูุง ูุงู ูุฌุงุฒ -->
      <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">๐ ูุฑูุชโูุง ูุงู ูุฌุงุฒ</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ุงููุงุน ูุงู ูุฌุงุฒ</label>
            <div class="space-y-2">
              <div
v-for="(fileType, index) in securitySettings.allowedFileTypes" :key="index" 
                   class="flex items-center justify-between p-2 bg-gray-50 rounded">
                <span class="text-sm font-mono">{{ fileType }}</span>
                <button class="text-red-600 hover:text-red-800" @click="removeFileType(index)">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
            </div>
            <div class="flex mt-2">
              <input
v-model="newFileType" type="text" placeholder="ูุซุงู: image/png" 
                     class="flex-1 rounded-r-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm" 
                     @keydown.enter="addFileType" />
              <button
class="px-3 py-2 bg-red-600 text-white rounded-l-md hover:bg-red-700 text-sm" 
                      @click="addFileType">
                ุงูุฒูุฏู
              </button>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ุญุฏุงฺฉุซุฑ ุงูุฏุงุฒู ูุงู (MB)</label>
            <input
v-model.number="securitySettings.maxFileSize" type="number" min="1" max="100" 
                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm" />
            <p class="text-xs text-gray-500 mt-1">ูพุดโูุฑุถ: 5 ูฺฏุงุจุงุช</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ฺฉููุงุช ู ุงูฺฏููุง ููููุน -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">๐ซ ฺฉููุงุช ู ุงูฺฏููุง ููููุน</h3>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- ฺฉููุงุช ููููุน -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ฺฉููุงุช ููููุน</label>
          <div class="space-y-2 max-h-40 overflow-y-auto">
            <div
v-for="(word, index) in securitySettings.bannedWords" :key="index" 
                 class="flex items-center justify-between p-2 bg-gray-50 rounded">
              <span class="text-sm">{{ word }}</span>
              <button class="text-red-600 hover:text-red-800" @click="removeBannedWord(index)">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
          </div>
          <div class="flex mt-2">
            <input
v-model="newBannedWord" type="text" placeholder="ฺฉููู ููููุน ุฌุฏุฏ" 
                   class="flex-1 rounded-r-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm" 
                   @keydown.enter="addBannedWord" />
            <button
class="px-3 py-2 bg-red-600 text-white rounded-l-md hover:bg-red-700 text-sm" 
                    @click="addBannedWord">
              ุงูุฒูุฏู
            </button>
          </div>
        </div>

        <!-- URL ูุง ูุดฺฉูฺฉ -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุฏุงูููโูุง ูุณุฏูุฏ</label>
          <div class="space-y-2 max-h-40 overflow-y-auto">
            <div
v-for="(domain, index) in securitySettings.blockedDomains" :key="index" 
                 class="flex items-center justify-between p-2 bg-gray-50 rounded">
              <span class="text-sm font-mono">{{ domain }}</span>
              <button class="text-red-600 hover:text-red-800" @click="removeBlockedDomain(index)">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
          </div>
          <div class="flex mt-2">
            <input
v-model="newBlockedDomain" type="text" placeholder="ูุซุงู: evil.com" 
                   class="flex-1 rounded-r-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm" 
                   @keydown.enter="addBlockedDomain" />
            <button
class="px-3 py-2 bg-red-600 text-white rounded-l-md hover:bg-red-700 text-sm" 
                    @click="addBlockedDomain">
              ุงูุฒูุฏู
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ุขูุงุฑ ุงููุช -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">๐ ุขูุงุฑ ุงููุช (24 ุณุงุนุช ฺฏุฐุดุชู)</h3>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="bg-blue-50 p-6 rounded-lg">
          <div class="text-2xl font-bold text-blue-600">{{ securityStats.totalMessages }}</div>
          <div class="text-sm text-blue-600">ฺฉู ูพุงูโูุง</div>
        </div>
        <div class="bg-red-50 p-6 rounded-lg">
          <div class="text-2xl font-bold text-red-600">{{ securityStats.blockedMessages }}</div>
          <div class="text-sm text-red-600">ูพุงูโูุง ูุณุฏูุฏ</div>
        </div>
        <div class="bg-orange-50 p-6 rounded-lg">
          <div class="text-2xl font-bold text-orange-600">{{ securityStats.suspiciousUsers }}</div>
          <div class="text-sm text-orange-600">ฺฉุงุฑุจุฑุงู ูุดฺฉูฺฉ</div>
        </div>
        <div class="bg-green-50 p-6 rounded-lg">
          <div class="text-2xl font-bold text-green-600">{{ securityStats.threatLevel }}</div>
          <div class="text-sm text-green-600">ุณุทุญ ุชูุฏุฏ</div>
        </div>
      </div>
    </div>

    <!-- ุฏฺฉููโูุง ุนููุงุช -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
      <div class="flex flex-wrap gap-6 justify-between items-center">
        <div class="flex flex-wrap gap-2">
          <button
class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium" 
                  @click="testSecurity">
            ๐งช ุชุณุช ุงููุช
          </button>
          <button
class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium" 
                  @click="resetToDefaults">
            ๐ ุจุงุฒฺฏุดุช ุจู ูพุดโูุฑุถ
          </button>
          <button
class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium" 
                  @click="exportSecurityLogs">
            ๐ฅ ุฏุงูููุฏ ูุงฺฏโูุง
          </button>
        </div>
        <button
class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium" 
                @click="saveSecuritySettings">
          ๐พ ุฐุฎุฑู ุชูุธูุงุช
        </button>
      </div>
    </div>
  </div>

</template>

<script lang="ts">
// ุชุนุฑู interface ูุง
interface ApiResponse<T> {
  data?: T
  success?: boolean
  message?: string
}

interface RateLimitData {
  customer_limit?: number
  operator_limit?: number
  admin_limit?: number
  window_seconds?: number
}

interface SecurityData {
  maxMessageLength?: number
  blockDuration?: number
  cooldownDuration?: number
  strictMode?: boolean
  allowedFileTypes?: string[]
  maxFileSize?: number
  bannedWords?: string[]
  blockedDomains?: string[]
}

interface SecurityStats {
  totalMessages?: number
  blockedMessages?: number
  suspiciousUsers?: number
  threatLevel?: string
}

interface Team {
  id: number
  name: string
  color: string
  icon: string
  operatorCount: number
  operators: Array<{ id: number; name: string; email: string }>
}

interface Operation {
  id: number
  name: string
  description: string
  type: string
  content: string
  sound: boolean
  waitTime: number
  departments: string[]
  teams: string[]
  conversationType?: string
  operationType?: string
  createdAt: string
}

interface SmartMessage {
  id: number
  title: string
  content: string
  status: string
  sender: string
  triggerType: string
  operationType?: string
  displayType?: string
  sendOncePerVisitor?: boolean
  withSound?: boolean
  sendOnMobile?: boolean
  conditionType?: string
  conditions?: unknown[]
  startDate?: string
  startTime?: string
  endType?: string
  endDate?: string
  endTime?: string
  scheduleType?: string
  lastUpdate: string
  updatedBy: { name: string; email: string }
}

interface Form {
  id: number
  title: string
  type: string
  status: string
  fieldCount: number
  lastUpdate: string
  content: string
  isRequired: boolean
  sendBeforeFirstMessage: boolean
  isDisabled: boolean
  fields: { type: string; label: string; required: boolean }[]
}

declare const definePageMeta: (meta: { layout?: string; middleware?: string | string[] }) => void
declare const $fetch: <T = unknown>(url: string, options?: { method?: string; body?: unknown; responseType?: string }) => Promise<T>
declare const $toast: { success: (msg: string) => void; error: (msg: string) => void; warning: (msg: string) => void }

export default {
  name: 'SupportSettingsPage'
}
</script>

<script setup lang="ts">
import { ref } from 'vue'

definePageMeta({ layout: 'admin-main', middleware: 'admin' })

const activeTab = ref('departments')
const showCreateTeamModal = ref(false)
const showEditTeamModal = ref(false)
const showWorkingHoursModal = ref(false)
const showCreateOperationModal = ref(false)
const showCreateSmartMessageModal = ref(false)
const showCreateFormModal = ref(false)
const isEditingOperation = ref(false)
const isEditingSmartMessage = ref(false)
const isEditingForm = ref(false)
const activeSmartMessageTab = ref('content')
const operatorSearch = ref('')
const selectedOperators = ref([])
const currentTeam = ref<Partial<Team>>({})
const currentOperation = ref<Partial<Operation>>({})
const currentSmartMessage = ref<Partial<SmartMessage>>({})
const currentForm = ref<Partial<Form>>({})

// ูุฑู ุนููุงุช ุฌุฏุฏ
const operationForm = ref({
  conversationType: 'awaiting',
  operationType: 'all_departments',
  withSound: true,
  waitTime: 0,
  messageText: 'ุจู ุณุงุช ูุง ุฎูุด ุงููุฏูุ ุฏุฑ ุฎุฏูุชุชูู ูุณุชู ๐',
  departments: [],
  teams: []
})

// ูุฑู ูพุงู ููุดููุฏ ุฌุฏุฏ
const smartMessageForm = ref({
  title: '',
  content: 'ุจู ุณุงุช ูุง ุฎูุด ุงููุฏูุ ุฏุฑ ุฎุฏูุชุชูู ูุณุชู ๐',
  status: 'active',
  sender: 'random',
  operationType: 'message_only',
  displayType: 'full',
  sendOncePerVisitor: true,
  withSound: true,
  sendOnMobile: true,
  conditionType: 'at_least_one',
  conditions: [],
  startDate: '',
  startTime: '',
  endType: 'never',
  endDate: '',
  endTime: '',
  scheduleType: 'always'
})

// ูุฑู ุงุฌุงุฏ ูุฑู ุฌุฏุฏ
const formBuilderForm = ref({
  title: '',
  type: '',
  content: '',
  isRequired: false,
  sendBeforeFirstMessage: false,
  isDisabled: false,
  fields: []
})

// ุชูุธูุงุช ุฒูุงูโูุง ุบุฑฺฉุงุฑ

// ูุฑุฎ ูพุงู
const rateLimit = ref({
  customer: 20,
  operator: 60,
  admin: 120,
  window: 60,
})

// ุชูุธูุงุช ุงููุช
const securitySettings = ref({
  maxMessageLength: 1000,
  blockDuration: 10, // ุฏููู
  cooldownDuration: 30, // ุซุงูู
  strictMode: false,
  allowedFileTypes: [
    'image/jpeg',
    'image/png', 
    'image/gif',
    'image/webp',
    'text/plain',
    'application/pdf'
  ],
  maxFileSize: 5, // MB
  bannedWords: [
    'eval',
    'function',
    'alert',
    'prompt',
    'confirm',
    'document.cookie',
    'localStorage',
    'sessionStorage',
    'window.location',
    'location.href'
  ],
  blockedDomains: [
    'bit.ly',
    'tinyurl.com',
    'example-malicious.com'
  ]
})

// ูุชุบุฑูุง ูุฑูุฏ ุฌุฏุฏ
const newFileType = ref('')
const newBannedWord = ref('')
const newBlockedDomain = ref('')

// ุขูุงุฑ ุงููุช
const securityStats = ref({
  totalMessages: 1247,
  blockedMessages: 23,
  suspiciousUsers: 5,
  threatLevel: 'ูพุงู'
})

async function _fetchRateLimit() {
  try {
    const response: ApiResponse<RateLimitData> = await $fetch('/api/admin/chat/settings/rate-limit')
    if (response.success && response.data) {
      rateLimit.value = {
        customer: response.data.customer_limit || 20,
        operator: response.data.operator_limit || 60,
        admin: response.data.admin_limit || 120,
        window: response.data.window_seconds || 60,
      }
    }
  } catch (err) {
    console.error('Error fetching rate limit:', err)
  }
}

async function saveRateLimit() {
  try {
    const response = await $fetch('/api/admin/chat/settings/rate-limit', {
      method: 'PUT',
      body: {
        customer_limit: rateLimit.value.customer,
        operator_limit: rateLimit.value.operator,
        admin_limit: rateLimit.value.admin,
        window_seconds: rateLimit.value.window,
      },
    }) as { success?: boolean }
    if (response.success) {
      $toast.success('ุชูุธูุงุช ุจุง ููููุช ุฐุฎุฑู ุดุฏ')
    }
  } catch (err) {
    // console.error('Error saving rate limit:', err)
    $toast.error('ุฎุทุง ุฏุฑ ุฐุฎุฑู ุชูุธูุงุช')
  }
}

// ุชูุงุจุน ูุฏุฑุช ุงููุช
function addFileType() {
  if (newFileType.value.trim() && !securitySettings.value.allowedFileTypes.includes(newFileType.value.trim())) {
    securitySettings.value.allowedFileTypes.push(newFileType.value.trim())
    newFileType.value = ''
  }
}

function removeFileType(index: number) {
  securitySettings.value.allowedFileTypes.splice(index, 1)
}

function addBannedWord() {
  if (newBannedWord.value.trim() && !securitySettings.value.bannedWords.includes(newBannedWord.value.trim().toLowerCase())) {
    securitySettings.value.bannedWords.push(newBannedWord.value.trim().toLowerCase())
    newBannedWord.value = ''
  }
}

function removeBannedWord(index: number) {
  securitySettings.value.bannedWords.splice(index, 1)
}

function addBlockedDomain() {
  if (newBlockedDomain.value.trim() && !securitySettings.value.blockedDomains.includes(newBlockedDomain.value.trim().toLowerCase())) {
    securitySettings.value.blockedDomains.push(newBlockedDomain.value.trim().toLowerCase())
    newBlockedDomain.value = ''
  }
}

function removeBlockedDomain(index: number) {
  securitySettings.value.blockedDomains.splice(index, 1)
}

async function _fetchSecuritySettings() {
  try {
    const response: ApiResponse<SecurityData> = await $fetch('/api/admin/chat/settings/security')
    if (response.success && response.data) {
      securitySettings.value = { ...securitySettings.value, ...response.data }
    }
  } catch (err) {
    // console.error('Error fetching security settings:', err)
  }
}

async function saveSecuritySettings() {
  try {
    const response = await $fetch('/api/admin/chat/settings/security', {
      method: 'PUT',
      body: securitySettings.value
    }) as { success?: boolean }
    if (response.success) {
      $toast.success('ุชูุธูุงุช ุงููุช ุจุง ููููุช ุฐุฎุฑู ุดุฏ')
    }
  } catch (err) {
    // console.error('Error saving security settings:', err)
    $toast.error('ุฎุทุง ุฏุฑ ุฐุฎุฑู ุชูุธูุงุช ุงููุช')
  }
}

async function _fetchSecurityStats() {
  try {
    const response: ApiResponse<SecurityStats> = await $fetch('/api/admin/chat/security/stats')
    if (response.success && response.data) {
      securityStats.value = {
        ...securityStats.value,
        ...response.data
      }
    }
  } catch (err) {
    // console.error('Error fetching security stats:', err)
  }
}

function testSecurity() {
  import('~/utils/securityTest').then(({ runSecurityTests }) => {
    const results = runSecurityTests()
    const passed = results.filter(r => r.passed).length
    const total = results.length
    const passRate = ((passed / total) * 100).toFixed(1)
    
    if (passed === total) {
      $toast.success(`โ ุชุณุช ุงููุช ูููู: ${passed}/${total} ุชุณุช (${passRate}%)`)
    } else {
      $toast.warning(`โ๏ธ ุจุฑุฎ ุชุณุชโูุง ูุงูููู: ${passed}/${total} ุชุณุช (${passRate}%)`)
    }
  }).catch(err => {
    // console.error('Error running security tests:', err)
    $toast.error('ุฎุทุง ุฏุฑ ุงุฌุฑุง ุชุณุชโูุง ุงููุช')
  })
}

function resetToDefaults() {
  if (confirm('ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุชูุธูุงุช ุจู ุญุงูุช ูพุดโูุฑุถ ุจุฑฺฏุฑุฏุฏุ')) {
    securitySettings.value = {
      maxMessageLength: 1000,
      blockDuration: 10,
      cooldownDuration: 30,
      strictMode: false,
      allowedFileTypes: [
        'image/jpeg',
        'image/png', 
        'image/gif',
        'image/webp',
        'text/plain',
        'application/pdf'
      ],
      maxFileSize: 5,
      bannedWords: [
        'eval', 'function', 'alert', 'prompt', 'confirm',
        'document.cookie', 'localStorage', 'sessionStorage',
        'window.location', 'location.href'
      ],
      blockedDomains: [
        'bit.ly', 'tinyurl.com', 'example-malicious.com'
      ]
    }
    $toast.success('ุชูุธูุงุช ุจู ุญุงูุช ูพุดโูุฑุถ ุจุฑฺฏุดุช')
  }
}

async function exportSecurityLogs() {
  try {
    const response = await $fetch('/api/admin/chat/security/logs', {
      method: 'GET',
      responseType: 'blob'
    }) as Blob
    
    // ุงุฌุงุฏ ููฺฉ ุฏุงูููุฏ
    const url = window.URL.createObjectURL(new Blob([response]))
    const link = document.createElement('a')
    link.href = url
    link.setAttribute('download', `security-logs-${new Date().toISOString().split('T')[0]}.json`)
    document.body.appendChild(link)
    link.click()
    link.remove()
    window.URL.revokeObjectURL(url)
    
    $toast.success('ูุงฺฏโูุง ุงููุช ุฏุงูููุฏ ุดุฏ')
  } catch (err) {
    // console.error('Error exporting security logs:', err)
    $toast.error('ุฎุทุง ุฏุฑ ุฏุงูููุฏ ูุงฺฏโูุง ุงููุช')
  }
}
const offlineSettings = ref({
  offlineMessage: true,
  changeToOnline: false,
  smartMessages: false,
  sendToTelegram: false,
  sleepMode: false,
  hideWidget: false,
  disableChat: false
})



// ูุฑู ุชู ุฌุฏุฏ
const newTeam = ref({
  name: '',
  color: '#8B5CF6',
  icon: '๐ฌ',
  operators: []
})

// ูุณุช ุชูโูุง
const teams = ref([
  {
    id: 1,
    name: 'ุชู ูพุดุชุจุงู',
    color: '#F59E0B',
    icon: '๐ฆ',
    operatorCount: 1,
    operators: [
      {
        id: 1,
        name: 'ุข . ุขุฐุฑ',
        email: 'azitaazariตธตฐ@gmail.com'
      }
    ]
  },
  {
    id: 2,
    name: 'ุชู ูพุดูุฑุถ',
    color: '#8B5CF6',
    icon: '๐ฌ',
    operatorCount: 0,
    operators: []
  }
])

// ูุณุช ุนููุงุชโูุง ุฌุฏุฏ
const operations = ref([
  {
    id: 1,
    name: 'ูพุงุณุฎฺฏู',
    description: 'ูพุงุณุฎฺฏู ุจู ูพุงูโูุง ฺฉุงุฑุจุฑุงู ุฏุฑ ุญุงูุช ุงูุชุธุงุฑ',
    type: 'auto_message',
    content: 'ูพุงุณุฎฺฏู ุณูุงูุงุช ุดูุง ูุณุชู.',
    sound: true,
    waitTime: 30,
    departments: [], // ูุซุงู: ['ูพุดุชุจุงู', 'ูู']
    teams: [], // ูุซุงู: ['ุชู ูพุดุชุจุงู', 'ุชู ูู']
    createdAt: '2023-10-27T10:00:00Z'
  },
  {
    id: 2,
    name: 'ุชุงุฎุฑ ุฏุฑ ูพุงุณุฎฺฏู',
    description: 'ุชุงุฎุฑ ุฏุฑ ูพุงุณุฎฺฏู ุจู ูพุงูโูุง ฺฉุงุฑุจุฑุงู ุฏุฑ ุญุงูุช ุงูุชุธุงุฑ',
    type: 'delay',
    content: 'ุจู ุฒูุฏ ูพุงุณุฎ ูโุฏูู.',
    sound: false,
    waitTime: 60,
    departments: ['ูพุดุชุจุงู'],
    teams: ['ุชู ูพุดุชุจุงู'],
    createdAt: '2023-10-27T11:00:00Z'
  }
])

// ูุณุช ูพุงูโูุง ููุดููุฏ
const smartMessages = ref([
  {
    id: 1,
    title: 'ุดุฑุท ฑ',
    content: 'ูพุงู ุฎูุดโุขูุฏฺฏู ุจุฑุง ฺฉุงุฑุจุฑุงู ุฌุฏุฏ',
    status: 'active',
    sender: 'random',
    triggerType: 'welcome',
    lastUpdate: 'ฑดฐณ/ต/ต',
    updatedBy: {
      name: 'ฑ. ุขุฐุฑ',
      email: 'azitaazariตธตฐ@gmail.com'
    },
    conditions: []
  }
])

// ูุณุช ูุฑูโูุง
const forms = ref([
  {
    id: 1,
    title: 'ูุฑู ุงุทูุงุนุงุช ุชูุงุณ',
    type: 'ูุฑู ุณุงุนุงุช ฺฉุงุฑ',
    status: 'active',
    fieldCount: 3,
    lastUpdate: 'ฑดฐณ/ต/ต',
    content: 'ูุฑู ุฌูุนโุขูุฑ ุงุทูุงุนุงุช ุชูุงุณ ฺฉุงุฑุจุฑุงู',
    isRequired: true,
    sendBeforeFirstMessage: false,
    isDisabled: false,
    fields: [
      { type: 'text', label: 'ูุงู', required: true },
      { type: 'email', label: 'ุงูู', required: true },
      { type: 'phone', label: 'ุชููู', required: false }
    ]
  }
])


// ุงุฌุงุฏ ุชู ุฌุฏุฏ
function createTeam() {
  if (!newTeam.value.name) {
    alert('ูุทูุงู ูุงู ุชู ุฑุง ูุงุฑุฏ ฺฉูุฏ')
    return
  }

  const team = {
    id: Date.now(),
    ...newTeam.value,
    operatorCount: selectedOperators.value.length,
    operators: [...selectedOperators.value]
  }

  teams.value.push(team)
  
  // ูพุงฺฉ ฺฉุฑุฏู ูุฑู
  resetForm()
  showCreateTeamModal.value = false
  
  alert('ุชู ุจุง ููููุช ุงุฌุงุฏ ุดุฏ')
}

// ุจูโุฑูุฒุฑุณุงู ุชู
function updateTeam() {
  if (!currentTeam.value.name) {
    alert('ูุทูุงู ูุงู ุชู ุฑุง ูุงุฑุฏ ฺฉูุฏ')
    return
  }

  const index = teams.value.findIndex(team => team.id === currentTeam.value.id)
  if (index !== -1 && currentTeam.value.id) {
    teams.value[index] = { ...currentTeam.value } as Team
  }
  
  showEditTeamModal.value = false
  alert('ุชู ุจุง ููููุช ุจูโุฑูุฒุฑุณุงู ุดุฏ')
}

// ุญุฐู ุชู
function deleteTeam(id) {
  if (confirm('ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ุชู ุฑุง ุญุฐู ฺฉูุฏุ')) {
    teams.value = teams.value.filter(team => team.id !== id)
    alert('ุชู ุจุง ููููุช ุญุฐู ุดุฏ')
  }
}

// ุญุฐู ุงูพุฑุงุชูุฑ ุงุฒ ูุณุช ุงูุชุฎุงุจ ุดุฏู
function removeOperator(id) {
  selectedOperators.value = selectedOperators.value.filter(op => op.id !== id)
}

// ุญุฐู ุงูพุฑุงุชูุฑ ุงุฒ ุชู
function removeOperatorFromTeam(id) {
  if (currentTeam.value.operators) {
    currentTeam.value.operators = currentTeam.value.operators.filter(op => op.id !== id)
    currentTeam.value.operatorCount = currentTeam.value.operators.length
  }
}



// ุญุฐู ุนููุงุช
function deleteOperation(id) {
  if (confirm('ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ุนููุงุช ุฑุง ุญุฐู ฺฉูุฏุ')) {
    operations.value = operations.value.filter(op => op.id !== id)
    alert('ุนููุงุช ุจุง ููููุช ุญุฐู ุดุฏ')
  }
}

// ุจุงุฒ ฺฉุฑุฏู ููุฏุงู ุงุฌุงุฏ ุนููุงุช ุฌุฏุฏ
function openCreateOperationModal() {
  isEditingOperation.value = false
  resetOperationForm()
  showCreateOperationModal.value = true
}

// ุจุงุฒ ฺฉุฑุฏู ููุฏุงู ูุฑุงุด ุนููุงุช
function openEditOperationModal(operation) {
  isEditingOperation.value = true
  currentOperation.value = { ...operation }
  operationForm.value = {
    conversationType: operation.conversationType || 'awaiting',
    operationType: operation.operationType || 'all_departments',
    withSound: operation.sound || true,
    waitTime: operation.waitTime || 0,
    messageText: operation.content || 'ุจู ุณุงุช ูุง ุฎูุด ุงููุฏูุ ุฏุฑ ุฎุฏูุชุชูู ูุณุชู ๐',
    departments: operation.departments || [],
    teams: operation.teams || []
  }
  showCreateOperationModal.value = true
}

// ุจุณุชู ููุฏุงู ุนููุงุช
function closeOperationModal() {
  showCreateOperationModal.value = false
  isEditingOperation.value = false
  currentOperation.value = {}
  resetOperationForm()
}

// ุจุงุฒูุดุงู ูุฑู ุนููุงุช
function resetOperationForm() {
  operationForm.value = {
    conversationType: 'awaiting',
    operationType: 'all_departments',
    withSound: true,
    waitTime: 0,
    messageText: 'ุจู ุณุงุช ูุง ุฎูุด ุงููุฏูุ ุฏุฑ ุฎุฏูุชุชูู ูุณุชู ๐',
    departments: [],
    teams: []
  }
}

// ุฐุฎุฑู ุนููุงุช
function saveOperation() {
  if (!operationForm.value.messageText.trim()) {
    alert('ูุทูุงู ูุชู ูพุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ')
    return
  }

  const operationData = {
    conversationType: operationForm.value.conversationType,
    operationType: operationForm.value.operationType,
    sound: operationForm.value.withSound,
    waitTime: operationForm.value.waitTime,
    content: operationForm.value.messageText,
    departments: operationForm.value.departments,
    teams: operationForm.value.teams,
    createdAt: new Date().toISOString()
  }

  if (isEditingOperation.value) {
    // ูุฑุงุด ุนููุงุช ููุฌูุฏ
    const index = operations.value.findIndex(op => op.id === currentOperation.value.id)
    if (index !== -1) {
      operations.value[index] = {
        ...operations.value[index],
        ...operationData
      }
    }
    alert('ุนููุงุช ุจุง ููููุช ูุฑุงุด ุดุฏ')
  } else {
    // ุงุฌุงุฏ ุนููุงุช ุฌุฏุฏ
    const newOperation = {
      id: Date.now(),
      name: 'ุนููุงุช ุฌุฏุฏ',
      description: 'ุนููุงุช ุฎูุฏฺฉุงุฑ ุจุฑุง ูพุงุณุฎฺฏู',
      type: 'auto_message',
      ...operationData
    }
    operations.value.push(newOperation)
    alert('ุนููุงุช ุจุง ููููุช ุงุฌุงุฏ ุดุฏ')
  }

  closeOperationModal()
}

// ุจุงุฒ ฺฉุฑุฏู ููุฏุงู ุงุฌุงุฏ ูพุงู ููุดููุฏ ุฌุฏุฏ
function _openCreateSmartMessageModal() {
  isEditingSmartMessage.value = false
  currentSmartMessage.value = {}
  resetSmartMessageForm()
  showCreateSmartMessageModal.value = true
}

// ูุฑุงุด ูพุงู ููุดููุฏ
function editSmartMessage(message) {
  isEditingSmartMessage.value = true
  currentSmartMessage.value = { ...message }
  smartMessageForm.value = {
    title: message.title,
    content: message.content,
    status: message.status,
    sender: message.sender,
    operationType: message.operationType || 'message_only',
    displayType: message.displayType || 'full',
    sendOncePerVisitor: message.sendOncePerVisitor !== false,
    withSound: message.withSound !== false,
    sendOnMobile: message.sendOnMobile !== false,
    conditionType: message.conditionType || 'at_least_one',
    conditions: message.conditions || [],
    startDate: message.startDate || '',
    startTime: message.startTime || '',
    endType: message.endType || 'never',
    endDate: message.endDate || '',
    endTime: message.endTime || '',
    scheduleType: message.scheduleType || 'always'
  }
  showCreateSmartMessageModal.value = true
}

// ุญุฐู ูพุงู ููุดููุฏ
function deleteSmartMessage(id) {
  if (confirm('ุขุง ุงุฒ ุญุฐู ุงู ูพุงู ููุดููุฏ ุงุทููุงู ุฏุงุฑุฏุ')) {
    const index = smartMessages.value.findIndex(msg => msg.id === id)
    if (index !== -1) {
      smartMessages.value.splice(index, 1)
      alert('ูพุงู ููุดููุฏ ุจุง ููููุช ุญุฐู ุดุฏ')
    }
  }
}

// ุจุณุชู ููุฏุงู ูพุงู ููุดููุฏ
function closeSmartMessageModal() {
  showCreateSmartMessageModal.value = false
  isEditingSmartMessage.value = false
  currentSmartMessage.value = {}
  resetSmartMessageForm()
}

// ุจุงุฒูุดุงู ูุฑู ูพุงู ููุดููุฏ
function resetSmartMessageForm() {
  smartMessageForm.value = {
    title: '',
    content: 'ุจู ุณุงุช ูุง ุฎูุด ุงููุฏูุ ุฏุฑ ุฎุฏูุชุชูู ูุณุชู ๐',
    status: 'active',
    sender: 'random',
    operationType: 'message_only',
    displayType: 'full',
    sendOncePerVisitor: true,
    withSound: true,
    sendOnMobile: true,
    conditionType: 'at_least_one',
    conditions: [],
    startDate: '',
    startTime: '',
    endType: 'never',
    endDate: '',
    endTime: '',
    scheduleType: 'always'
  }
}

// ุฏุฑุงูุช ูุชู ููุน ููุงุด
function getDisplayTypeText(displayType) {
  switch (displayType) {
    case 'full': return 'ูพุงู ฺฉุงูู'
    case 'short': return 'ูพุงู ฺฉูุชุงู'
    case 'notification': return 'ุงุนูุงู'
    default: return 'ูพุงู ฺฉุงูู'
  }
}

// ุฏุฑุงูุช ูุชู ุฒูุงู ุงูุชุดุงุฑ
function getPublishTimeText() {
  const startDate = smartMessageForm.value.startDate
  const startTime = smartMessageForm.value.startTime
  const endType = smartMessageForm.value.endType
  const scheduleType = smartMessageForm.value.scheduleType
  
  let text = ''
  if (startDate && startTime) {
    text += `ุดุฑูุน ุงุฑุณุงู: ${startDate} ุณุงุนุช ${startTime} `
  }
  
  text += `ูพุงุงู ุงุฑุณุงู: ${endType === 'never' ? 'ูฺููุช' : 'ุชูุธู ุดุฏู'} `
  
  switch (scheduleType) {
    case 'always': text += 'ูุฑ ุฑูุฒ ูุฑ ุณุงุนุช'; break
    case 'working_hours': text += 'ุฏุฑ ุทูู ุฒูุงููุง ฺฉุงุฑ'; break
    case 'non_working_hours': text += 'ุฏุฑ ุทูู ุฒูุงููุง ุบุฑฺฉุงุฑ'; break
  }
  
  return text
}

// ุฏุฑุงูุช ูุงุญุฏ ุดุฑุท
function getConditionUnit(conditionType) {
  switch (conditionType) {
    case 'time_on_page': return 'ุซุงูู'
    case 'scroll_percentage': return '%'
    case 'page_visit': return 'ุจุงุฑ'
    default: return ''
  }
}

// ุงูุฒูุฏู ุดุฑุท ุฌุฏุฏ
function addCondition() {
  smartMessageForm.value.conditions.push({
    type: 'time_on_page',
    value: 30
  })
}

// ุญุฐู ุดุฑุท
function removeCondition(index) {
  smartMessageForm.value.conditions.splice(index, 1)
}

// ุจุงุฒ ฺฉุฑุฏู ููุฏุงู ุงุฌุงุฏ ูุฑู ุฌุฏุฏ
function openCreateFormModal() {
  isEditingForm.value = false
  currentForm.value = {}
  resetFormBuilderForm()
  showCreateFormModal.value = true
}

// ูุฑุงุด ูุฑู
function editForm(form) {
  isEditingForm.value = true
  currentForm.value = { ...form }
  formBuilderForm.value = {
    title: form.title,
    type: form.type,
    content: form.content,
    isRequired: form.isRequired,
    sendBeforeFirstMessage: form.sendBeforeFirstMessage,
    isDisabled: form.isDisabled,
    fields: form.fields || []
  }
  showCreateFormModal.value = true
}

// ุญุฐู ูุฑู
function deleteForm(id) {
  if (confirm('ุขุง ุงุฒ ุญุฐู ุงู ูุฑู ุงุทููุงู ุฏุงุฑุฏุ')) {
    const index = forms.value.findIndex(form => form.id === id)
    if (index !== -1) {
      forms.value.splice(index, 1)
      alert('ูุฑู ุจุง ููููุช ุญุฐู ุดุฏ')
    }
  }
}

// ุจุณุชู ููุฏุงู ูุฑู
function closeFormModal() {
  showCreateFormModal.value = false
  isEditingForm.value = false
  currentForm.value = {}
  resetFormBuilderForm()
}

// ุจุงุฒูุดุงู ูุฑู ูุฑูโุณุงุฒ
function resetFormBuilderForm() {
  formBuilderForm.value = {
    title: '',
    type: '',
    content: '',
    isRequired: false,
    sendBeforeFirstMessage: false,
    isDisabled: false,
    fields: []
  }
}

// ุฐุฎุฑู ูุฑู
function saveForm() {
  if (!formBuilderForm.value.title.trim()) {
    alert('ูุทูุงู ุนููุงู ูุฑู ุฑุง ูุงุฑุฏ ฺฉูุฏ')
    return
  }
  
  if (!formBuilderForm.value.type) {
    alert('ูุทูุงู ููุน ูุฑู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ')
    return
  }

  const formData: Partial<Form> = {
    title: formBuilderForm.value.title,
    type: formBuilderForm.value.type,
    status: formBuilderForm.value.isDisabled ? 'inactive' : 'active',
    content: formBuilderForm.value.content,
    isRequired: formBuilderForm.value.isRequired,
    sendBeforeFirstMessage: formBuilderForm.value.sendBeforeFirstMessage,
    isDisabled: formBuilderForm.value.isDisabled,
    fields: formBuilderForm.value.fields,
    fieldCount: formBuilderForm.value.fields.length,
    lastUpdate: new Date().toLocaleDateString('fa-IR')
  }

  if (isEditingForm.value) {
    // ูุฑุงุด ูุฑู ููุฌูุฏ
    const index = forms.value.findIndex(form => form.id === currentForm.value.id)
    if (index !== -1) {
      forms.value[index] = {
        ...forms.value[index],
        ...formData
      }
    }
    alert('ูุฑู ุจุง ููููุช ูุฑุงุด ุดุฏ')
  } else {
    // ุงุฌุงุฏ ูุฑู ุฌุฏุฏ
    const newForm: Form = {
      id: Date.now(),
      title: formData.title || '',
      type: formData.type || '',
      status: formData.status || 'active',
      content: formData.content || '',
      isRequired: formData.isRequired || false,
      sendBeforeFirstMessage: formData.sendBeforeFirstMessage || false,
      isDisabled: formData.isDisabled || false,
      fields: (formData.fields || []) as { type: string; label: string; required: boolean }[],
      fieldCount: formData.fieldCount || 0,
      lastUpdate: formData.lastUpdate || new Date().toLocaleDateString('fa-IR')
    }
    forms.value.push(newForm)
    alert('ูุฑู ุจุง ููููุช ุงุฌุงุฏ ุดุฏ')
  }

  closeFormModal()
}

// ุฐุฎุฑู ูพุงู ููุดููุฏ
function saveSmartMessage() {
  if (!smartMessageForm.value.title.trim() || !smartMessageForm.value.content.trim()) {
    alert('ูุทูุงู ุนููุงู ู ูุญุชูุง ูพุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ')
    return
  }

  const messageData: Partial<SmartMessage> = {
    title: smartMessageForm.value.title,
    content: smartMessageForm.value.content,
    status: smartMessageForm.value.status,
    sender: smartMessageForm.value.sender,
    triggerType: smartMessageForm.value.operationType || 'welcome',
    operationType: smartMessageForm.value.operationType,
    displayType: smartMessageForm.value.displayType,
    sendOncePerVisitor: smartMessageForm.value.sendOncePerVisitor,
    withSound: smartMessageForm.value.withSound,
    sendOnMobile: smartMessageForm.value.sendOnMobile,
    conditionType: smartMessageForm.value.conditionType,
    conditions: smartMessageForm.value.conditions,
    startDate: smartMessageForm.value.startDate,
    startTime: smartMessageForm.value.startTime,
    endType: smartMessageForm.value.endType,
    endDate: smartMessageForm.value.endDate,
    endTime: smartMessageForm.value.endTime,
    scheduleType: smartMessageForm.value.scheduleType,
    lastUpdate: new Date().toLocaleDateString('fa-IR'),
    updatedBy: {
      name: 'ฑ. ุขุฐุฑ',
      email: 'azitaazariตธตฐ@gmail.com'
    }
  }

  if (isEditingSmartMessage.value) {
    // ูุฑุงุด ูพุงู ููุฌูุฏ
    const index = smartMessages.value.findIndex(msg => msg.id === currentSmartMessage.value.id)
    if (index !== -1) {
      smartMessages.value[index] = {
        ...smartMessages.value[index],
        ...messageData
      }
    }
    alert('ูพุงู ููุดููุฏ ุจุง ููููุช ูุฑุงุด ุดุฏ')
  } else {
    // ุงุฌุงุฏ ูพุงู ุฌุฏุฏ
    const newMessage: SmartMessage = {
      id: Date.now(),
      title: messageData.title || '',
      content: messageData.content || '',
      status: messageData.status || 'active',
      sender: messageData.sender || 'random',
      triggerType: messageData.triggerType || 'welcome',
      operationType: messageData.operationType,
      displayType: messageData.displayType,
      sendOncePerVisitor: messageData.sendOncePerVisitor,
      withSound: messageData.withSound,
      sendOnMobile: messageData.sendOnMobile,
      conditionType: messageData.conditionType,
      conditions: messageData.conditions || [],
      startDate: messageData.startDate,
      startTime: messageData.startTime,
      endType: messageData.endType,
      endDate: messageData.endDate,
      endTime: messageData.endTime,
      scheduleType: messageData.scheduleType,
      lastUpdate: messageData.lastUpdate || new Date().toLocaleDateString('fa-IR'),
      updatedBy: messageData.updatedBy || { name: 'ฑ. ุขุฐุฑ', email: 'azitaazariตธตฐ@gmail.com' }
    }
    smartMessages.value.push(newMessage as SmartMessage & { conditions: unknown[] })
    alert('ูพุงู ููุดููุฏ ุจุง ููููุช ุงุฌุงุฏ ุดุฏ')
  }

  closeSmartMessageModal()
}


// ุจุงุฒูุดุงู ูุฑู
function resetForm() {
  newTeam.value = {
    name: '',
    color: '#8B5CF6',
    icon: '๐ฌ',
    operators: []
  }
  selectedOperators.value = []
  operatorSearch.value = ''
}

// ุฐุฎุฑู ุชูุงู ุชูุธูุงุช
function saveAllSettings() {
  // ุงูุฌุง ฺฉุฏ ุฐุฎุฑู ุชูุธูุงุช ุฏุฑ ุฏุชุงุจุณ ูุฑุงุฑ ูโฺฏุฑุฏ
  
  // ููุงุด ูพุงู ููููุช
  alert('ุชูุธูุงุช ุจุง ููููุช ุฐุฎุฑู ุดุฏ')
}

// ุงูุฒูุฏู ููุฏ ุฌุฏุฏ ุจู ูุฑู
function addFormField() {
  formBuilderForm.value.fields.push({
    type: 'text',
    label: '',
    required: false
  })
}

// ุญุฐู ููุฏ ุงุฒ ูุฑู
function removeFormField(index: number) {
  formBuilderForm.value.fields.splice(index, 1)
}
</script> 
