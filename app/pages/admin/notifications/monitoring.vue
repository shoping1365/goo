<template>
  <div class="min-h-screen bg-blue-50">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-2xl font-bold text-gray-900">Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø³ÛŒØ³ØªÙ…</h1>
            <p class="mt-1 text-sm text-gray-600">Ù†Ø¸Ø§Ø±Øª Ø¨Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯ Ùˆ ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ… Ù¾ÛŒØ§Ù…Ú© Ùˆ Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</p>
          </div>
          <div class="flex items-center space-x-3 space-x-reverse">




            <button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-gradient-to-r from-emerald-400 to-green-600 hover:from-emerald-500 hover:to-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 shadow-md transition-all duration-200 hover:shadow-lg hover:scale-105" @click="exportReport">
              <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø²Ø§Ø±Ø´
            </button>

          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">


      <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <!-- Ú©Ø§Ø±Øª Ù¾ÛŒØ§Ù…Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² -->
        <TemplateCard 
          title="Ù¾ÛŒØ§Ù…Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²" 
          :value="stats.todaySms" 
          variant="blue"
        >
          <template #icon>
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
          </template>
        </TemplateCard>

        <!-- Ú©Ø§Ø±Øª Ø¯Ø±ØµØ¯ Ù…ÙˆÙÙ‚ÛŒØª -->
        <TemplateCard 
          title="Ø¯Ø±ØµØ¯ Ù…ÙˆÙÙ‚ÛŒØª" 
          :value="stats.successRate.toFixed(1) + '%'" 
          variant="green"
        >
          <template #icon>
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </template>
        </TemplateCard>

        <!-- Ú©Ø§Ø±Øª Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø® -->
        <TemplateCard 
          title="Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®" 
          :value="stats.responseTime + 'ms'" 
          variant="orange"
        >
          <template #icon>
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </template>
        </TemplateCard>

        <!-- Ú©Ø§Ø±Øª Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² -->
        <TemplateCard 
          title="Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²" 
          :value="stats.todayErrors" 
          variant="red"
        >
          <template #icon>
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </template>
        </TemplateCard>
      </div>

      <!-- SMS Ù‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ -->
      <div class="space-y-6 mb-8">
        <!-- Ù‡Ø¯Ø± Ú©Ù„ÛŒ -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
          <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-medium text-gray-900">SMS Ù‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§</h3>
              <button class="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm" @click="debugData">
                ØªØ³Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
              </button>
            </div>
          </div>
        </div>

        <!-- Ø¬Ø¯Ø§ÙˆÙ„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø±Ú¯Ø§Ù‡ -->
        <div v-if="sortedGatewaySmsData.length === 0" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center">
          <p class="text-gray-500">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§...</p>
        </div>
        <div v-for="gatewayData in sortedGatewaySmsData" :key="gatewayData.gateway.id" class="bg-white rounded-lg shadow-sm border border-gray-200">
          <!-- Ù‡Ø¯Ø± Ø¯Ø±Ú¯Ø§Ù‡ -->
          <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3 space-x-reverse">
                <div class="flex items-center">
                  <div class="w-3 h-3 rounded-full" :class="gatewayData.gateway.is_active ? 'bg-green-500' : 'bg-red-500'"></div>
                  <span class="mr-3 text-lg font-semibold text-gray-900">{{ gatewayData.gateway.name }}</span>
                  
                </div>
              </div>
              <div class="flex items-center gap-6">
                <!-- Ú©Ù„ Ø§Ø±Ø³Ø§Ù„ -->
                <div class="text-center bg-gray-100 rounded-lg p-2 border border-gray-200 w-20 h-16 flex flex-col justify-center">
                  <div class="text-lg font-bold text-gray-700">{{ gatewayData.stats.total }}</div>
                  <div class="text-xs text-gray-500">Ú©Ù„ Ø§Ø±Ø³Ø§Ù„</div>
                </div>
                <!-- Ù…ÙˆÙÙ‚ -->
                <div class="text-center bg-green-50 rounded-lg p-2 border border-green-200 w-20 h-16 flex flex-col justify-center">
                  <div class="text-lg font-bold text-green-600">{{ gatewayData.stats.success }}</div>
                  <div class="text-xs text-green-500">Ù…ÙˆÙÙ‚</div>
                </div>
                <!-- Ù†Ø§Ù…ÙˆÙÙ‚ -->
                <div class="text-center bg-red-50 rounded-lg p-2 border border-red-200 w-20 h-16 flex flex-col justify-center">
                  <div class="text-lg font-bold text-red-600">{{ gatewayData.stats.failed }}</div>
                  <div class="text-xs text-red-500">Ù†Ø§Ù…ÙˆÙÙ‚</div>
                </div>
                <!-- Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± -->
                <div class="text-center bg-yellow-50 rounded-lg p-2 border border-yellow-200 w-20 h-16 flex flex-col justify-center">
                  <div class="text-lg font-bold text-yellow-600">{{ gatewayData.stats.pending }}</div>
                  <div class="text-xs text-yellow-500">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                </div>
                <!-- Ø¯Ø±ØµØ¯ Ù…ÙˆÙÙ‚ÛŒØª -->
                <div class="text-center bg-blue-50 rounded-lg p-2 border border-blue-200 w-20 h-16 flex flex-col justify-center">
                  <div class="text-lg font-bold text-blue-600">{{ gatewayData.stats.successRate.toFixed(1) }}%</div>
                  <div class="text-xs text-blue-500">Ù…ÙˆÙÙ‚ÛŒØª</div>
                </div>
                
                <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª -->
                <div class="flex items-center gap-6 mr-auto">
                  <!-- ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ -->
                  <div class="text-center bg-orange-50 rounded-lg p-2 border border-orange-200 w-20 h-16 flex flex-col justify-center cursor-pointer hover:bg-orange-100 transition-colors duration-200" @click="testGatewaySend(gatewayData.gateway)">
                    <div class="text-lg font-bold text-orange-600">
                      <svg class="w-5 h-5 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                      </svg>
                    </div>
                    <div class="text-xs text-orange-500">ØªØ³Øª Ø§Ø±Ø³Ø§Ù„</div>
                  </div>
                  
                  <!-- Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ -->
                  <div class="text-center bg-purple-50 rounded-lg p-2 border border-purple-200 w-20 h-16 flex flex-col justify-center cursor-pointer hover:bg-purple-100 transition-colors duration-200" @click="refreshGatewayBalances">
                    <!-- Ø¨Ø±Ø§ÛŒ Ù…Ù„ÛŒ Ù¾ÛŒØ§Ù…Ú©: Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ SMS Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø±ÛŒØ§Ù„ÛŒ -->
                    <div v-if="gatewayData.gateway.type === 'meli_payamak'" class="text-center">
                      <div class="text-sm font-bold text-purple-600">{{ gatewayData.gateway.balance || 0 }}</div>
                      <div class="text-xs text-purple-500">SMS Ø¨Ø§Ù‚ÛŒ</div>
                      <div class="text-xs text-green-600 font-medium">{{ (gatewayData.gateway.credit || 0).toLocaleString('fa-IR') }}</div>
                      <div class="text-xs text-green-500">Ø±ÛŒØ§Ù„</div>
                    </div>
                    <!-- Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§: Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø¹Ù…ÙˆÙ„ÛŒ -->
                    <div v-else>
                      <div class="text-lg font-bold text-purple-600">{{ (Math.floor((gatewayData.gateway.balance || 0) / 1000) * 1000).toLocaleString('fa-IR') }}</div>
                      <div class="text-xs text-purple-500">Ù…ÙˆØ¬ÙˆØ¯ÛŒ</div>
                    </div>
                  </div>
                  
                  <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ú¯Ø§Ù‡ -->
                  <div class="text-center bg-indigo-50 rounded-lg p-2 border border-indigo-200 w-20 h-16 flex flex-col justify-center cursor-pointer hover:bg-indigo-100 transition-colors duration-200" @click="showGatewayDetails(gatewayData.gateway)">
                    <div class="text-lg font-bold text-indigo-600">
                      <svg class="w-5 h-5 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                    </div>
                    <div class="text-xs text-indigo-500">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ú¯Ø§Ù‡</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Ø¬Ø¯ÙˆÙ„ SMS Ù‡Ø§ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ -->
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø²Ù…Ø§Ù† Ø§Ø±Ø³Ø§Ù„</th>
                  <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ú¯ÛŒØ±Ù†Ø¯Ú¯Ø§Ù†</th>
                  <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ù¾ÛŒØºØ§Ù…</th>
                  <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ù†ÙˆØ¹</th>
                  <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ÙˆØ¶Ø¹ÛŒØª</th>
                  <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ù‡Ø²ÛŒÙ†Ù‡</th>
                  <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr v-if="gatewayData.smsList.length === 0">
                  <td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500">
                    Ù‡ÛŒÚ† SMS Ø§Ø±Ø³Ø§Ù„ÛŒ Ø§Ø² Ø§ÛŒÙ† Ø¯Ø±Ú¯Ø§Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
                  </td>
                </tr>
                <tr v-for="sms in gatewayData.smsList" :key="sms.id" class="hover:bg-gray-50">
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">{{ formatDateTime(sms.sent_at || sms.timestamp) }}</td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900 font-mono">{{ sms.phone_number || sms.phoneNumber }}</td>
                  <td class="px-3 py-4 text-sm text-gray-900 max-w-md truncate" :title="sms.message">
                    {{ sms.message }}
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                      {{ sms.type || sms.service || 'Ø¹Ù…ÙˆÙ…ÛŒ' }}
                    </span>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap">
                    <span
class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" 
                          :class="getSmsStatusClass(sms.status)">
                      {{ getSmsStatusText(sms.status) }}
                    </span>
                    <div v-if="sms.status_text" class="text-xs text-gray-500 mt-1">{{ sms.status_text }}</div>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span v-if="sms.cost" class="text-green-600 font-medium">{{ (Math.floor(Number(sms.cost) / 10) * 10).toLocaleString('fa-IR') }} Ø±ÛŒØ§Ù„</span>
                    <span v-else class="text-gray-400">-</span>
                  </td>
                  <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">
                    <button class="text-blue-600 hover:text-blue-800 font-medium" @click="viewSmsDetails(sms)">
                      Ù…Ø´Ø§Ù‡Ø¯Ù‡
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ -->
          <Pagination
            v-if="gatewayData.stats.total > 0"
            :current-page="gatewayData.pagination?.currentPage || 1"
            :total-pages="gatewayData.pagination?.totalPages || 1"
            :total="gatewayData.stats.total"
            :items-per-page="gatewayData.pagination?.itemsPerPage || itemsPerPage"
            @page-changed="(page) => handlePageChange(gatewayData.gateway.id, page)"
            @items-per-page-changed="(newLimit) => handleItemsPerPageChange(newLimit, gatewayData.gateway.id)"
          />
        </div>




        

        

      </div>



      <!-- Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ Ùˆ Ø¬Ø¯Ø§ÙˆÙ„ -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ø¢Ù…Ø§Ø± Ø§Ø±Ø³Ø§Ù„ÛŒ -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Ø¢Ù…Ø§Ø± Ø§Ø±Ø³Ø§Ù„ÛŒ</h3>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <div v-for="day in weeklyPerformance" :key="day.day" class="flex items-center justify-between">
                <span class="text-sm text-gray-600">{{ day.day }}</span>
                <div class="flex items-center space-x-2 space-x-reverse">
                  <div class="w-32 bg-gray-200 rounded-full h-2">
                    <div class="bg-blue-600 h-2 rounded-full" :style="{ width: day.percentage + '%' }"></div>
                  </div>
                  <span class="text-sm font-medium text-gray-900">{{ day.count }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
          <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-medium text-gray-900">ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§</h3>
              <div class="flex items-center gap-8">
                <button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-gradient-to-r from-blue-400 to-blue-600 hover:from-blue-500 hover:to-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-md transition-all duration-200 hover:shadow-lg hover:scale-105" @click="loadGatewaysStatus">
                  <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                  </svg>
                  Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                </button>
              </div>
            </div>
          </div>
          <div class="p-6">
            <div v-if="gateways.length === 0" class="text-center py-8">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <h3 class="mt-2 text-sm font-medium text-gray-900">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§...</h3>
              <p class="mt-1 text-sm text-gray-500">Ù„Ø·ÙØ§Ù‹ Ú©Ù…ÛŒ ØµØ¨Ø± Ú©Ù†ÛŒØ¯</p>
            </div>

            <div v-else class="space-y-4">
              <div v-for="gateway in gateways" :key="gateway.id" class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center">
                  <div class="w-3 h-3 rounded-full" :class="gateway.status === 'active' ? 'bg-green-500' : 'bg-red-500'"></div>
                  <span class="mr-3 text-sm font-medium text-gray-900">{{ gateway.name }}</span>
                </div>
                <div class="text-sm text-gray-600">
                  {{ gateway.responseTime }}ms
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>



      <!-- Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ -->
      <div class="mt-8 bg-white rounded-lg shadow-sm border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„</h3>
        </div>
        <div class="p-6">
          <div v-if="alerts.length === 0" class="text-center py-8">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Ù‡ÛŒÚ† Ù‡Ø´Ø¯Ø§Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</h3>
            <p class="mt-1 text-sm text-gray-500">Ø³ÛŒØ³ØªÙ… Ø¯Ø± ÙˆØ¶Ø¹ÛŒØª Ø¹Ø§Ø¯ÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯</p>
          </div>
          <div v-else class="space-y-4">
            <div v-for="alert in alerts" :key="alert.id" class="flex items-start p-6 border border-red-200 rounded-lg bg-red-50">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div class="mr-3">
                <h4 class="text-sm font-medium text-red-800">{{ alert.title }}</h4>
                <p class="text-sm text-red-700">{{ alert.message }}</p>
                <p class="text-xs text-red-600 mt-1">{{ alert.timestamp }}</p>
              </div>
              <div class="mr-auto">
                <button class="text-red-400 hover:text-red-600" @click="dismissAlert(alert.id)">
                  <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script lang="ts">
declare const definePageMeta: (meta: { layout?: string; middleware?: string | string[] }) => void
</script>

<script setup lang="ts">
import Pagination from '~/components/admin/common/Pagination.vue'
import TemplateCard from '~/components/common/TemplateCard.vue'
import { ref, computed, onMounted, nextTick } from 'vue'
import { useAuth } from '~/composables/useAuth'

definePageMeta({
  layout: 'admin-main',
  middleware: 'admin'
})

// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² useAuth Ø¨Ø±Ø§ÛŒ Ú†Ú© Ú©Ø±Ø¯Ù† Ù¾Ø±Ù…ÛŒÚ˜Ù†â€ŒÙ‡Ø§
const { user, hasPermission } = useAuth()

// ØªØ¹Ø±ÛŒÙ interface Ù‡Ø§
interface Stats {
  todaySms: number
  successRate: number
  responseTime: number
  todayErrors: number
}

interface WeeklyPerformance {
  day: string
  count: number
  percentage: number
}

interface Gateway {
  id: number
  name: string
  status: 'active' | 'inactive'
  responseTime: number
}



interface Alert {
  id: number
  title: string
  message: string
  timestamp: string
}

interface SmsRecord {
  id: number
  timestamp: string
  message: string
  phoneNumber: string
  phone_number?: string
  status: 'success' | 'failed' | 'pending' | 'finish' | 'error' | 'sending' | 'delivered' | 'undelivered'
  gateway: string
  service?: string
  type?: string
  cost?: number
  state?: string
  status_text?: string
  created_at?: string
  sent_at?: string
}

interface GatewaySmsData {
  gateway: {
    id: number
    name: string
    type: string
    priority: number
    is_active: boolean
    balance?: number
    credit?: number
  }
  smsList: SmsRecord[]
  stats: {
    total: number
    success: number
    failed: number
    pending: number
    successRate: number
  }
  pagination?: {
    currentPage: number
    totalPages: number
    itemsPerPage: number
  }
}

// Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ reactive
const stats = ref<Stats>({
  todaySms: 0,
  successRate: 0,
  responseTime: 0,
  todayErrors: 0
})

const weeklyPerformance = ref<WeeklyPerformance[]>([
  { day: 'Ø´Ù†Ø¨Ù‡', count: 156, percentage: 85 },
  { day: 'ÛŒÚ©Ø´Ù†Ø¨Ù‡', count: 142, percentage: 78 },
  { day: 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', count: 189, percentage: 92 },
  { day: 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', count: 167, percentage: 88 },
  { day: 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', count: 198, percentage: 95 },
  { day: 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡', count: 145, percentage: 80 },
  { day: 'Ø¬Ù…Ø¹Ù‡', count: 123, percentage: 75 }
])

// Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ (Ø§Ø² API Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒØ´ÙˆØ¯)
const gateways = ref<Gateway[]>([])



const alerts = ref<Alert[]>([
  { id: 1, title: 'Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ù…', message: 'Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ Ú©Ø§ÙˆÙ‡â€ŒÙ†Ú¯Ø§Ø± Ú©Ù…ØªØ± Ø§Ø² 1000 ØªÙˆÙ…Ø§Ù† Ø§Ø³Øª', timestamp: '2024/01/15 14:30' },
  { id: 2, title: 'Ø®Ø·Ø§ÛŒ Ø§ØªØµØ§Ù„', message: 'Ø¯Ø±Ú¯Ø§Ù‡ Ø¢ÙˆØ§ÛŒ Ù¾ÛŒØ§Ù…Ú© Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª', timestamp: '2024/01/15 14:25' }
])

const smsFilter = ref('all')

// ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ - Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø±Ú¯Ø§Ù‡
const itemsPerPage = ref(10)

// Ù„ÛŒØ³Øª SMS Ù‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ (Ø§Ø² API Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒØ´ÙˆØ¯)
const smsList = ref<SmsRecord[]>([])

// Ù„ÛŒØ³Øª SMS Ù‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§
const gatewaySmsData = ref<GatewaySmsData[]>([])

// Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ø¨Ø§ Ø§ÙˆÙ„ÙˆÛŒØª
const activeGateways = ref<any[]>([])

const loading = ref(false)
const smsHistory = computed(() => {
  // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù‡Ù…Ù‡ Ù¾ÛŒØ§Ù…Ú©â€ŒÙ‡Ø§ Ø§Ø² Ù‡Ù…Ù‡ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§
  return gatewaySmsData.value.flatMap(g => g.smsList)
})

// Computed properties
const filteredSmsList = computed(() => {
  if (smsFilter.value === 'all' || smsFilter.value === '') return smsList.value
  return smsList.value.filter(sms => sms.status === smsFilter.value)
})

// ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† SMS Ù‡Ø§ÛŒ Ù‡Ø± Ø¯Ø±Ú¯Ø§Ù‡
const filteredGatewaySmsData = computed(() => {
  return gatewaySmsData.value.map(gatewayData => {
    const filteredList = smsFilter.value === 'all' || smsFilter.value === '' 
      ? gatewayData.smsList 
      : gatewayData.smsList.filter(sms => sms.status === smsFilter.value)
    
    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† (Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø§ÙˆÙ„)
    const sortedList = filteredList
      .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())
    
    // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ
    const currentPage = gatewayData.pagination?.currentPage || 1
    const currentItemsPerPage = gatewayData.pagination?.itemsPerPage || itemsPerPage.value
    const totalPages = Math.ceil(sortedList.length / currentItemsPerPage)
    const startIndex = (currentPage - 1) * currentItemsPerPage
    const endIndex = startIndex + currentItemsPerPage
    const displayList = sortedList.slice(startIndex, endIndex)
    
    return {
      ...gatewayData,
      smsList: displayList,
      // Ø­ÙØ¸ Ø¢Ù…Ø§Ø± Ø§ØµÙ„ÛŒ
      stats: {
        ...gatewayData.stats,
        displayCount: displayList.length,
        totalFiltered: sortedList.length
      },
      pagination: {
        currentPage,
        totalPages: Math.max(1, totalPages),
        itemsPerPage: currentItemsPerPage
      }
    }
  })
})

// Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ (ÙÙ‚Ø· Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ´Ù†)
const sortedGatewaySmsData = computed(() => {
  console.log('ğŸ” sortedGatewaySmsData computed - gatewaySmsData.length:', gatewaySmsData.value.length)
  console.log('ğŸ” sortedGatewaySmsData computed - activeGateways.length:', activeGateways.value.length)
  console.log('ğŸ” sortedGatewaySmsData computed - activeGateways:', activeGateways.value)
  console.log('ğŸ” sortedGatewaySmsData computed - gatewaySmsData:', gatewaySmsData.value)
  
  // Ø§Ú¯Ø± gatewaySmsData Ø®Ø§Ù„ÛŒ Ø§Ø³ØªØŒ Ø§Ø² activeGateways Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
  if (gatewaySmsData.value.length === 0 && activeGateways.value.length > 0) {
    const filteredActiveGateways = activeGateways.value.filter(gateway => gateway.is_active)
    console.log('ğŸ” filteredActiveGateways:', filteredActiveGateways)
    
    const result = filteredActiveGateways.map(gateway => ({
              gateway: {
          id: gateway.id,
          name: gateway.name,
          type: gateway.type,
          priority: gateway.priority || 1,
          is_active: gateway.is_active,
          balance: gateway.balance || 0,
          credit: gateway.credit || 0
        },
      smsList: [], // Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ
      stats: {
        total: 0,
        success: 0,
        failed: 0,
        pending: 0,
        successRate: 0
      },
      pagination: {
        currentPage: 1,
        totalPages: 1,
        itemsPerPage: 10 // Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø±Ú¯Ø§Ù‡
      }
    }))
    
    console.log('ğŸ” sortedGatewaySmsData result:', result)
    return result
  }
  
  // Ø§Ú¯Ø± gatewaySmsData Ø®Ø§Ù„ÛŒ Ù†ÛŒØ³ØªØŒ Ø§Ø² Ø¢Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
  if (gatewaySmsData.value.length > 0) {
    // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† ÙÙ‚Ø· Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ´Ù†
    const filteredResult = gatewaySmsData.value.filter(gatewayData => gatewayData.gateway.is_active)
    console.log('ğŸ” gatewaySmsData filtered result:', filteredResult)
    return filteredResult
  }
  
  // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù†ÛŒØ³ØªØŒ Ø¢Ø±Ø§ÛŒÙ‡ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
  console.log('ğŸ” Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯')
  return []
})

// Ù…ØªØ¯Ù‡Ø§
const loadGatewaysStatus = async () => {
  try {
    // Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ø§Ø² API
    const gatewaysResponse = await $fetch<{status: string, data: any[]}>('/api/sms-gateways', {
      method: 'GET'
    })
    
    if (gatewaysResponse.status === 'success' && gatewaysResponse.data) {
      // ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ API Ø¨Ù‡ ÙØ±Ù…Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
      const gatewayStatusList: Gateway[] = []
      
      for (const gateway of gatewaysResponse.data) {
        // ÙˆØ¶Ø¹ÛŒØª Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ is_active ØªÙ†Ø¸ÛŒÙ… Ú©Ù† (Ø¨Ø¯ÙˆÙ† ØªØ³Øª Ø§ØªØµØ§Ù„)
        const status: 'active' | 'inactive' = gateway.is_active ? 'active' : 'inactive'
        const responseTime = gateway.is_active ? Math.floor(Math.random() * 200) + 50 : 0 // Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø® ØªØµØ§Ø¯ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„
        
        gatewayStatusList.push({
          id: gateway.id,
          name: gateway.name,
          status: status,
          responseTime: responseTime
        })
      }
      
      gateways.value = gatewayStatusList
    }
  } catch (error) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§:', error)
  }
}

// ØªØ§Ø¨Ø¹ testGatewaysConnection Ø­Ø°Ù Ø´Ø¯Ù‡



const exportReport = () => {
  const reportData = {
    stats: stats.value,
    weeklyPerformance: weeklyPerformance.value,
    gateways: gateways.value,
    timestamp: new Date().toISOString()
  }
  
  const dataStr = JSON.stringify(reportData, null, 2)
  const dataBlob = new Blob([dataStr], { type: 'application/json' })
  const url = URL.createObjectURL(dataBlob)
  const link = document.createElement('a')
  link.href = url
  link.download = `monitoring-report-${new Date().toISOString().split('T')[0]}.json`
  link.click()
  URL.revokeObjectURL(url)
}

const dismissAlert = (alertId: number) => {
  alerts.value = alerts.value.filter(alert => alert.id !== alertId)
}



// ØªÙˆØ§Ø¨Ø¹ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ SMS
const refreshSmsData = async () => {
  try {
    console.log('ğŸ”„ refreshSmsData Ø´Ø±ÙˆØ¹ Ø´Ø¯')
    console.log('ğŸ”„ activeGateways Ø¯Ø± refreshSmsData:', activeGateways.value)
    
    // Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ùˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ SMS
    const gatewayData: GatewaySmsData[] = []
    
    for (const gateway of activeGateways.value) {
      console.log('ğŸ”„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ú¯Ø§Ù‡:', gateway)
      
      // Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø±Ú¯Ø§Ù‡
      const gatewayItem = {
        gateway: {
          id: gateway.id,
          name: gateway.name,
          type: gateway.type,
          priority: gateway.priority || 1,
          is_active: gateway.is_active,
          balance: gateway.balance || 0
        },
        smsList: [], // Ø§Ø¨ØªØ¯Ø§ Ø®Ø§Ù„ÛŒ
        stats: {
          total: 0,
          success: 0,
          failed: 0,
          pending: 0,
          successRate: 0
        },
        pagination: {
          currentPage: 1,
          totalPages: 1,
          itemsPerPage: 10 // Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø±Ú¯Ø§Ù‡
        }
      }
      
      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ SMS Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ø¯Ø±Ú¯Ø§Ù‡
      try {
        if (gateway.type === 'ippanel') {
          console.log('ğŸ“¡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾ÛŒØ§Ù…Ú©â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ IPPanel...')
          const response = await $fetch<{status: string, data: any}>(`/api/ippanel-outbox?page=1&limit=${gatewayItem.pagination.itemsPerPage}`, {
            method: 'GET'
          })
          
          if (response.status === 'success' && response.data && response.data.messages) {
            const smsList = response.data.messages.map((msg: any) => ({
              id: msg.id || Math.random(),
              timestamp: msg.created_at,
              sent_at: msg.sent_at,
              message: msg.message,
              phoneNumber: msg.phone_number,
              phone_number: msg.phone_number,
              status: msg.status,
              type: msg.type,
              cost: msg.cost,
              gateway: gateway.name
            }))
            
            const total = response.data.pagination?.total || smsList.length
            const success = smsList.filter((sms: any) => sms.status === 'finish').length
            const failed = smsList.filter((sms: any) => sms.status === 'error').length
            const pending = smsList.filter((sms: any) => sms.status === 'sending').length
            const successRate = total > 0 ? Math.round((success / total) * 100 * 100) / 100 : 0
            
            gatewayItem.smsList = smsList
            gatewayItem.stats = { total, success, failed, pending, successRate }
            gatewayItem.pagination.totalPages = Math.ceil(total / gatewayItem.pagination.itemsPerPage)
            
            console.log('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ IPPanel Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯:', total, 'Ù¾ÛŒØ§Ù…Ú©')
          }
        } else if (gateway.type === 'farazsms') {
          console.log('ğŸ“¡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾ÛŒØ§Ù…Ú©â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ ÙØ±Ø§Ø² Ø§Ø³â€ŒØ§Ù…â€ŒØ§Ø³...')
          const response = await $fetch<{status: string, data: any}>(`/api/farazsms-outbox?page=1&limit=${gatewayItem.pagination.itemsPerPage}`, {
            method: 'GET'
          })
          
          if (response.status === 'success' && response.data && response.data.messages) {
            const smsList = response.data.messages.map((msg: any) => ({
              id: msg.id || Math.random(),
              timestamp: msg.created_at,
              sent_at: msg.sent_at,
              message: msg.message,
              phoneNumber: msg.phone_number,
              phone_number: msg.phone_number,
              status: msg.status,
              type: msg.type,
              cost: msg.cost,
              gateway: gateway.name
            }))
            
            const total = response.data.pagination?.total || smsList.length
            const success = smsList.filter((sms: any) => sms.status === 'finish').length
            const failed = smsList.filter((sms: any) => sms.status === 'error').length
            const pending = smsList.filter((sms: any) => sms.status === 'sending').length
            const successRate = total > 0 ? Math.round((success / total) * 100 * 100) / 100 : 0
            
            gatewayItem.smsList = smsList
            gatewayItem.stats = { total, success, failed, pending, successRate }
            gatewayItem.pagination.totalPages = Math.ceil(total / gatewayItem.pagination.itemsPerPage)
            
            console.log('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±Ø§Ø² Ø§Ø³â€ŒØ§Ù…â€ŒØ§Ø³ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯:', total, 'Ù¾ÛŒØ§Ù…Ú©')
          }
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ú¯Ø§Ù‡', gateway.name, ':', error)
      }
      
      gatewayData.push(gatewayItem)
    }
    
    console.log('ğŸ”„ gatewayData Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡:', gatewayData)
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
    gatewaySmsData.value = gatewayData
    console.log('ğŸ”„ gatewaySmsData Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯:', gatewaySmsData.value)
    
  } catch (error) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ SMS:', error)
    // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†Ø¯Ù‡
    gatewaySmsData.value = []
  }
}

// Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡
const getGatewayBalance = async (gatewayId: number): Promise<number> => {
  try {
    const response = await $fetch<{status: string, data: {balance: number}}>(`/api/sms-gateways/${gatewayId}/balance`, {
      method: 'GET'
    })
    
    if (response.status === 'success' && response.data) {
      return response.data.balance || 0
    }
    return 0
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡', gatewayId, ':', error)
    return 0
  }
}

// Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ù…Ù„ÛŒ Ù¾ÛŒØ§Ù…Ú© (ØªØ¹Ø¯Ø§Ø¯ SMS Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø±ÛŒØ§Ù„ÛŒ)
const getMeliPayamakInfo = async (gatewayId: number): Promise<{remaining_sms: number, credit: number}> => {
  try {
    const response = await $fetch<{status: string, data: {remaining_sms: number, credit: number}}>(`/api/sms-gateways/${gatewayId}/melipayamak-info`, {
      method: 'GET'
    })
    
    if (response.status === 'success' && response.data) {
      return {
        remaining_sms: response.data.remaining_sms || 0,
        credit: response.data.credit || 0
      }
    }
    return { remaining_sms: 0, credit: 0 }
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ù„ÛŒ Ù¾ÛŒØ§Ù…Ú©', gatewayId, ':', error)
    return { remaining_sms: 0, credit: 0 }
  }
}

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„
const loadActiveGateways = async () => {
  try {
    console.log('ğŸ”„ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„...')
    const response = await $fetch<{status: string, data: any[]}>('/api/sms-gateways', { 
      method: 'GET'
    })
    
    console.log('ğŸ“¡ Ù¾Ø§Ø³Ø® API Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§:', response)
    
    if (response.status === 'success' && response.data) {
      // Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ø­Ø§Ù„Ø§ Ø§Ø² backend ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
      const allGateways = response.data
      const activeOnly = allGateways
        .sort((a: any, b: any) => (a.priority || 1) - (b.priority || 1))
        .map((g: any, idx: number) => ({ ...g, priority: idx + 1 }))
      
      console.log('ğŸ“Š Ù‡Ù…Ù‡ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§:', allGateways.length)
      console.log('ğŸ“Š Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„:', activeOnly.length)
      console.log('ğŸ“Š Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„:', activeOnly)
      
      // Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø±Ú¯Ø§Ù‡
      for (const gateway of activeOnly) {
        try {
          // Ø¨Ø±Ø§ÛŒ Ù…Ù„ÛŒ Ù¾ÛŒØ§Ù…Ú© Ø§Ø² endpoint Ø¬Ø¯ÛŒØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
          if (gateway.type === 'meli_payamak') {
            const meliInfo = await getMeliPayamakInfo(gateway.id)
            gateway.balance = meliInfo.remaining_sms // ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ SMS
            gateway.credit = meliInfo.credit // Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø±ÛŒØ§Ù„ÛŒ
            console.log(`ğŸ’° Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ù„ÛŒ Ù¾ÛŒØ§Ù…Ú© ${gateway.name}:`, meliInfo)
          } else {
            // Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ø§Ø² endpoint Ù‚Ø¨Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
            const balance = await getGatewayBalance(gateway.id)
            gateway.balance = balance
            console.log(`ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ ${gateway.name}:`, balance)
          }
        } catch (error) {
          console.error(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ ${gateway.name}:`, error)
          gateway.balance = 0
          gateway.credit = 0
        }
      }
      
      activeGateways.value = activeOnly
    } else {
      console.log('âŒ Ù¾Ø§Ø³Ø® API Ù†Ø§Ù…Ø¹ØªØ¨Ø±:', response)
      activeGateways.value = []
    }
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„:', error)
    activeGateways.value = []
  }
}

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ

const formatDateTime = (timestamp: string) => {
  const date = new Date(timestamp)
  return new Intl.DateTimeFormat('fa-IR', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  }).format(date)
}

const getSmsStatusClass = (status: string) => {
  switch (status) {
    case 'success':
    case 'finish':
    case 'delivered':
      return 'bg-green-100 text-green-800'
    case 'failed':
    case 'error':
    case 'undelivered':
      return 'bg-red-100 text-red-800'
    case 'pending':
    case 'sending':
      return 'bg-yellow-100 text-yellow-800'
    default:
      return 'bg-gray-100 text-gray-800'
  }
}

const getSmsStatusText = (status: string) => {
  switch (status) {
    case 'success':
    case 'finish':
      return 'Ù…ÙˆÙÙ‚'
    case 'failed':
    case 'error':
      return 'Ù†Ø§Ù…ÙˆÙÙ‚'
    case 'pending':
    case 'sending':
      return 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±'
    case 'delivered':
      return 'ØªØ­ÙˆÛŒÙ„ Ø´Ø¯Ù‡'
    case 'undelivered':
      return 'ØªØ­ÙˆÛŒÙ„ Ù†Ø´Ø¯Ù‡'
    default:
      return status || 'Ù†Ø§Ù…Ø´Ø®Øµ'
  }
}

// ØªØ§Ø¨Ø¹ testIPPanelAPI Ø­Ø°Ù Ø´Ø¯Ù‡

// ØªØ§Ø¨Ø¹ testIPPanelFilters Ø­Ø°Ù Ø´Ø¯Ù‡



  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹
onMounted(async () => {
  // Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†
  await loadActiveGateways()
  // Ø³Ù¾Ø³ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†
  await refreshGatewayBalances()
  // Ø³Ù¾Ø³ Ø³Ø§Ø®ØªØ§Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†
  await refreshSmsData()
  // Ø³Ù¾Ø³ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ùˆ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§
  await loadGatewaysStatus()
})









// Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ú¯Ø§Ù‡
const showGatewayDetails = (gateway: any) => {
  try {
    // Ø¨Ø±Ø±Ø³ÛŒ Ú†Ù†Ø¯ÛŒÙ† ÙÛŒÙ„Ø¯ Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒØ¯ API ÛŒØ§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯
    // Ø§Ú¯Ø± api_url Ù†Ø¨ÙˆØ¯ØŒ Ø³Ø±Ø§Øº apiKeyØŒ api_keyØŒ username Ùˆ password Ù‡Ù… Ø¨Ø±Ùˆ
    const apiKey = gateway.api_url || gateway.apiKey || gateway.api_key || '';
    const apiKeyDisplay = apiKey ? apiKey.substring(0, 15) + '...' : 'ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡';
    const apiKeyLength = apiKey ? apiKey.length : 0;
    // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ú©Ù„ÛŒØ¯ÛŒ Ù†Ø¨ÙˆØ¯ Ø§Ù…Ø§ username Ùˆ password ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªØŒ Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ù‡Ù… Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
    let authInfo = '';
    if (!apiKey && (gateway.username || gateway.password)) {
      authInfo = `ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: ${gateway.username || 'Ù†Ø¯Ø§Ø±Ø¯'}\nÙ¾Ø³ÙˆØ±Ø¯: ${gateway.password ? '******' : 'Ù†Ø¯Ø§Ø±Ø¯'}`;
    }
    const details = `Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ú¯Ø§Ù‡ ${gateway.name}:\n\n` +
                   `Ù†Ø§Ù…: ${gateway.name}\n` +
                   `Ù†ÙˆØ¹: ${gateway.type}\n` +
                   `Ú©Ù„ÛŒØ¯ API: ${apiKeyDisplay}\n` +
                   `Ø·ÙˆÙ„ Ú©Ù„ÛŒØ¯: ${apiKeyLength} Ú©Ø§Ø±Ø§Ú©ØªØ±\n` +
                   (authInfo ? authInfo + '\n' : '') +
                   `Ø´Ù…Ø§Ø±Ù‡ ÙØ±Ø³ØªÙ†Ø¯Ù‡: ${gateway.sender_number || 'ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡'}\n` +
                   `ÙØ¹Ø§Ù„: ${gateway.is_active ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±'}\n` +
                   `Ø¨Ø± Ø§Ø³Ø§Ø³ Ù¾ØªØ±Ù†: ${gateway.pattern_based ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±'}\n` +
                   `Ø§ÙˆÙ„ÙˆÛŒØª: ${gateway.priority || 1}\n` +
                   `ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯: ${gateway.created_at ? new Date(gateway.created_at).toLocaleDateString('fa-IR') : 'Ù†Ø§Ù…Ø´Ø®Øµ'}\n` +
                   `Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${gateway.updated_at ? new Date(gateway.updated_at).toLocaleDateString('fa-IR') : 'Ù†Ø§Ù…Ø´Ø®Øµ'}`
    
    alert(details)
  } catch (error) {
    console.error('Ø®Ø·Ø§ Ø¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ú¯Ø§Ù‡:', error)
    alert('Ø®Ø·Ø§ Ø¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ú¯Ø§Ù‡: ' + error)
  }
}

// ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ú¯Ø§Ù‡
const testGatewaySend = async (gateway: any) => {
  alert('Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª')
}

// ØªØºÛŒÛŒØ± ØµÙØ­Ù‡ (Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø§Ø² API Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ± page Ùˆ limit)
const handlePageChange = async (gatewayId: number, newPage: number) => {
  // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¯Ø±Ú¯Ø§Ù‡
  const gatewayIndex = gatewaySmsData.value.findIndex(g => g.gateway.id === gatewayId)
  if (gatewayIndex !== -1) {
    const gateway = gatewaySmsData.value[gatewayIndex].gateway
    const currentLimit = gatewaySmsData.value[gatewayIndex].pagination?.itemsPerPage || itemsPerPage.value
    let apiUrl = ''
    // ØªØ¹ÛŒÛŒÙ† Ø¢Ø¯Ø±Ø³ API Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ø¯Ø±Ú¯Ø§Ù‡
    if (gateway.type === 'ippanel') {
      apiUrl = `/api/ippanel-outbox?page=${newPage}&limit=${currentLimit}`
    } else if (gateway.type === 'farazsms') {
      apiUrl = `/api/farazsms-outbox?page=${newPage}&limit=${currentLimit}`
    } else {
      return
    }
    try {
      // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø§Ø² API
      const response = await $fetch<{status: string, data: any}>(apiUrl, { method: 'GET' })
      if (response.status === 'success' && response.data && response.data.messages) {
        // ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ÙØ±Ù…Øª Ø¬Ø¯ÙˆÙ„
        const smsList = response.data.messages.map((msg: any) => ({
          id: msg.id || Math.random(),
          timestamp: msg.created_at,
          sent_at: msg.sent_at,
          message: msg.message,
          phoneNumber: msg.phone_number,
          phone_number: msg.phone_number,
          status: msg.status,
          type: msg.type,
          cost: msg.cost,
          gateway: gateway.name
        }))
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ smsList Ùˆ pagination
        gatewaySmsData.value[gatewayIndex].smsList = smsList
        gatewaySmsData.value[gatewayIndex].pagination = {
          currentPage: newPage,
          totalPages: Math.ceil((response.data.pagination?.total || smsList.length) / currentLimit),
          itemsPerPage: currentLimit
        }
      }
    } catch (error) {
      console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØµÙØ­Ù‡ Ø¬Ø¯ÛŒØ¯:', error)
    }
  }
}

// ØªØºÛŒÛŒØ± ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ… Ø¯Ø± Ù‡Ø± ØµÙØ­Ù‡ (Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø§Ø² API Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ± Ø¬Ø¯ÛŒØ¯)
const handleItemsPerPageChange = async (newItemsPerPage: number, gatewayId?: number) => {
  // Ø§Ú¯Ø± gatewayId Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡ØŒ ÙÙ‚Ø· Ù‡Ù…Ø§Ù† Ø¯Ø±Ú¯Ø§Ù‡ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡
  if (gatewayId) {
    const gatewayIndex = gatewaySmsData.value.findIndex(g => g.gateway.id === gatewayId)
    if (gatewayIndex !== -1) {
      gatewaySmsData.value[gatewayIndex].pagination!.itemsPerPage = newItemsPerPage
      await handlePageChange(gatewayId, 1)
    }
  } else {
    // Ø§Ú¯Ø± gatewayId Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡ØŒ Ù‡Ù…Ù‡ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡ (Ø±ÙØªØ§Ø± Ù‚Ø¨Ù„ÛŒ)
    itemsPerPage.value = newItemsPerPage
    for (const gatewayData of gatewaySmsData.value) {
      gatewayData.pagination!.itemsPerPage = newItemsPerPage
      await handlePageChange(gatewayData.gateway.id, 1)
    }
  }
}

// ØªØ§Ø¨Ø¹ ØªØ³Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
const debugData = () => {
  console.log('ğŸ” === DEBUG DATA ===')
  console.log('ğŸ” activeGateways:', activeGateways.value)
  console.log('ğŸ” gatewaySmsData:', gatewaySmsData.value)
  console.log('ğŸ” sortedGatewaySmsData:', sortedGatewaySmsData.value)
  console.log('ğŸ” sortedGatewaySmsData.length:', sortedGatewaySmsData.value.length)
  
  // ØªØ³Øª API Ù‡Ø§ÛŒ outbox
  testOutboxAPIs()
  
  alert(`ØªØ³Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:\n\n` +
        `activeGateways: ${activeGateways.value.length}\n` +
        `gatewaySmsData: ${gatewaySmsData.value.length}\n` +
        `sortedGatewaySmsData: ${sortedGatewaySmsData.value.length}\n\n` +
        `Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø±`)
}

// ØªØ³Øª API Ù‡Ø§ÛŒ outbox
const testOutboxAPIs = async () => {
  try {
    console.log('ğŸ§ª ØªØ³Øª API Ù‡Ø§ÛŒ outbox...')
    
    // ØªØ³Øª IPPanel outbox
    console.log('ğŸ§ª ØªØ³Øª IPPanel outbox...')
    const ippanelResponse = await $fetch('/api/ippanel-outbox?page=1&limit=5', { method: 'GET' })
    console.log('ğŸ“¡ Ù¾Ø§Ø³Ø® IPPanel outbox:', ippanelResponse)
    
    // ØªØ³Øª ÙØ±Ø§Ø² Ø§Ø³â€ŒØ§Ù…â€ŒØ§Ø³ outbox
    console.log('ğŸ§ª ØªØ³Øª ÙØ±Ø§Ø² Ø§Ø³â€ŒØ§Ù…â€ŒØ§Ø³ outbox...')
    const farazResponse = await $fetch('/api/farazsms-outbox?page=1&limit=5', { method: 'GET' })
    console.log('ğŸ“¡ Ù¾Ø§Ø³Ø® ÙØ±Ø§Ø² Ø§Ø³â€ŒØ§Ù…â€ŒØ§Ø³ outbox:', farazResponse)
    
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª API Ù‡Ø§ÛŒ outbox:', error)
  }
}

// Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§
const refreshGatewayBalances = async () => {
  try {
    console.log('ğŸ’° Ø´Ø±ÙˆØ¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§...')
    
    for (const gateway of activeGateways.value) {
      try {
        // Ø¨Ø±Ø§ÛŒ Ù…Ù„ÛŒ Ù¾ÛŒØ§Ù…Ú© Ø§Ø² endpoint Ø¬Ø¯ÛŒØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
        if (gateway.type === 'meli_payamak') {
          const meliInfo = await getMeliPayamakInfo(gateway.id)
          gateway.balance = meliInfo.remaining_sms // ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ SMS
          gateway.credit = meliInfo.credit // Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø±ÛŒØ§Ù„ÛŒ
          console.log(`ğŸ’° Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ù„ÛŒ Ù¾ÛŒØ§Ù…Ú© ${gateway.name}:`, meliInfo)
        } else {
          // Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ø§Ø² endpoint Ù‚Ø¨Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
          const balance = await getGatewayBalance(gateway.id)
          gateway.balance = balance
          console.log(`ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ ${gateway.name}:`, balance)
        }
      } catch (error) {
        console.error(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ ${gateway.name}:`, error)
        gateway.balance = 0
        gateway.credit = 0
      }
    }
    
    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ gatewaySmsData Ù†ÛŒØ²
    for (const gatewayData of gatewaySmsData.value) {
      const gateway = activeGateways.value.find(g => g.id === gatewayData.gateway.id)
      if (gateway) {
        gatewayData.gateway.balance = gateway.balance
        gatewayData.gateway.credit = gateway.credit
      }
    }
    
    console.log('âœ… Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯')
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§:', error)
  }
}

// Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª SMS
const viewSmsDetails = (sms: SmsRecord) => {
  const details = `Ø¬Ø²Ø¦ÛŒØ§Øª SMS:\n\n` +
                 `Ø´Ù†Ø§Ø³Ù‡: ${sms.id}\n` +
                 `Ø²Ù…Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯: ${formatDateTime(sms.created_at || sms.timestamp)}\n` +
                 `Ø²Ù…Ø§Ù† Ø§Ø±Ø³Ø§Ù„: ${formatDateTime(sms.sent_at || sms.timestamp)}\n` +
                 `Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†: ${sms.phone_number || sms.phoneNumber}\n` +
                 `Ù†ÙˆØ¹: ${sms.type || sms.service || 'Ø¹Ù…ÙˆÙ…ÛŒ'}\n` +
                 `ÙˆØ¶Ø¹ÛŒØª: ${getSmsStatusText(sms.status)}\n` +
                 `ÙˆØ¶Ø¹ÛŒØª Ø¯Ù‚ÛŒÙ‚: ${sms.status_text || sms.status || 'Ù†Ø§Ù…Ø´Ø®Øµ'}\n` +
                 `Ø¯Ø±Ú¯Ø§Ù‡: ${sms.gateway || 'Ù†Ø§Ù…Ø´Ø®Øµ'}\n` +
                 `Ù‡Ø²ÛŒÙ†Ù‡: ${sms.cost ? Number(sms.cost).toLocaleString('fa-IR') + ' Ø±ÛŒØ§Ù„' : 'Ù†Ø§Ù…Ø´Ø®Øµ'}\n` +
                 `Ù¾ÛŒØ§Ù…:\n${sms.message}`
  
  alert(details)
}




</script>

<style scoped>
/* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ */
</style> 

