<template>
  <div class="space-y-6">
    <!-- ูุฏุฑ ุจุฎุด -->
    <div class="flex items-center justify-between">
      <div>
        <h3 class="text-lg font-semibold text-gray-900">ูุฏุฑุช ุงููุงุน ฺฏูุช ฺฉุงุฑุช</h3>
        <p class="text-sm text-gray-600">ุชูุธู ู ูุฏุฑุช ุงููุงุน ูุฎุชูู ฺฏูุช ฺฉุงุฑุช</p>
      </div>
      <button
        @click="showCreateModal = true"
        class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
      >
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        ุงูุฒูุฏู ููุน ุฌุฏุฏ
      </button>
    </div>

    <!-- ุขูุงุฑ ฺฉู ุงููุงุน -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <div class="flex items-center">
          <div class="p-2 bg-blue-100 rounded-lg">
            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
            </svg>
          </div>
          <div class="ml-3">
            <p class="text-sm font-medium text-gray-600">ฺฉู ุงููุงุน</p>
            <p class="text-2xl font-bold text-gray-900">{{ types.length }}</p>
          </div>
        </div>
      </div>

      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <div class="flex items-center">
          <div class="p-2 bg-green-100 rounded-lg">
            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <div class="ml-3">
            <p class="text-sm font-medium text-gray-600">ูุนุงู</p>
            <p class="text-2xl font-bold text-gray-900">{{ activeTypes.length }}</p>
          </div>
        </div>
      </div>

      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <div class="flex items-center">
          <div class="p-2 bg-purple-100 rounded-lg">
            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
            </svg>
          </div>
          <div class="ml-3">
            <p class="text-sm font-medium text-gray-600">ูุชุบุฑ</p>
            <p class="text-2xl font-bold text-gray-900">{{ variableTypes.length }}</p>
          </div>
        </div>
      </div>

      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <div class="flex items-center">
          <div class="p-2 bg-orange-100 rounded-lg">
            <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
            </svg>
          </div>
          <div class="ml-3">
            <p class="text-sm font-medium text-gray-600">ููุถูุน</p>
            <p class="text-2xl font-bold text-gray-900">{{ themedTypes.length }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ููุชุฑูุง ู ุฌุณุชุฌู -->
    <div class="bg-white p-6 rounded-lg border border-gray-200">
      <div class="flex flex-col sm:flex-row gap-6">
        <div class="flex-1">
          <input
            v-model="searchQuery"
            type="text"
            placeholder="ุฌุณุชุฌู ุฏุฑ ุงููุงุน..."
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
        </div>
        <div class="flex gap-2">
          <select
            v-model="statusFilter"
            class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
            <option value="">ููู ูุถุนุชโูุง</option>
            <option value="active">ูุนุงู</option>
            <option value="inactive">ุบุฑูุนุงู</option>
          </select>
          <select
            v-model="categoryFilter"
            class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
            <option value="">ููู ุฏุณุชูโูุง</option>
            <option value="fixed">ูุจูุบ ุซุงุจุช</option>
            <option value="variable">ูุจูุบ ูุชุบุฑ</option>
            <option value="themed">ููุถูุน</option>
            <option value="corporate">ุดุฑฺฉุช</option>
            <option value="discount">ุชุฎูู ูฺู</option>
          </select>
        </div>
      </div>
    </div>

    <!-- ูุณุช ุงููุงุน -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div
        v-for="type in filteredTypes"
        :key="type.id"
        class="bg-white rounded-lg border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow"
      >
        <!-- ูุฏุฑ ฺฉุงุฑุช -->
        <div class="relative h-32 bg-gradient-to-br from-blue-400 to-purple-600">
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="text-white text-center">
              <div class="text-3xl mb-2">{{ type.icon }}</div>
              <h3 class="text-lg font-semibold">{{ type.name }}</h3>
            </div>
          </div>
          <div class="absolute top-2 right-2">
            <span
              :class="{
                'bg-green-100 text-green-800': type.status === 'active',
                'bg-red-100 text-red-800': type.status === 'inactive'
              }"
              class="px-2 py-1 text-xs font-medium rounded-full"
            >
              {{ getStatusText(type.status) }}
            </span>
          </div>
        </div>

        <!-- ุงุทูุงุนุงุช ููุน -->
        <div class="p-6">
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-lg font-semibold text-gray-900">{{ type.name }}</h4>
            <span class="text-sm text-gray-500">{{ type.category }}</span>
          </div>
          
          <p class="text-sm text-gray-600 mb-4">{{ type.description }}</p>

          <!-- ุชูุธูุงุช ูุจูุบ -->
          <div class="space-y-2 mb-4">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600">ููุน ูุจูุบ:</span>
              <span class="text-gray-900">{{ getAmountTypeText(type.amountType) }}</span>
            </div>
            <div v-if="type.amountType === 'fixed'" class="flex items-center justify-between text-sm">
              <span class="text-gray-600">ูุจูุบ ุซุงุจุช:</span>
              <span class="text-gray-900 font-medium">{{ formatCurrency(type.fixedAmount) }}</span>
            </div>
            <div v-if="type.amountType === 'variable'" class="space-y-1">
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">ุญุฏุงูู:</span>
                <span class="text-gray-900 font-medium">{{ formatCurrency(type.minAmount) }}</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">ุญุฏุงฺฉุซุฑ:</span>
                <span class="text-gray-900 font-medium">{{ formatCurrency(type.maxAmount) }}</span>
              </div>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600">ุชุงุฑุฎ ุงููุถุง:</span>
              <span class="text-gray-900">{{ type.expiryDays }} ุฑูุฒ</span>
            </div>
          </div>

          <!-- ุขูุงุฑ ุงุณุชูุงุฏู -->
          <div class="grid grid-cols-2 gap-6 mb-4">
            <div class="text-center">
              <p class="text-2xl font-bold text-blue-600">{{ type.usageCount }}</p>
              <p class="text-xs text-gray-500">ุงุณุชูุงุฏู ุดุฏู</p>
            </div>
            <div class="text-center">
              <p class="text-2xl font-bold text-green-600">{{ type.totalValue }}</p>
              <p class="text-xs text-gray-500">ฺฉู ุงุฑุฒุด (ูุฒุงุฑ)</p>
            </div>
          </div>

          <!-- ุฏฺฉููโูุง ุนููุงุช -->
          <div class="flex gap-2">
            <button
              @click="editType(type)"
              class="flex-1 px-3 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
            >
              ูุฑุงุด
            </button>
            <button
              @click="viewTypeDetails(type)"
              class="flex-1 px-3 py-2 bg-gray-600 text-white text-sm font-medium rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
            >
              ุฌุฒุฆุงุช
            </button>
            <button
              @click="deleteType(type)"
              class="px-3 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ููุฏุงู ุงุฌุงุฏ ููุน ุฌุฏุฏ -->
    <GiftCardTypeCreateModal
      v-if="showCreateModal"
      @close="showCreateModal = false"
      @created="handleTypeCreated"
    />

    <!-- ููุฏุงู ูุฑุงุด ููุน -->
    <GiftCardTypeEditModal
      v-if="showEditModal"
      :type="selectedType"
      @close="showEditModal = false"
      @updated="handleTypeUpdated"
    />
  </div>
</template>

<script setup>
// ุชุนุฑู ูุชุบุฑูุง reactive
const searchQuery = ref('')
const statusFilter = ref('')
const categoryFilter = ref('')
const showCreateModal = ref(false)
const showEditModal = ref(false)
const selectedType = ref(null)

// ุฏุงุฏูโูุง ููููู ุงููุงุน ฺฏูุช ฺฉุงุฑุช
const types = ref([
  {
    id: 1,
    name: 'ฺฏูุช ฺฉุงุฑุช ุชููุฏ',
    description: 'ฺฉุงุฑุชโูุง ูฺู ุจุฑุง ุฌุดู ุชููุฏ ุจุง ูุจูุบ ุซุงุจุช',
    category: 'ููุถูุน',
    status: 'active',
    icon: '๐',
    amountType: 'fixed',
    fixedAmount: 500000,
    minAmount: null,
    maxAmount: null,
    expiryDays: 365,
    usageCount: 1250,
    totalValue: 625000,
    themes: ['ุชููุฏ', 'ุฌุดู'],
    isDefault: true,
    allowCustomMessage: true,
    allowRecipientEmail: true,
    autoSendEmail: true,
    emailTemplate: 'birthday_template'
  },
  {
    id: 2,
    name: 'ฺฏูุช ฺฉุงุฑุช ุนุฑูุณ',
    description: 'ฺฉุงุฑุชโูุง ูุฌูู ุจุฑุง ูุฑุงุณู ุนุฑูุณ',
    category: 'ููุถูุน',
    status: 'active',
    icon: '๐',
    amountType: 'variable',
    fixedAmount: null,
    minAmount: 1000000,
    maxAmount: 10000000,
    expiryDays: 730,
    usageCount: 890,
    totalValue: 4450000,
    themes: ['ุนุฑูุณ', 'ูุฌูู'],
    isDefault: false,
    allowCustomMessage: true,
    allowRecipientEmail: true,
    autoSendEmail: true,
    emailTemplate: 'wedding_template'
  },
  {
    id: 3,
    name: 'ฺฏูุช ฺฉุงุฑุช ุณุงู ูู',
    description: 'ฺฉุงุฑุชโูุง ุดุงุฏ ุจุฑุง ุชุจุฑฺฉ ุณุงู ูู',
    category: 'ููุถูุน',
    status: 'active',
    icon: '๐',
    amountType: 'fixed',
    fixedAmount: 200000,
    minAmount: null,
    maxAmount: null,
    expiryDays: 180,
    usageCount: 2100,
    totalValue: 420000,
    themes: ['ุณุงู ูู', 'ุฌุดู'],
    isDefault: true,
    allowCustomMessage: true,
    allowRecipientEmail: true,
    autoSendEmail: true,
    emailTemplate: 'newyear_template'
  },
  {
    id: 4,
    name: 'ฺฏูุช ฺฉุงุฑุช ุดุฑฺฉุช',
    description: 'ฺฉุงุฑุชโูุง ุฑุณู ุจุฑุง ุงุณุชูุงุฏู ุดุฑฺฉุช',
    category: 'ุดุฑฺฉุช',
    status: 'active',
    icon: '๐ข',
    amountType: 'variable',
    fixedAmount: null,
    minAmount: 500000,
    maxAmount: 5000000,
    expiryDays: 365,
    usageCount: 650,
    totalValue: 1950000,
    themes: ['ุดุฑฺฉุช', 'ุฑุณู'],
    isDefault: false,
    allowCustomMessage: false,
    allowRecipientEmail: true,
    autoSendEmail: false,
    emailTemplate: 'corporate_template'
  },
  {
    id: 5,
    name: 'ฺฏูุช ฺฉุงุฑุช ุชุฎูู ูฺู',
    description: 'ฺฉุงุฑุชโูุง ุชุฎูู ุจุง ุฏุฑุตุฏ ูุดุฎุต',
    category: 'ุชุฎูู',
    status: 'active',
    icon: '๐ฏ',
    amountType: 'fixed',
    fixedAmount: 100000,
    minAmount: null,
    maxAmount: null,
    expiryDays: 90,
    usageCount: 320,
    totalValue: 32000,
    themes: ['ุชุฎูู', 'ูฺู'],
    isDefault: false,
    allowCustomMessage: false,
    allowRecipientEmail: true,
    autoSendEmail: true,
    emailTemplate: 'discount_template'
  },
  {
    id: 6,
    name: 'ฺฏูุช ฺฉุงุฑุช ุนููู',
    description: 'ฺฉุงุฑุชโูุง ุนููู ุจุฑุง ุงุณุชูุงุฏู ุขุฒุงุฏ',
    category: 'ูุจูุบ ุซุงุจุช',
    status: 'inactive',
    icon: '๐',
    amountType: 'variable',
    fixedAmount: null,
    minAmount: 50000,
    maxAmount: 1000000,
    expiryDays: 365,
    usageCount: 180,
    totalValue: 90000,
    themes: ['ุนููู'],
    isDefault: false,
    allowCustomMessage: true,
    allowRecipientEmail: true,
    autoSendEmail: true,
    emailTemplate: 'general_template'
  }
])

// ูุญุงุณุจู ุงููุงุน ูุนุงู
const activeTypes = computed(() => types.value.filter(type => type.status === 'active'))

// ูุญุงุณุจู ุงููุงุน ูุชุบุฑ
const variableTypes = computed(() => types.value.filter(type => type.amountType === 'variable'))

// ูุญุงุณุจู ุงููุงุน ููุถูุน
const themedTypes = computed(() => types.value.filter(type => type.category === 'ููุถูุน'))

// ููุชุฑ ฺฉุฑุฏู ุงููุงุน ุจุฑ ุงุณุงุณ ุฌุณุชุฌู ู ููุชุฑูุง
const filteredTypes = computed(() => {
  return types.value.filter(type => {
    const matchesSearch = type.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                         type.description.toLowerCase().includes(searchQuery.value.toLowerCase())
    
    const matchesStatus = !statusFilter.value || type.status === statusFilter.value
    
    const matchesCategory = !categoryFilter.value || type.category === categoryFilter.value
    
    return matchesSearch && matchesStatus && matchesCategory
  })
})

// ุชุงุจุน ุฏุฑุงูุช ูุชู ูุถุนุช
const getStatusText = (status) => {
  const statusMap = {
    active: 'ูุนุงู',
    inactive: 'ุบุฑูุนุงู'
  }
  return statusMap[status] || status
}

// ุชุงุจุน ุฏุฑุงูุช ูุชู ููุน ูุจูุบ
const getAmountTypeText = (amountType) => {
  const amountTypeMap = {
    fixed: 'ูุจูุบ ุซุงุจุช',
    variable: 'ูุจูุบ ูุชุบุฑ'
  }
  return amountTypeMap[amountType] || amountType
}

// ุชุงุจุน ูุฑูุช ฺฉุฑุฏู ูุจูุบ
const formatCurrency = (amount) => {
  return new Intl.NumberFormat('fa-IR').format(amount) + ' ุชููุงู'
}

// ุชุงุจุน ูุฑุงุด ููุน
const editType = (type) => {
  selectedType.value = type
  showEditModal.value = true
}

// ุชุงุจุน ูุดุงูุฏู ุฌุฒุฆุงุช ููุน
const viewTypeDetails = (type) => {
  // ุงูุฌุง ูโุชูุงูุฏ ููุฏุงู ุฌุฒุฆุงุช ุฑุง ุจุงุฒ ฺฉูุฏ
  console.log('View type details:', type)
}

// ุชุงุจุน ุญุฐู ููุน
const deleteType = (type) => {
  if (confirm(`ุขุง ุงุฒ ุญุฐู ููุน "${type.name}" ุงุทููุงู ุฏุงุฑุฏุ`)) {
    const index = types.value.findIndex(t => t.id === type.id)
    if (index > -1) {
      types.value.splice(index, 1)
      // ููุงุด ูพุงู ููููุช
      alert('ููุน ุจุง ููููุช ุญุฐู ุดุฏ')
    }
  }
}

// ุชุงุจุน ูุฏุฑุช ุงุฌุงุฏ ููุน ุฌุฏุฏ
const handleTypeCreated = (newType) => {
  types.value.push({
    ...newType,
    id: Date.now(),
    usageCount: 0,
    totalValue: 0
  })
  showCreateModal.value = false
}

// ุชุงุจุน ูุฏุฑุช ุจุฑูุฒุฑุณุงู ููุน
const handleTypeUpdated = (updatedType) => {
  const index = types.value.findIndex(t => t.id === updatedType.id)
  if (index > -1) {
    types.value[index] = { ...types.value[index], ...updatedType }
  }
  showEditModal.value = false
}
</script>

<style scoped>
/* ุงุณุชุงูโูุง ุฎุงุต ฺฉุงููพูููุช */
</style> 
