<template>
  <div class="space-y-6 w-full">
    <!-- Ù‡Ø¯Ø± Ø¨Ø®Ø´ -->
    <div class="p-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">ğŸ’° Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ùˆ ØªØ±Ø§Ø²</h2>
      <p class="text-gray-600">Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</p>
    </div>

    <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ù„ -->
      <div class="border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ù„</h3>
          <span class="text-xs bg-green-100 text-green-800 rounded-full px-3 py-1">ÙØ¹Ø§Ù„</span>
        </div>
        <div class="text-3xl font-bold text-green-600 mb-2">{{ formatCurrency(balanceStats.totalBalance) }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-green-500">+{{ balanceStats.balanceGrowth }}%</span>
          <span class="mx-2">Ø§Ø² Ù…Ø§Ù‡ Ù‚Ø¨Ù„</span>
        </div>
      </div>

      <!-- Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª -->
      <div class="border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª</h3>
          <span class="text-xs bg-blue-100 text-blue-800 rounded-full px-3 py-1">Ø¢Ù…Ø§Ø¯Ù‡</span>
        </div>
        <div class="text-3xl font-bold text-blue-600 mb-2">{{ formatCurrency(balanceStats.withdrawableBalance) }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-blue-500">{{ balanceStats.withdrawablePercentage }}%</span>
          <span class="mx-2">Ø§Ø² Ú©Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</span>
        </div>
      </div>

      <!-- Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯Ù‡ -->
      <div class="border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯Ù‡</h3>
          <span class="text-xs bg-red-100 text-red-800 rounded-full px-3 py-1">Ù…Ø³Ø¯ÙˆØ¯</span>
        </div>
        <div class="text-3xl font-bold text-red-600 mb-2">{{ formatCurrency(balanceStats.blockedBalance) }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-red-500">{{ balanceStats.blockedCount }}</span>
          <span class="mx-2">Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¯ÙˆØ¯</span>
        </div>
      </div>

      <!-- Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± -->
      <div class="border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯</h3>
          <span class="text-xs bg-yellow-100 text-yellow-800 rounded-full px-3 py-1">Ø§Ù†ØªØ¸Ø§Ø±</span>
        </div>
        <div class="text-3xl font-bold text-yellow-600 mb-2">{{ formatCurrency(balanceStats.pendingBalance) }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-yellow-500">{{ balanceStats.pendingCount }}</span>
          <span class="mx-2">ØªØ±Ø§Ú©Ù†Ø´ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
        </div>
      </div>
    </div>

    <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆÙ†Ø¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒ -->
    <div class="border border-gray-200 p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-semibold text-gray-900">Ø±ÙˆÙ†Ø¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒ (30 Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡)</h3>
        <div class="flex space-x-2 space-x-reverse">
          <button class="px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200">Ø±ÙˆØ²Ø§Ù†Ù‡</button>
          <button class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Ù‡ÙØªÚ¯ÛŒ</button>
          <button class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Ù…Ø§Ù‡Ø§Ù†Ù‡</button>
        </div>
      </div>
      
      <!-- Ù†Ù…ÙˆØ¯Ø§Ø± -->
      <div class="h-64 w-full overflow-x-auto">
        <div class="flex items-end space-x-1 h-full min-w-max px-4">
          <div v-for="(day, index) in balanceTrend" :key="index" class="flex flex-col items-center flex-shrink-0 min-w-[6px]">
            <div
class="w-full bg-gray-200 rounded-t relative"
                 :style="{ height: getChartHeight(day.balance) + 'px' }">
              <div
class="w-full bg-gradient-to-t from-blue-500 to-indigo-500 rounded-t transition-all duration-300 absolute bottom-0"
                   :style="{ height: getChartHeight(day.balance) + 'px' }"></div>
            </div>
            <span class="text-xs text-gray-500 mt-1 text-center hidden md:block">{{ day.date }}</span>
            <span class="text-xs text-gray-400 mt-1 text-center hidden xl:block">{{ formatCurrency(day.balance) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ ØªØºÛŒÛŒØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒ -->
    <div class="border border-gray-200 p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-semibold text-gray-900">ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØºÛŒÛŒØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒ</h3>
        <button class="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
          Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
        </button>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-right min-w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-gray-700 font-medium whitespace-nowrap">ØªØ§Ø±ÛŒØ®</th>
              <th class="px-4 py-3 text-gray-700 font-medium whitespace-nowrap">Ù†ÙˆØ¹ ØªØºÛŒÛŒØ±</th>
              <th class="px-4 py-3 text-gray-700 font-medium whitespace-nowrap">Ù…Ø¨Ù„Øº</th>
              <th class="px-4 py-3 text-gray-700 font-medium whitespace-nowrap">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„</th>
              <th class="px-4 py-3 text-gray-700 font-medium whitespace-nowrap">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø¹Ø¯</th>
              <th class="px-4 py-3 text-gray-700 font-medium whitespace-nowrap">ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
              <th class="px-4 py-3 text-gray-700 font-medium whitespace-nowrap">ÙˆØ¶Ø¹ÛŒØª</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr v-for="change in balanceChanges" :key="change.id" class="hover:bg-gray-50">
              <td class="px-4 py-3 text-gray-900 whitespace-nowrap">{{ change.date }}</td>
              <td class="px-4 py-3">
                <span :class="getChangeTypeClass(change.type)" class="px-2 py-1 text-xs rounded-full whitespace-nowrap">
                  {{ change.type }}
                </span>
              </td>
              <td class="px-4 py-3 font-medium whitespace-nowrap" :class="change.amount > 0 ? 'text-green-600' : 'text-red-600'">
                {{ change.amount > 0 ? '+' : '' }}{{ formatCurrency(change.amount) }}
              </td>
              <td class="px-4 py-3 text-gray-600 whitespace-nowrap">{{ formatCurrency(change.balanceBefore) }}</td>
              <td class="px-4 py-3 text-gray-900 font-medium whitespace-nowrap">{{ formatCurrency(change.balanceAfter) }}</td>
              <td class="px-4 py-3 text-gray-600 max-w-xs truncate">{{ change.description }}</td>
              <td class="px-4 py-3">
                <span :class="getStatusClass(change.status)" class="px-2 py-1 text-xs rounded-full whitespace-nowrap">
                  {{ change.status }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Ø´Ø§Ø±Ú˜ Ø¯Ø³ØªÛŒ -->
      <div class="border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Ø´Ø§Ø±Ú˜ Ø¯Ø³ØªÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±</label>
            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option>Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
              <option>Ú©Ø§Ø±Ø¨Ø± 1</option>
              <option>Ú©Ø§Ø±Ø¨Ø± 2</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ø¨Ù„Øº Ø´Ø§Ø±Ú˜</label>
            <input
type="number" placeholder="Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
            <textarea
placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø´Ø§Ø±Ú˜" rows="3"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
          </div>
          <button class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
            Ø´Ø§Ø±Ú˜ Ú©ÛŒÙ Ù¾ÙˆÙ„
          </button>
        </div>
      </div>

      <!-- Ú©Ø³Ø± Ø¯Ø³ØªÛŒ -->
      <div class="border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Ú©Ø³Ø± Ø¯Ø³ØªÛŒ Ø§Ø² Ú©ÛŒÙ Ù¾ÙˆÙ„</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±</label>
            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option>Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
              <option>Ú©Ø§Ø±Ø¨Ø± 1</option>
              <option>Ú©Ø§Ø±Ø¨Ø± 2</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ø¨Ù„Øº Ú©Ø³Ø±</label>
            <input
type="number" placeholder="Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ø¯Ù„ÛŒÙ„ Ú©Ø³Ø±</label>
            <textarea
placeholder="Ø¯Ù„ÛŒÙ„ Ú©Ø³Ø± Ø§Ø² Ú©ÛŒÙ Ù¾ÙˆÙ„" rows="3"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
          </div>
          <button class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
            Ú©Ø³Ø± Ø§Ø² Ú©ÛŒÙ Ù¾ÙˆÙ„
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { reactive, ref, watchEffect } from 'vue';
declare const useFetch: <T>(url: string, options?: unknown) => Promise<{ data: { value: T }; refresh: () => Promise<void> }>
// Ø¢Ù…Ø§Ø± Ø§Ø² API
const balanceStats = reactive({
  totalBalance: 0,
  balanceGrowth: 0,
  withdrawableBalance: 0,
  withdrawablePercentage: 0,
  blockedBalance: 0,
  blockedCount: 0,
  pendingBalance: 0,
  pendingCount: 0
})

// Ø±ÙˆÙ†Ø¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒ (placeholder)
const balanceTrend = ref<Array<{ date: string; balance: number }>>([])

// ØªØºÛŒÛŒØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒ (placeholder)
interface BalanceChange {
  id?: number | string
  [key: string]: unknown
}
const balanceChanges = ref<BalanceChange[]>([])

// ØªØ§Ø¨Ø¹ ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø§Ø±Ø²
const formatCurrency = (amount: number) => {
  return new Intl.NumberFormat('fa-IR').format(amount) + ' ØªÙˆÙ…Ø§Ù†'
}

// ØªØ§Ø¨Ø¹ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø±ØªÙØ§Ø¹ Ù†Ù…ÙˆØ¯Ø§Ø±
const getChartHeight = (balance: number) => {
  const maxBalance = Math.max(...balanceTrend.value.map(item => item.balance))
  const minBalance = Math.min(...balanceTrend.value.map(item => item.balance))
  const range = maxBalance - minBalance
  const height = 200

  if (range === 0) return height

  const percentage = ((balance - minBalance) / range) * 100
  return (percentage / 100) * height
}

// ØªØ§Ø¨Ø¹ Ú©Ù„Ø§Ø³ Ù†ÙˆØ¹ ØªØºÛŒÛŒØ±
const getChangeTypeClass = (type: string) => {
  switch (type) {
    case 'Ø´Ø§Ø±Ú˜':
      return 'bg-green-100 text-green-800'
    case 'Ø¨Ø±Ø¯Ø§Ø´Øª':
      return 'bg-red-100 text-red-800'
    case 'Ú©Ø³Ø±':
      return 'bg-orange-100 text-orange-800'
    case 'Ø§Ù†ØªÙ‚Ø§Ù„':
      return 'bg-blue-100 text-blue-800'
    default:
      return 'bg-gray-100 text-gray-800'
  }
}

// ØªØ§Ø¨Ø¹ Ú©Ù„Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
const getStatusClass = (status: string) => {
  switch (status) {
    case 'Ù…ÙˆÙÙ‚':
      return 'bg-green-100 text-green-800'
    case 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±':
      return 'bg-yellow-100 text-yellow-800'
    case 'Ù†Ø§Ù…ÙˆÙÙ‚':
      return 'bg-red-100 text-red-800'
    default:
      return 'bg-gray-100 text-gray-800'
  }
}

// ÙˆØ§Ú©Ø´ÛŒ summary Ùˆ trend Ø§Ø² API Ø§Ø¯Ù…ÛŒÙ†
const { data: summary } = await useFetch('/api/admin/wallet/summary', {
  method: 'GET',
  credentials: 'include',
  key: 'admin-wallet-summary',
  defaultCache: true,
})
const { data: trend } = await useFetch('/api/admin/wallet/trend', {
  method: 'GET',
  query: { days: 30 },
  credentials: 'include',
  key: 'admin-wallet-trend-30',
  defaultCache: true,
})

interface Summary {
  totalBalance?: number | string
  blockedCount?: number | string
  pendingCount?: number | string
  [key: string]: unknown
}
interface Trend {
  items?: Array<{
    [key: string]: unknown
  }>
  [key: string]: unknown
}
watchEffect(() => {
  const s = summary.value as Summary | null
  if (s) {
    balanceStats.totalBalance = Number(s.totalBalance || 0)
    balanceStats.blockedCount = Number(s.blockedCount || 0)
    balanceStats.pendingCount = Number(s.pendingCount || 0)
  }
  const t = trend.value as Trend | null
  if (t && Array.isArray(t.items)) {
    interface TrendItem {
      day?: string
      net?: number | string
      [key: string]: unknown
    }
    balanceTrend.value = (t.items as TrendItem[]).map((x) => ({ date: x.day || '', balance: Number(x.net || 0) }))
  }
})
</script>

<!--
  Ù…Ø³ØªÙ†Ø¯Ø³Ø§Ø²ÛŒ:
  Ø§ÛŒÙ† Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø´Ø§Ù…Ù„ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³Øª:
  1. Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ (Ú©Ù„ØŒ Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´ØªØŒ Ù…Ø³Ø¯ÙˆØ¯ØŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±)
  2. Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆÙ†Ø¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø± 30 Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡
  3. Ø¬Ø¯ÙˆÙ„ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØºÛŒÛŒØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒ
  4. Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø´Ø§Ø±Ú˜ Ùˆ Ú©Ø³Ø± Ø¯Ø³ØªÛŒ
  
  ØªÙ…Ø§Ù… ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø¨Ø§ Ø·Ø±Ø§Ø­ÛŒ Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø§Ø±Ø§Ø¦Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.
--> 
