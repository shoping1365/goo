<template>
  <div class="space-y-6">
    <!-- Ù‡Ø¯Ø± Ø¨Ø®Ø´ -->
    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">ğŸ’¸ Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø±Ø¯Ø§Ø´Øª</h2>
      <p class="text-gray-600">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ùˆ ØªØ£ÛŒÛŒØ¯ Ø¢Ù†Ù‡Ø§</p>
    </div>

    <!-- Ø¢Ù…Ø§Ø± Ø¨Ø±Ø¯Ø§Ø´Øª -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯</h3>
          <span class="text-xs bg-blue-100 text-blue-800 rounded-full px-3 py-1">Ø¬Ø¯ÛŒØ¯</span>
        </div>
        <div class="text-3xl font-bold text-blue-600 mb-2">{{ withdrawalStats.newRequests }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-blue-500">{{ formatCurrency(withdrawalStats.newAmount) }}</span>
          <span class="mx-2">Ù…Ø¨Ù„Øº Ú©Ù„</span>
        </div>
      </div>

      <!-- Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯</h3>
          <span class="text-xs bg-yellow-100 text-yellow-800 rounded-full px-3 py-1">Ø§Ù†ØªØ¸Ø§Ø±</span>
        </div>
        <div class="text-3xl font-bold text-yellow-600 mb-2">{{ withdrawalStats.pendingApproval }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-yellow-500">{{ formatCurrency(withdrawalStats.pendingAmount) }}</span>
          <span class="mx-2">Ù…Ø¨Ù„Øº Ú©Ù„</span>
        </div>
      </div>

      <!-- ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</h3>
          <span class="text-xs bg-green-100 text-green-800 rounded-full px-3 py-1">ØªØ£ÛŒÛŒØ¯</span>
        </div>
        <div class="text-3xl font-bold text-green-600 mb-2">{{ withdrawalStats.approved }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-green-500">{{ formatCurrency(withdrawalStats.approvedAmount) }}</span>
          <span class="mx-2">Ù…Ø¨Ù„Øº Ú©Ù„</span>
        </div>
      </div>

      <!-- Ø±Ø¯ Ø´Ø¯Ù‡ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ø±Ø¯ Ø´Ø¯Ù‡</h3>
          <span class="text-xs bg-red-100 text-red-800 rounded-full px-3 py-1">Ø±Ø¯</span>
        </div>
        <div class="text-3xl font-bold text-red-600 mb-2">{{ withdrawalStats.rejected }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-red-500">{{ formatCurrency(withdrawalStats.rejectedAmount) }}</span>
          <span class="mx-2">Ù…Ø¨Ù„Øº Ú©Ù„</span>
        </div>
      </div>
    </div>

    <!-- ÙÛŒÙ„ØªØ±Ù‡Ø§ -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <!-- ÙˆØ¶Ø¹ÛŒØª -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ÙˆØ¶Ø¹ÛŒØª</label>
          <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Ù‡Ù…Ù‡</option>
            <option value="new">Ø¬Ø¯ÛŒØ¯</option>
            <option value="pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯</option>
            <option value="approved">ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</option>
            <option value="rejected">Ø±Ø¯ Ø´Ø¯Ù‡</option>
          </select>
        </div>

        <!-- Ø¨Ø§Ø²Ù‡ Ù…Ø¨Ù„Øº -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Ø¨Ø§Ø²Ù‡ Ù…Ø¨Ù„Øº</label>
          <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Ù‡Ù…Ù‡</option>
            <option value="low">Ú©Ù…ØªØ± Ø§Ø² 1 Ù…ÛŒÙ„ÛŒÙˆÙ†</option>
            <option value="medium">1 ØªØ§ 10 Ù…ÛŒÙ„ÛŒÙˆÙ†</option>
            <option value="high">Ø¨ÛŒØ´ Ø§Ø² 10 Ù…ÛŒÙ„ÛŒÙˆÙ†</option>
          </select>
        </div>

        <!-- Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ</label>
          <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="today">Ø§Ù…Ø±ÙˆØ²</option>
            <option value="week">Ù‡ÙØªÙ‡ Ú¯Ø°Ø´ØªÙ‡</option>
            <option value="month">Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡</option>
            <option value="custom">Ø³ÙØ§Ø±Ø´ÛŒ</option>
          </select>
        </div>

        <!-- Ø¬Ø³ØªØ¬Ùˆ -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Ø¬Ø³ØªØ¬Ùˆ</label>
          <input type="text" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÛŒØ§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±" 
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
      </div>

      <div class="flex justify-between items-center">
        <button class="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
          Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±
        </button>
        <button class="px-4 py-2 bg-gray-100 text-gray-700 text-sm rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500">
          Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±Ù‡Ø§
        </button>
      </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-semibold text-gray-900">Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª</h3>
        <div class="flex space-x-2 space-x-reverse">
          <button @click="bulkUpdate('success')" class="px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">ØªØ£ÛŒÛŒØ¯ Ù‡Ù…Ù‡</button>
          <button @click="bulkUpdate('failed')" class="px-4 py-2 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">Ø±Ø¯ Ù‡Ù…Ù‡</button>
          <button class="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
            Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„
          </button>
        </div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-right">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-gray-700 font-medium">
                <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
              </th>
              <th class="px-4 py-3 text-gray-700 font-medium">Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª</th>
              <th class="px-4 py-3 text-gray-700 font-medium">Ú©Ø§Ø±Ø¨Ø±</th>
              <th class="px-4 py-3 text-gray-700 font-medium">Ù…Ø¨Ù„Øº</th>
              <th class="px-4 py-3 text-gray-700 font-medium">Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ</th>
              <th class="px-4 py-3 text-gray-700 font-medium">ØªØ§Ø±ÛŒØ® Ø¯Ø±Ø®ÙˆØ§Ø³Øª</th>
              <th class="px-4 py-3 text-gray-700 font-medium">ÙˆØ¶Ø¹ÛŒØª</th>
              <th class="px-4 py-3 text-gray-700 font-medium">Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr v-for="withdrawal in withdrawals" :key="withdrawal.id" class="hover:bg-gray-50">
              <td class="px-4 py-3">
                <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
              </td>
              <td class="px-4 py-3 text-gray-900 font-medium">{{ withdrawal.requestId }}</td>
              <td class="px-4 py-3">
                <div class="flex items-center">
                  <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs font-medium text-gray-600">
                    {{ withdrawal.userInitials }}
                  </div>
                  <div class="mr-3">
                    <div class="text-sm font-medium text-gray-900">{{ withdrawal.userName }}</div>
                    <div class="text-xs text-gray-500">{{ withdrawal.userEmail }}</div>
                  </div>
                </div>
              </td>
              <td class="px-4 py-3 font-medium text-gray-900">{{ formatCurrency(withdrawal.amount) }}</td>
              <td class="px-4 py-3 text-gray-600">
                <div>
                  <div class="text-sm">{{ withdrawal.bankName }}</div>
                  <div class="text-xs text-gray-500">{{ withdrawal.accountNumber }}</div>
                </div>
              </td>
              <td class="px-4 py-3 text-gray-600">{{ withdrawal.requestDate }}</td>
              <td class="px-4 py-3">
                <span :class="getStatusClass(withdrawal.status)" class="px-2 py-1 text-xs rounded-full">
                  {{ withdrawal.status }}
                </span>
              </td>
              <td class="px-4 py-3">
                <div class="flex space-x-2 space-x-reverse">
                  <button class="text-blue-600 hover:text-blue-800 text-sm">Ø¬Ø²Ø¦ÛŒØ§Øª</button>
                  <button v-if="withdrawal.status === 'new' || withdrawal.status === 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯'" @click="updateStatus(withdrawal.id, 'success')" class="text-green-600 hover:text-green-800 text-sm">ØªØ£ÛŒÛŒØ¯</button>
                  <button v-if="withdrawal.status === 'new' || withdrawal.status === 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯'" @click="updateStatus(withdrawal.id, 'failed')" class="text-red-600 hover:text-red-800 text-sm">Ø±Ø¯</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ -->
      <div class="flex items-center justify-between mt-6">
        <div class="text-sm text-gray-700">
          Ù†Ù…Ø§ÛŒØ´ {{ paginationInfo.start }} ØªØ§ {{ paginationInfo.end }} Ø§Ø² {{ paginationInfo.total }} Ø¯Ø±Ø®ÙˆØ§Ø³Øª
        </div>
        <div class="flex space-x-2 space-x-reverse">
          <button class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Ù‚Ø¨Ù„ÛŒ</button>
          <button class="px-3 py-1 text-sm bg-blue-600 text-white rounded-lg">1</button>
          <button class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">2</button>
          <button class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">3</button>
          <button class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Ø¨Ø¹Ø¯ÛŒ</button>
        </div>
      </div>
    </div>

    <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø¯Ø§Ø´Øª -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø¨Ù„Øº Ø¨Ø±Ø¯Ø§Ø´Øª</label>
            <input type="number" :value="withdrawalSettings.minAmount" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ø¨Ù„Øº Ø¨Ø±Ø¯Ø§Ø´Øª</label>
            <input type="number" :value="withdrawalSettings.maxAmount" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ú©Ø§Ø±Ù…Ø²Ø¯ Ø¨Ø±Ø¯Ø§Ø´Øª (%)</label>
            <input type="number" step="0.1" :value="withdrawalSettings.feePercentage" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ø²Ù…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø²Ø´ (Ø³Ø§Ø¹Øª)</label>
            <input type="number" :value="withdrawalSettings.processingTime" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <button class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
            Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
          </button>
        </div>
      </div>

      <!-- Ø¢Ù…Ø§Ø± Ø³Ø±ÛŒØ¹ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Ø¢Ù…Ø§Ø± Ø³Ø±ÛŒØ¹</h3>
        <div class="space-y-4">
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù…Ø¨Ù„Øº Ø¨Ø±Ø¯Ø§Ø´Øª:</span>
            <span class="text-sm font-medium text-gray-900">{{ formatCurrency(withdrawalStats.averageAmount) }}</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ø³Ø±ÛŒØ¹â€ŒØªØ±ÛŒÙ† Ù¾Ø±Ø¯Ø§Ø²Ø´:</span>
            <span class="text-sm font-medium text-gray-900">{{ withdrawalStats.fastestProcessing }} Ø¯Ù‚ÛŒÙ‚Ù‡</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ú©Ù†Ø¯ØªØ±ÛŒÙ† Ù¾Ø±Ø¯Ø§Ø²Ø´:</span>
            <span class="text-sm font-medium text-gray-900">{{ withdrawalStats.slowestProcessing }} Ø³Ø§Ø¹Øª</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ù†Ø±Ø® ØªØ£ÛŒÛŒØ¯:</span>
            <span class="text-sm font-medium text-green-600">{{ withdrawalStats.approvalRate }}%</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ù†Ø±Ø® Ø±Ø¯:</span>
            <span class="text-sm font-medium text-red-600">{{ withdrawalStats.rejectionRate }}%</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { reactive, ref, watchEffect } from 'vue';
declare const useFetch: <T>(url: string, options?: unknown) => Promise<{ data: { value: T }; refresh: () => Promise<void> }>
// Ø¢Ù…Ø§Ø± Ø¨Ø±Ø¯Ø§Ø´Øª (Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø² API)
const withdrawalStats = reactive({
  newRequests: 0,
  newAmount: 0,
  pendingApproval: 0,
  pendingAmount: 0,
  approved: 0,
  approvedAmount: 0,
  rejected: 0,
  rejectedAmount: 0,
  averageAmount: 0,
  fastestProcessing: 0,
  slowestProcessing: 0,
  approvalRate: 0,
  rejectionRate: 0
})

// ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø¯Ø§Ø´Øª
const withdrawalSettings = {
  minAmount: 100000,
  maxAmount: 50000000,
  feePercentage: 1.5,
  processingTime: 24
}

// Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² API ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ (method=withdraw)
const withdrawals = ref<any[]>([])
const page = ref(1)
const pageSize = ref(20)
const statusFilter = ref('')
const { data: txs, refresh } = await useFetch('/api/admin/wallet/transactions', {
  method: 'GET',
  query: { page, pageSize, type: 'debit', method: 'withdraw', status: statusFilter },
  credentials: 'include',
  key: () => `admin-wallet-withdraw-${page.value}-${pageSize.value}-${statusFilter.value}`,
  defaultCache: true,
})
const { data: summary } = await useFetch('/api/admin/wallet/summary', { method:'GET', credentials:'include', key:'admin-wallet-summary', defaultCache:true })
watchEffect(()=>{
  const res: any = txs.value
  if (res && Array.isArray(res.items)) {
    withdrawals.value = res.items.map((r:any)=>({
      id: r.id,
      requestId: r.id,
      userName: r.username || r.user_id,
      userEmail: r.email || '-',
      userInitials: (r.username || '-').slice(0,2),
      amount: Number(r.amount||0),
      bankName: '-',
      accountNumber: '-',
      requestDate: r.created_at,
      status: r.status === 'success' ? 'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡' : (r.status==='pending' ? 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯' : (r.status==='failed' ? 'Ø±Ø¯ Ø´Ø¯Ù‡' : 'Ø¬Ø¯ÛŒØ¯'))
    }))
    // Ø¢Ù…Ø§Ø± Ø³Ø§Ø¯Ù‡ Ø§Ø² Ù„ÛŒØ³Øª
    const list = withdrawals.value
    withdrawalStats.newRequests = list.filter((x:any)=>x.status==='Ø¬Ø¯ÛŒØ¯').length
    withdrawalStats.pendingApproval = list.filter((x:any)=>x.status==='Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯').length
    withdrawalStats.approved = list.filter((x:any)=>x.status==='ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡').length
    withdrawalStats.rejected = list.filter((x:any)=>x.status==='Ø±Ø¯ Ø´Ø¯Ù‡').length
    withdrawalStats.newAmount = list.filter((x:any)=>x.status==='Ø¬Ø¯ÛŒØ¯').reduce((s:number,x:any)=>s+x.amount,0)
    withdrawalStats.pendingAmount = list.filter((x:any)=>x.status==='Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯').reduce((s:number,x:any)=>s+x.amount,0)
    withdrawalStats.approvedAmount = list.filter((x:any)=>x.status==='ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡').reduce((s:number,x:any)=>s+x.amount,0)
    withdrawalStats.rejectedAmount = list.filter((x:any)=>x.status==='Ø±Ø¯ Ø´Ø¯Ù‡').reduce((s:number,x:any)=>s+x.amount,0)
    const total = Math.max(1, list.length)
    withdrawalStats.approvalRate = Math.round((withdrawalStats.approved/total)*1000)/10
    withdrawalStats.rejectionRate = Math.round((withdrawalStats.rejected/total)*1000)/10
  }
})

async function updateStatus(id: number, status: 'success'|'failed'|'pending') {
  await $fetch(`/api/admin/wallet/transactions/${id}/status`, { method: 'POST', body: { status }, credentials: 'include' })
  await refresh()
}

async function bulkUpdate(status: 'success'|'failed') {
  const ids = withdrawals.value
    .filter((w:any)=> w.status==='new' || w.status==='Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯')
    .map((w:any)=> w.id)
  for (const id of ids) {
    try { await $fetch(`/api/admin/wallet/transactions/${id}/status`, { method: 'POST', body: { status }, credentials: 'include' }) } catch {}
  }
  await refresh()
}

// Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ
const paginationInfo = reactive({ start:1, end:0, total:0 })
watchEffect(()=>{
  const res:any = txs.value
  if (!res) return
  paginationInfo.total = Number(res.total||0)
  paginationInfo.start = (page.value-1)*pageSize.value + 1
  paginationInfo.end = Math.min(page.value*pageSize.value, paginationInfo.total)
})

// ØªØ§Ø¨Ø¹ ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø§Ø±Ø²
const formatCurrency = (amount: number) => {
  return new Intl.NumberFormat('fa-IR').format(amount) + ' ØªÙˆÙ…Ø§Ù†'
}

// ØªØ§Ø¨Ø¹ Ú©Ù„Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
const getStatusClass = (status: string) => {
  switch (status) {
    case 'Ø¬Ø¯ÛŒØ¯':
      return 'bg-blue-100 text-blue-800'
    case 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯':
      return 'bg-yellow-100 text-yellow-800'
    case 'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡':
      return 'bg-green-100 text-green-800'
    case 'Ø±Ø¯ Ø´Ø¯Ù‡':
      return 'bg-red-100 text-red-800'
    default:
      return 'bg-gray-100 text-gray-800'
  }
}
</script>

<!--
  Ù…Ø³ØªÙ†Ø¯Ø³Ø§Ø²ÛŒ:
  Ø§ÛŒÙ† Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø´Ø§Ù…Ù„ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³Øª:
  1. Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª (Ø¬Ø¯ÛŒØ¯ØŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±ØŒ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ØŒ Ø±Ø¯ Ø´Ø¯Ù‡)
  2. ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
  3. Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ø¨Ø§ Ø§Ù…Ú©Ø§Ù† ØªØ£ÛŒÛŒØ¯/Ø±Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ
  4. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª
  5. Ø¢Ù…Ø§Ø± Ø³Ø±ÛŒØ¹ Ù¾Ø±Ø¯Ø§Ø²Ø´
  
  ØªÙ…Ø§Ù… ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø¨Ø§ Ø·Ø±Ø§Ø­ÛŒ Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø§Ø±Ø§Ø¦Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.
--> 
