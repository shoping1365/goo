<template>
  <div class="space-y-6">
    <!-- Ù‡Ø¯Ø± Ø¨Ø®Ø´ -->
    <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-lg p-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">ğŸ’³ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø§Ø±Ú˜</h2>
      <p class="text-gray-600">Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø´Ø§Ø±Ú˜ Ùˆ Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª</p>
    </div>

    <!-- Ø¢Ù…Ø§Ø± Ø´Ø§Ø±Ú˜ -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Ú©Ù„ Ø´Ø§Ø±Ú˜Ù‡Ø§ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ú©Ù„ Ø´Ø§Ø±Ú˜Ù‡Ø§</h3>
          <span class="text-xs bg-blue-100 text-blue-800 rounded-full px-3 py-1">Ø§Ù…Ø±ÙˆØ²</span>
        </div>
        <div class="text-3xl font-bold text-blue-600 mb-2">{{ chargeStats.totalCharges }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-green-500">+{{ chargeStats.dailyGrowth }}%</span>
          <span class="mx-2">Ø§Ø² Ø¯ÛŒØ±ÙˆØ²</span>
        </div>
      </div>

      <!-- Ù…Ø¨Ù„Øº Ú©Ù„ Ø´Ø§Ø±Ú˜ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ù…Ø¨Ù„Øº Ú©Ù„ Ø´Ø§Ø±Ú˜</h3>
          <span class="text-xs bg-green-100 text-green-800 rounded-full px-3 py-1">Ù…Ø«Ø¨Øª</span>
        </div>
        <div class="text-3xl font-bold text-green-600 mb-2">{{ formatCurrency(chargeStats.totalAmount) }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-green-500">+{{ chargeStats.amountGrowth }}%</span>
          <span class="mx-2">Ø§Ø² Ù…Ø§Ù‡ Ù‚Ø¨Ù„</span>
        </div>
      </div>

      <!-- Ø´Ø§Ø±Ú˜Ù‡Ø§ÛŒ Ù…ÙˆÙÙ‚ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ø´Ø§Ø±Ú˜Ù‡Ø§ÛŒ Ù…ÙˆÙÙ‚</h3>
          <span class="text-xs bg-green-100 text-green-800 rounded-full px-3 py-1">Ø¹Ø§Ù„ÛŒ</span>
        </div>
        <div class="text-3xl font-bold text-green-600 mb-2">{{ chargeStats.successfulCharges }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-green-500">{{ chargeStats.successRate }}%</span>
          <span class="mx-2">Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª</span>
        </div>
      </div>

      <!-- Ø´Ø§Ø±Ú˜Ù‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">Ø´Ø§Ø±Ú˜Ù‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚</h3>
          <span class="text-xs bg-red-100 text-red-800 rounded-full px-3 py-1">Ù‡Ø´Ø¯Ø§Ø±</span>
        </div>
        <div class="text-3xl font-bold text-red-600 mb-2">{{ chargeStats.failedCharges }}</div>
        <div class="flex items-center text-sm text-gray-600">
          <span class="text-red-500">{{ chargeStats.failureRate }}%</span>
          <span class="mx-2">Ù†Ø±Ø® Ø´Ú©Ø³Øª</span>
        </div>
      </div>
    </div>

    <!-- Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-semibold text-gray-900">Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª</h3>
        <button class="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
          Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ú¯Ø§Ù‡ Ø¬Ø¯ÛŒØ¯
        </button>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div
v-for="gateway in paymentGateways" :key="gateway.id" 
             class="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center">
              <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                <span class="text-lg">{{ gateway.icon }}</span>
              </div>
              <div>
                <h4 class="font-medium text-gray-900">{{ gateway.name }}</h4>
                <p class="text-sm text-gray-500">{{ gateway.description }}</p>
              </div>
            </div>
            <span :class="getGatewayStatusClass(gateway.status)" class="px-2 py-1 text-xs rounded-full">
              {{ gateway.status }}
            </span>
          </div>
          
          <div class="space-y-2 mb-4">
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Ú©Ø§Ø±Ù…Ø²Ø¯:</span>
              <span class="font-medium">{{ gateway.fee }}%</span>
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø¨Ù„Øº:</span>
              <span class="font-medium">{{ formatCurrency(gateway.minAmount) }}</span>
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ø¨Ù„Øº:</span>
              <span class="font-medium">{{ formatCurrency(gateway.maxAmount) }}</span>
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²:</span>
              <span class="font-medium">{{ gateway.todayTransactions }}</span>
            </div>
          </div>
          
          <div class="flex space-x-2 space-x-reverse">
            <button class="flex-1 px-3 py-2 bg-blue-100 text-blue-700 text-sm rounded-lg hover:bg-blue-200">
              ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            </button>
            <button
:class="gateway.status === 'ÙØ¹Ø§Ù„' ? 'bg-red-100 text-red-700 hover:bg-red-200' : 'bg-green-100 text-green-700 hover:bg-green-200'"
                    class="flex-1 px-3 py-2 text-sm rounded-lg">
              {{ gateway.status === 'ÙØ¹Ø§Ù„' ? 'ØºÛŒØ±ÙØ¹Ø§Ù„' : 'ÙØ¹Ø§Ù„' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø´Ø§Ø±Ú˜ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Ø´Ø§Ø±Ú˜ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ú©Ø§Ø±Øª Ø¨Ø§Ù†Ú©ÛŒ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Ø´Ø§Ø±Ú˜ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ú©Ø§Ø±Øª Ø¨Ø§Ù†Ú©ÛŒ</h3>
        <div class="space-y-4">
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ú©Ø§Ø±Ù…Ø²Ø¯ ØªØ±Ø§Ú©Ù†Ø´:</span>
            <span class="text-sm font-medium text-gray-900">{{ chargeSettings.cardFee }}%</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø¨Ù„Øº:</span>
            <span class="text-sm font-medium text-gray-900">{{ formatCurrency(chargeSettings.cardMinAmount) }}</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ø¨Ù„Øº:</span>
            <span class="text-sm font-medium text-gray-900">{{ formatCurrency(chargeSettings.cardMaxAmount) }}</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ø²Ù…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø²Ø´:</span>
            <span class="text-sm font-medium text-gray-900">{{ chargeSettings.cardProcessingTime }} Ø¯Ù‚ÛŒÙ‚Ù‡</span>
          </div>
          <button class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
            ØªÙ†Ø¸ÛŒÙ… Ú©Ø§Ø±Ù…Ø²Ø¯
          </button>
        </div>
      </div>

      <!-- Ø´Ø§Ø±Ú˜ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¯ÛŒØ¬ÛŒØªØ§Ù„ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Ø´Ø§Ø±Ú˜ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¯ÛŒØ¬ÛŒØªØ§Ù„</h3>
        <div class="space-y-4">
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ú©Ø§Ø±Ù…Ø²Ø¯ ØªØ±Ø§Ú©Ù†Ø´:</span>
            <span class="text-sm font-medium text-gray-900">{{ chargeSettings.walletFee }}%</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø¨Ù„Øº:</span>
            <span class="text-sm font-medium text-gray-900">{{ formatCurrency(chargeSettings.walletMinAmount) }}</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ø¨Ù„Øº:</span>
            <span class="text-sm font-medium text-gray-900">{{ formatCurrency(chargeSettings.walletMaxAmount) }}</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <span class="text-sm text-gray-700">Ø²Ù…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø²Ø´:</span>
            <span class="text-sm font-medium text-gray-900">{{ chargeSettings.walletProcessingTime }} Ø¯Ù‚ÛŒÙ‚Ù‡</span>
          </div>
          <button class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
            ØªÙ†Ø¸ÛŒÙ… Ú©Ø§Ø±Ù…Ø²Ø¯
          </button>
        </div>
      </div>
    </div>

    <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ø´Ø§Ø±Ú˜Ù‡Ø§ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ø´Ø§Ø±Ú˜ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø±Ú¯Ø§Ù‡ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Ø´Ø§Ø±Ú˜ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª</h3>
        <div class="space-y-4">
          <div v-for="gateway in gatewayStats" :key="gateway.name" class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="w-4 h-4 rounded-full mr-3" :style="{ backgroundColor: gateway.color }"></div>
              <span class="text-sm text-gray-700">{{ gateway.name }}</span>
            </div>
            <div class="flex items-center space-x-2 space-x-reverse">
              <span class="text-sm font-medium text-gray-900">{{ gateway.count }}</span>
              <span class="text-sm text-gray-500">({{ gateway.percentage }}%)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆÙ†Ø¯ Ø´Ø§Ø±Ú˜ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Ø±ÙˆÙ†Ø¯ Ø´Ø§Ø±Ú˜ (7 Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡)</h3>
        <div class="flex items-end space-x-2 space-x-reverse h-48 overflow-x-auto">
          <div v-for="(day, index) in chargeTrend" :key="index" class="flex-shrink-0 flex flex-col items-center min-w-16">
            <div
class="w-full bg-gray-200 rounded-t relative"
                 :style="{ height: getChartHeight(day.amount) + 'px' }">
              <div
class="w-full bg-gradient-to-t from-blue-500 to-indigo-500 rounded-t transition-all duration-300 absolute bottom-0"
                   :style="{ height: getChartHeight(day.amount) + 'px' }"></div>
            </div>
            <span class="text-xs text-gray-500 mt-1 text-center">{{ day.date }}</span>
            <span class="text-xs text-gray-400 mt-1 text-center">{{ formatCurrency(day.amount) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø´Ø§Ø±Ú˜Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ± -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-semibold text-gray-900">Ø´Ø§Ø±Ú˜Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h3>
        <button class="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
          Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
        </button>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-right">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-gray-700 font-medium">Ø´Ù…Ø§Ø±Ù‡ ØªØ±Ø§Ú©Ù†Ø´</th>
              <th class="px-4 py-3 text-gray-700 font-medium">Ú©Ø§Ø±Ø¨Ø±</th>
              <th class="px-4 py-3 text-gray-700 font-medium">Ù…Ø¨Ù„Øº</th>
              <th class="px-4 py-3 text-gray-700 font-medium">Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
              <th class="px-4 py-3 text-gray-700 font-medium">ØªØ§Ø±ÛŒØ®</th>
              <th class="px-4 py-3 text-gray-700 font-medium">ÙˆØ¶Ø¹ÛŒØª</th>
              <th class="px-4 py-3 text-gray-700 font-medium">Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr v-for="charge in recentCharges" :key="charge.id" class="hover:bg-gray-50">
              <td class="px-4 py-3 text-gray-900 font-medium">{{ charge.transactionId }}</td>
              <td class="px-4 py-3">
                <div class="flex items-center">
                  <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs font-medium text-gray-600">
                    {{ charge.userInitials }}
                  </div>
                  <div class="mr-3">
                    <div class="text-sm font-medium text-gray-900">{{ charge.userName }}</div>
                    <div class="text-xs text-gray-500">{{ charge.userEmail }}</div>
                  </div>
                </div>
              </td>
              <td class="px-4 py-3 font-medium text-green-600">{{ formatCurrency(charge.amount) }}</td>
              <td class="px-4 py-3 text-gray-600">{{ charge.gateway }}</td>
              <td class="px-4 py-3 text-gray-600">{{ charge.date }}</td>
              <td class="px-4 py-3">
                <span :class="getStatusClass(charge.status)" class="px-2 py-1 text-xs rounded-full">
                  {{ charge.status }}
                </span>
              </td>
              <td class="px-4 py-3">
                <button class="text-blue-600 hover:text-blue-800 text-sm">Ø¬Ø²Ø¦ÛŒØ§Øª</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { reactive, ref, watchEffect } from 'vue';
declare const useFetch: <T>(url: string, options?: unknown) => Promise<{ data: { value: T }; refresh: () => Promise<void> }>
// Ø¢Ù…Ø§Ø± Ø´Ø§Ø±Ú˜ (Ø§Ø² API Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
const chargeStats = reactive({
  totalCharges: 0,
  dailyGrowth: 0,
  totalAmount: 0,
  amountGrowth: 0,
  successfulCharges: 0,
  successRate: 0,
  failedCharges: 0,
  failureRate: 0
})

// ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø´Ø§Ø±Ú˜
const chargeSettings = {
  cardFee: 1.5,
  cardMinAmount: 10000,
  cardMaxAmount: 50000000,
  cardProcessingTime: 5,
  walletFee: 0.5,
  walletMinAmount: 5000,
  walletMaxAmount: 10000000,
  walletProcessingTime: 2
}

// Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª (placeholder)
const paymentGateways = [
  {
    id: 1,
    name: 'Ù…Ù„ÛŒ',
    description: 'Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…Ù„ÛŒ',
    icon: 'ğŸ¦',
    status: 'ÙØ¹Ø§Ù„',
    fee: 1.5,
    minAmount: 10000,
    maxAmount: 50000000,
    todayTransactions: 1250
  },
  {
    id: 2,
    name: 'Ù…Ù„Øª',
    description: 'Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…Ù„Øª',
    icon: 'ğŸ›ï¸',
    status: 'ÙØ¹Ø§Ù„',
    fee: 1.8,
    minAmount: 5000,
    maxAmount: 30000000,
    todayTransactions: 890
  },
  {
    id: 3,
    name: 'Ù¾Ø§Ø±Ø³ÛŒØ§Ù†',
    description: 'Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ù¾Ø§Ø±Ø³ÛŒØ§Ù†',
    icon: 'ğŸ¢',
    status: 'ØºÛŒØ±ÙØ¹Ø§Ù„',
    fee: 2.0,
    minAmount: 10000,
    maxAmount: 40000000,
    todayTransactions: 0
  },
  {
    id: 4,
    name: 'Ø³Ù¾Ù‡',
    description: 'Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø³Ù¾Ù‡',
    icon: 'ğŸ¦',
    status: 'ÙØ¹Ø§Ù„',
    fee: 1.2,
    minAmount: 5000,
    maxAmount: 25000000,
    todayTransactions: 650
  },
  {
    id: 5,
    name: 'ØªØ¬Ø§Ø±Øª',
    description: 'Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª ØªØ¬Ø§Ø±Øª',
    icon: 'ğŸ›ï¸',
    status: 'ÙØ¹Ø§Ù„',
    fee: 1.6,
    minAmount: 10000,
    maxAmount: 35000000,
    todayTransactions: 720
  },
  {
    id: 6,
    name: 'Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¯ÛŒØ¬ÛŒØªØ§Ù„',
    description: 'Ø´Ø§Ø±Ú˜ Ø§Ø² Ú©ÛŒÙ Ù¾ÙˆÙ„',
    icon: 'ğŸ’³',
    status: 'ÙØ¹Ø§Ù„',
    fee: 0.5,
    minAmount: 1000,
    maxAmount: 10000000,
    todayTransactions: 1850
  }
]

// Ø¢Ù…Ø§Ø± Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§
const gatewayStats = [
  { name: 'Ù…Ù„ÛŒ', count: 1250, percentage: 28, color: '#10B981' },
  { name: 'Ù…Ù„Øª', count: 890, percentage: 20, color: '#3B82F6' },
  { name: 'Ù¾Ø§Ø±Ø³ÛŒØ§Ù†', count: 0, percentage: 0, color: '#6B7280' },
  { name: 'Ø³Ù¾Ù‡', count: 650, percentage: 15, color: '#F59E0B' },
  { name: 'ØªØ¬Ø§Ø±Øª', count: 720, percentage: 16, color: '#EF4444' },
  { name: 'Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¯ÛŒØ¬ÛŒØªØ§Ù„', count: 1850, percentage: 21, color: '#8B5CF6' }
]

// Ø±ÙˆÙ†Ø¯ Ø´Ø§Ø±Ú˜ (Ø§Ø² API trend Ú©ÛŒÙ Ù¾ÙˆÙ„)
const chargeTrend = ref<Array<{ date: string; amount: number }>>([])

// Ø´Ø§Ø±Ú˜Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ± (Ø§Ø² API ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§)
interface ChargeDisplayItem {
  id?: number | string
  transactionId?: number | string
  userName: string | number
  userEmail: string
  userInitials: string
  amount: number
  gateway: string
  date?: string
  status: string
}

const recentCharges = ref<ChargeDisplayItem[]>([])

const page = ref(1)
const pageSize = ref(20)
const { data: txs } = await useFetch('/api/admin/wallet/transactions', {
  method: 'GET',
  query: { page, pageSize, type: 'credit', method: 'online' },
  credentials: 'include',
  key: () => `admin-wallet-credit-online-${page.value}-${pageSize.value}`,
  defaultCache: true,
})
const { data: trend } = await useFetch('/api/admin/wallet/trend', {
  method: 'GET', query: { days: 7 }, credentials: 'include', key: 'admin-wallet-trend-7', defaultCache: true,
})

interface ChargeItem {
  id?: number | string
  transactionId?: number | string
  [key: string]: unknown
}
interface ChargesResponse {
  items?: ChargeItem[]
  [key: string]: unknown
}
watchEffect(() => {
  const res = txs.value as ChargesResponse | null
  if (res && Array.isArray(res.items)) {
    recentCharges.value = res.items.map((r: ChargeItem) => ({
      id: r.id,
      transactionId: r.id,
      userName: r.username || r.user_id,
      userEmail: r.email || '-',
      userInitials: (r.username || '-').slice(0,2),
      amount: Number(r.amount || 0),
      gateway: r.gateway || r.method || '-',
      date: r.created_at,
      status: r.status === 'success' ? 'Ù…ÙˆÙÙ‚' : (r.status === 'pending' ? 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±' : 'Ù†Ø§Ù…ÙˆÙÙ‚')
    }))
    // Ø¢Ù…Ø§Ø± Ø³Ø§Ø¯Ù‡
    chargeStats.totalCharges = Number(res.total || 0)
    const succ = recentCharges.value.filter((x: ChargeDisplayItem)=>x.status==='Ù…ÙˆÙÙ‚').length
    const fail = recentCharges.value.filter((x: ChargeDisplayItem)=>x.status==='Ù†Ø§Ù…ÙˆÙÙ‚').length
    const totalShown = Math.max(1, recentCharges.value.length)
    chargeStats.successfulCharges = succ
    chargeStats.failedCharges = fail
    chargeStats.successRate = Math.round((succ/totalShown)*1000)/10
    chargeStats.failureRate = Math.round((fail/totalShown)*1000)/10
  }
  interface TrendItem {
    day?: string
    net?: number
    [key: string]: unknown
  }
  interface TrendResponse {
    items?: TrendItem[]
    [key: string]: unknown
  }
  const t = trend.value as TrendResponse | null
  if (t && Array.isArray(t.items)) {
    chargeTrend.value = t.items.map((x: TrendItem)=>({ date: x.day || '', amount: Number(x.net||0) }))
  }
})

// ØªØ§Ø¨Ø¹ ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø§Ø±Ø²
const formatCurrency = (amount: number) => {
  return new Intl.NumberFormat('fa-IR').format(amount) + ' ØªÙˆÙ…Ø§Ù†'
}

// ØªØ§Ø¨Ø¹ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø±ØªÙØ§Ø¹ Ù†Ù…ÙˆØ¯Ø§Ø±
const getChartHeight = (amount: number) => {
  const maxAmount = Math.max(...chargeTrend.value.map(item => item.amount))
  const minAmount = Math.min(...chargeTrend.value.map(item => item.amount))
  const range = maxAmount - minAmount
  const height = 150

  if (range === 0) return height

  const percentage = ((amount - minAmount) / range) * 100
  return (percentage / 100) * height
}

// ØªØ§Ø¨Ø¹ Ú©Ù„Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ú¯Ø§Ù‡
const getGatewayStatusClass = (status: string) => {
  switch (status) {
    case 'ÙØ¹Ø§Ù„':
      return 'bg-green-100 text-green-800'
    case 'ØºÛŒØ±ÙØ¹Ø§Ù„':
      return 'bg-red-100 text-red-800'
    case 'Ø¯Ø± Ø­Ø§Ù„ ØªØ¹Ù…ÛŒØ±':
      return 'bg-yellow-100 text-yellow-800'
    default:
      return 'bg-gray-100 text-gray-800'
  }
}

// ØªØ§Ø¨Ø¹ Ú©Ù„Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
const getStatusClass = (status: string) => {
  switch (status) {
    case 'Ù…ÙˆÙÙ‚':
      return 'bg-green-100 text-green-800'
    case 'Ù†Ø§Ù…ÙˆÙÙ‚':
      return 'bg-red-100 text-red-800'
    case 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±':
      return 'bg-yellow-100 text-yellow-800'
    default:
      return 'bg-gray-100 text-gray-800'
  }
}
</script>

<!--
  Ù…Ø³ØªÙ†Ø¯Ø³Ø§Ø²ÛŒ:
  Ø§ÛŒÙ† Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø´Ø§Ù…Ù„ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³Øª:
  1. Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ø´Ø§Ø±Ú˜Ù‡Ø§ (Ú©Ù„ØŒ Ù…Ø¨Ù„ØºØŒ Ù…ÙˆÙÙ‚ØŒ Ù†Ø§Ù…ÙˆÙÙ‚)
  2. Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª
  3. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø´Ø§Ø±Ú˜
  4. Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ÛŒ
  5. Ø¬Ø¯ÙˆÙ„ Ø´Ø§Ø±Ú˜Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ±
  
  ØªÙ…Ø§Ù… ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø¨Ø§ Ø·Ø±Ø§Ø­ÛŒ Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø§Ø±Ø§Ø¦Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.
--> 
